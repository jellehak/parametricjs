!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("y3d",[],t):"object"==typeof exports?exports.y3d=t():e.y3d=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=1)}([function(e,t,r){"use strict";function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0];if(Array.isArray(e))var t=n(e,3),r=t[0],a=t[1],i=t[2];else var r=e.x,a=e.y,i=e.z;return{x:r,y:a,z:i}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],a=!0,n=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),n=function(e){return e&&e.__esModule?e:{default:e}}(a),i=new n.default;t.default=i,e.exports=i},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(){function e(e){var t=this,r=e.render,a=e.name,n=e.visible,i=void 0===n||n,o=e.created,u=(e.get,e.hit),c=e.light,l=e.type,h=e.mesh,d=l,f=h;if(!(l||r||h||c))return console.warn("Y3D [please specify a type, render, light or mesh key]",e);if(c&&!l&&(d="light"),d){var p=s(d);if(!p)return console.warn("Y3D [Couldn't find type handler: \""+d+'"]');f=p(e)}return"function"==typeof f&&(f=f()),Promise.resolve(f).then(function(n){if(n&&(n.name=a||d,n.visible=i,M.add(n),n._hit=u,e.mesh=n),o){var s=Object.assign({camera:x,keyboard:L.keyboard,mesh:n},t);o(s)}r&&k.push(e)})}function t(){requestAnimationFrame(t),r(),a.update(),_.render(M,x),b.stats&&w.update()}function r(){var e=C.getDelta();k.map(function(t){var r=t.mesh,a=t.render,n=Object.assign(L,{delta:e,camera:x,keyboard:L.keyboard,time:F,mesh:r});a&&a(n)}),F+=e}function a(e){var t=e.target,r=(e.type,(0,A.default)(t)),n=r.x,i=r.y,o=r.z;a=new THREE.OrbitControls(x,R),a.target.set(n,i,o),a.update(),Object.assign(a,e)}function n(e){var t=e.to,r=e.lookAt,a=void 0===r?{x:0,y:0,z:0}:r,n=e.speed,i=void 0===n?600:n,o=e.ease,s=void 0===o?H.default.Easing.Linear.None:o,u=x.position,c=u.x,l=u.y,h=u.z,d={x:c,y:l,z:h},f=(0,A.default)(t);return f.x=f.x||c,f.y=f.y||l,f.z=f.z||h,new Promise(function(e,t){new H.default.Tween(d).to(f,i).easing(s).onUpdate(function(){x.position.set(d.x,d.y,d.z),x.lookAt(new THREE.Vector3(500,500,0))}).onComplete(function(){x.lookAt((0,A.default)(a)),e()}).start()})}function i(e){var t=e.size,r=void 0===t?1:t,a=e.radius,n=void 0===a?r:a,i=e.position,o=e.segments,s=void 0===o?16:o,u=e.rings,c=void 0===u?16:u,l=e.color,h=void 0===l?13369344:l,d=new THREE.MeshLambertMaterial({color:h}),f=new THREE.SphereGeometry(n,s,c),p=new THREE.Mesh(f,d),m=(0,A.default)(i),E=m.x,v=m.y,g=m.z;return p.position.set(E,v,g),p}function s(e){return S[e]||0}function c(e){return(0,l.default)(e).then(function(e){M.add(e)})}function h(e){e.map(function(e){c(e)})}function p(e){var t=e.url,r=e.width,a=e.height,n=e.color,i=(new THREE.TextureLoader).load(t),o=new THREE.PlaneBufferGeometry(r,a),s=new THREE.MeshPhongMaterial({color:n,map:i}),u=new THREE.Mesh(o,s);u.rotation.x=-Math.PI/2,u.material.map.repeat.set(8,8),u.material.map.wrapS=u.material.map.wrapT=THREE.RepeatWrapping,u.receiveShadow=!0,M.add(u)}function E(e){var t=e.fov,r=e.aspect,a=e.near,n=e.far,i=(e.width,e.height,e.x),o=e.y,s=e.z,u=new THREE.PerspectiveCamera(t||60,r,a||.01,n||1e10);return u.position.set(i||100,o||100,s||100),u}function g(r){var n=r.elementId,i=r.stats,o=r.autostart,s=(r.tween,r.background),u=r.size,c=r.camera;b=r,i=i||!1,o=o||!0,s="background"in b?s:0,c=c||{x:2,y:2,z:2},u=u||{width:window.innerWidth,height:window.innerHeight},n?R=document.getElementById(b.elementId):(R=document.createElement("div"),document.body.appendChild(R)),R.offsetWidth&&R.offsetHeight?u={width:R.offsetWidth,height:R.offsetHeight}:(console.warn("Could not detect the div elements size defaulting to full screen (make sure the object is loaded)"),u={width:window.innerWidth,height:window.innerHeight}),M=new THREE.Scene,M.background=new THREE.Color(s),c.aspect=u.width/u.height,x=E(c),M.add(x),a=new THREE.OrbitControls(x,R),a.target.set(0,0,0),a.update();return _=new THREE.WebGLRenderer({antialias:!0}),_.shadowMap.enabled=!0,_.setPixelRatio(window.devicePixelRatio),_.setSize(u.width,u.height),_.gammaInput=!0,_.gammaOutput=!0,R.appendChild(_.domElement),i&&(statistics=new Stats,R.appendChild(statistics.dom)),e({render:function(){H.default.update()}}),window.addEventListener("resize",T,!1),o&&t(),this.renderer=_,this.scene=M,this.camera=x,this.controls=a,this}function T(){x.aspect=window.innerWidth/window.innerHeight,x.updateProjectionMatrix(),_.setSize(window.innerWidth,window.innerHeight),a.handleResize&&a.handleResize()}console.log("Y3D [version "+o.default.version+"]");var b,R,w,x,a,M,_,L=this,F=0,k=Array(),C=new THREE.Clock,S={plane:p,light:v.default,axis:function(e){return(0,d.default)(e)},sphere:i};Object.assign(this,{update:r,animate:t,add:e,camera:x,scene:M,setup:g,load:l.default,sphere:i,axis:d.default,buildAxis:f.buildAxis,line:m.default,path:y.default,light:v.default,cam:n,loadAndAdd:c,controls:a,getPosition:A.default,TWEEN:H.default,keyboard:new u.default,plane:p,loadAll:h,renderer:_}),this.fog=function(e){var t=e.color,r=e.near,a=e.far;return new THREE.Fog(t,r,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var i=r(3),o=a(i);r(4),r(5);var s=r(6),u=a(s),c=r(7),l=a(c),h=r(44),d=a(h),f=r(45),p=r(46),m=a(p),E=r(47),v=a(E),g=r(48),y=a(g),T=r(49),b=(a(T),r(50)),R=(a(b),r(0)),A=a(R),w=r(51),H=a(w);r(53).mixin(n)},function(e,t){e.exports={name:"y3d",version:"1.0.13",description:"A 3D javascript engine",main:"dist/y3d.js",author:"Jelle",license:"ISC",scripts:{upgrade:"yarn upgrade-interactive --latest",build:"webpack --optimize-minimize --env build --display-modules",start:"webpack-dev-server --progress --colors --watch --env dev --open"},repository:"https://github.com/jellehak/Y3D.git",dependencies:{"@tweenjs/tween.js":"^17.2.0",three:"^0.90.0"},"pre-commit":["build"],devDependencies:{"babel-loader":"^7.1.2","pre-push":"^0.1.1","pre-commit":"^1.2.2"}}},function(e,t){THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*S.autoRotateSpeed}function a(){return Math.pow(.95,S.zoomSpeed)}function n(e){V.theta-=e}function i(e){V.phi-=e}function o(e){S.object.isPerspectiveCamera?G/=e:S.object.isOrthographicCamera?(S.object.zoom=Math.max(S.minZoom,Math.min(S.maxZoom,S.object.zoom*e)),S.object.updateProjectionMatrix(),z=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),S.enableZoom=!1)}function s(e){S.object.isPerspectiveCamera?G*=e:S.object.isOrthographicCamera?(S.object.zoom=Math.max(S.minZoom,Math.min(S.maxZoom,S.object.zoom/e)),S.object.updateProjectionMatrix(),z=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),S.enableZoom=!1)}function u(e){K.set(e.clientX,e.clientY)}function c(e){Z.set(e.clientX,e.clientY)}function l(e){q.set(e.clientX,e.clientY)}function h(e){W.set(e.clientX,e.clientY),Y.subVectors(W,K);var t=S.domElement===document?S.domElement.body:S.domElement;n(2*Math.PI*Y.x/t.clientWidth*S.rotateSpeed),i(2*Math.PI*Y.y/t.clientHeight*S.rotateSpeed),K.copy(W),S.update()}function d(e){J.set(e.clientX,e.clientY),$.subVectors(J,Z),$.y>0?o(a()):$.y<0&&s(a()),Z.copy(J),S.update()}function f(e){Q.set(e.clientX,e.clientY),X.subVectors(Q,q),re(X.x,X.y),q.copy(Q),S.update()}function p(e){}function m(e){e.deltaY<0?s(a()):e.deltaY>0&&o(a()),S.update()}function E(e){switch(e.keyCode){case S.keys.UP:re(0,S.keyPanSpeed),S.update();break;case S.keys.BOTTOM:re(0,-S.keyPanSpeed),S.update();break;case S.keys.LEFT:re(S.keyPanSpeed,0),S.update();break;case S.keys.RIGHT:re(-S.keyPanSpeed,0),S.update()}}function v(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);Z.set(0,a)}function y(e){q.set(e.touches[0].pageX,e.touches[0].pageY)}function T(e){W.set(e.touches[0].pageX,e.touches[0].pageY),Y.subVectors(W,K);var t=S.domElement===document?S.domElement.body:S.domElement;n(2*Math.PI*Y.x/t.clientWidth*S.rotateSpeed),i(2*Math.PI*Y.y/t.clientHeight*S.rotateSpeed),K.copy(W),S.update()}function b(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);J.set(0,n),$.subVectors(J,Z),$.y>0?s(a()):$.y<0&&o(a()),Z.copy(J),S.update()}function R(e){Q.set(e.touches[0].pageX,e.touches[0].pageY),X.subVectors(Q,q),re(X.x,X.y),q.copy(Q),S.update()}function A(e){}function w(e){if(!1!==S.enabled){switch(e.preventDefault(),e.button){case S.mouseButtons.ORBIT:if(!1===S.enableRotate)return;u(e),P=B.ROTATE;break;case S.mouseButtons.ZOOM:if(!1===S.enableZoom)return;c(e),P=B.DOLLY;break;case S.mouseButtons.PAN:if(!1===S.enablePan)return;l(e),P=B.PAN}P!==B.NONE&&(document.addEventListener("mousemove",H,!1),document.addEventListener("mouseup",x,!1),S.dispatchEvent(N))}}function H(e){if(!1!==S.enabled)switch(e.preventDefault(),P){case B.ROTATE:if(!1===S.enableRotate)return;h(e);break;case B.DOLLY:if(!1===S.enableZoom)return;d(e);break;case B.PAN:if(!1===S.enablePan)return;f(e)}}function x(e){!1!==S.enabled&&(p(e),document.removeEventListener("mousemove",H,!1),document.removeEventListener("mouseup",x,!1),S.dispatchEvent(O),P=B.NONE)}function M(e){!1===S.enabled||!1===S.enableZoom||P!==B.NONE&&P!==B.ROTATE||(e.preventDefault(),e.stopPropagation(),S.dispatchEvent(N),m(e),S.dispatchEvent(O))}function _(e){!1!==S.enabled&&!1!==S.enableKeys&&!1!==S.enablePan&&E(e)}function L(e){if(!1!==S.enabled){switch(e.touches.length){case 1:if(!1===S.enableRotate)return;v(e),P=B.TOUCH_ROTATE;break;case 2:if(!1===S.enableZoom)return;g(e),P=B.TOUCH_DOLLY;break;case 3:if(!1===S.enablePan)return;y(e),P=B.TOUCH_PAN;break;default:P=B.NONE}P!==B.NONE&&S.dispatchEvent(N)}}function F(e){if(!1!==S.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===S.enableRotate)return;if(P!==B.TOUCH_ROTATE)return;T(e);break;case 2:if(!1===S.enableZoom)return;if(P!==B.TOUCH_DOLLY)return;b(e);break;case 3:if(!1===S.enablePan)return;if(P!==B.TOUCH_PAN)return;R(e);break;default:P=B.NONE}}function k(e){!1!==S.enabled&&(A(e),S.dispatchEvent(O),P=B.NONE)}function C(e){!1!==S.enabled&&e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return D.phi},this.getAzimuthalAngle=function(){return D.theta},this.saveState=function(){S.target0.copy(S.target),S.position0.copy(S.object.position),S.zoom0=S.object.zoom},this.reset=function(){S.target.copy(S.target0),S.object.position.copy(S.position0),S.object.zoom=S.zoom0,S.object.updateProjectionMatrix(),S.dispatchEvent(I),S.update(),P=B.NONE},this.update=function(){var t=new THREE.Vector3,a=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=a.clone().inverse(),o=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=S.object.position;return t.copy(e).sub(S.target),t.applyQuaternion(a),D.setFromVector3(t),S.autoRotate&&P===B.NONE&&n(r()),D.theta+=V.theta,D.phi+=V.phi,D.theta=Math.max(S.minAzimuthAngle,Math.min(S.maxAzimuthAngle,D.theta)),D.phi=Math.max(S.minPolarAngle,Math.min(S.maxPolarAngle,D.phi)),D.makeSafe(),D.radius*=G,D.radius=Math.max(S.minDistance,Math.min(S.maxDistance,D.radius)),S.target.add(j),t.setFromSpherical(D),t.applyQuaternion(i),e.copy(S.target).add(t),S.object.lookAt(S.target),!0===S.enableDamping?(V.theta*=1-S.dampingFactor,V.phi*=1-S.dampingFactor):V.set(0,0,0),G=1,j.set(0,0,0),!!(z||o.distanceToSquared(S.object.position)>U||8*(1-s.dot(S.object.quaternion))>U)&&(S.dispatchEvent(I),o.copy(S.object.position),s.copy(S.object.quaternion),z=!1,!0)}}(),this.dispose=function(){S.domElement.removeEventListener("contextmenu",C,!1),S.domElement.removeEventListener("mousedown",w,!1),S.domElement.removeEventListener("wheel",M,!1),S.domElement.removeEventListener("touchstart",L,!1),S.domElement.removeEventListener("touchend",k,!1),S.domElement.removeEventListener("touchmove",F,!1),document.removeEventListener("mousemove",H,!1),document.removeEventListener("mouseup",x,!1),window.removeEventListener("keydown",_,!1)};var S=this,I={type:"change"},N={type:"start"},O={type:"end"},B={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},P=B.NONE,U=1e-6,D=new THREE.Spherical,V=new THREE.Spherical,G=1,j=new THREE.Vector3,z=!1,K=new THREE.Vector2,W=new THREE.Vector2,Y=new THREE.Vector2,q=new THREE.Vector2,Q=new THREE.Vector2,X=new THREE.Vector2,Z=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),j.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(t),j.add(e)}}(),re=function(){var e=new THREE.Vector3;return function(t,r){var a=S.domElement===document?S.domElement.body:S.domElement;if(S.object.isPerspectiveCamera){var n=S.object.position;e.copy(n).sub(S.target);var i=e.length();i*=Math.tan(S.object.fov/2*Math.PI/180),ee(2*t*i/a.clientHeight,S.object.matrix),te(2*r*i/a.clientHeight,S.object.matrix)}else S.object.isOrthographicCamera?(ee(t*(S.object.right-S.object.left)/S.object.zoom/a.clientWidth,S.object.matrix),te(r*(S.object.top-S.object.bottom)/S.object.zoom/a.clientHeight,S.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),S.enablePan=!1)}}();S.domElement.addEventListener("contextmenu",C,!1),S.domElement.addEventListener("mousedown",w,!1),S.domElement.addEventListener("wheel",M,!1),S.domElement.addEventListener("touchstart",L,!1),S.domElement.addEventListener("touchend",k,!1),S.domElement.addEventListener("touchmove",F,!1),window.addEventListener("keydown",_,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})},function(e,t,r){var a={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,r,n;e=e||{},t=void 0!==e.parent?e.parent:document.body,r=void 0!==e.id?e.id:"oldie",n=a.getWebGLErrorMessage(),n.id=r,t.appendChild(n)}};e.exports=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){this.keyCodes={},this.modifiers={};var e=this;this._onKeyDown=function(t){e._onKeyChange(t,!0)},this._onKeyUp=function(t){e._onKeyChange(t,!1)},document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("keyup",this._onKeyUp,!1)};a.prototype.destroy=function(){document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("keyup",this._onKeyUp,!1)},a.MODIFIERS=["shift","ctrl","alt","meta"],a.ALIAS={left:37,up:38,right:39,down:40,space:32,pageup:33,pagedown:34,tab:9},a.prototype._onKeyChange=function(e,t){var r=e.keyCode,a=e.shiftKey,n=e.ctrlKey,i=e.altKey,o=e.metaKey;this.keyCodes[r]=t,this.modifiers.shift=a,this.modifiers.ctrl=n,this.modifiers.alt=i,this.modifiers.meta=o},a.prototype.pressed=function(e){for(var t=e.split("+"),r=0;r<t.length;r++){var n=t[r];if(!(-1!==a.MODIFIERS.indexOf(n)?this.modifiers[n]:-1!=Object.keys(a.ALIAS).indexOf(n)?this.keyCodes[a.ALIAS[n]]:this.keyCodes[n.toUpperCase().charCodeAt(0)]))return!1}return!0},t.default=a},function(e,t,r){"use strict";function a(e){return s.filter(function(t){return t.extensions.includes(e)})[0]||{}}function n(e){var t=e.url,r=e.path;return new Promise(function(e,n){var i=t.split(".").pop(),o=a(i),s=o.loader;s||n("no loader found for extension: "+i);var u=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% downloaded")}},c=function(e){};r&&s.setPath(r),s.load(t,function(r){console.log(r),r.name=t,s.setup&&(r=s.setup(r)),e(r)},u,c)})}function i(e){return console.log("setting up the loaded model"),e}function o(e){console.log("setupSTL: setting up the loaded model",e);var t=new THREE.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200}),r=new THREE.Mesh(e,t);return r.position.set(0,-.25,.6),r.rotation.set(0,-Math.PI/2,0),r.scale.set(.5,.5,.5),r.castShadow=!0,r.receiveShadow=!0,r}Object.defineProperty(t,"__esModule",{value:!0}),r(8),r(9),r(10),r(11),r(12),r(13),r(14),r(15),r(16),r(17),r(18),r(19),r(20),r(21),r(22),r(23),r(24),r(25),r(26),r(27),r(28),r(29),r(30),r(31),r(32),r(33),r(34),r(35),r(36),r(37),r(38),r(39),r(40),r(41),r(42),r(43),t.default=n;var s=[{extensions:["3ds"],loader:new THREE.TDSLoader(u),setup:i},{extensions:["3mf"],loader:new THREE.ThreeMFLoader(u),setup:i},{extensions:["amf"],loader:new THREE.AMFLoader(u),setup:i},{extensions:["md2"],loader:new THREE.MD2Loader(u),setup:i},{extensions:["collada"],loader:new THREE.ColladaLoader(u),setup:i},{extensions:["fbx"],loader:new THREE.FBXLoader(u),setup:i},{extensions:["json"],loader:new THREE.JSONLoader(u),setup:i},{extensions:["json"],loader:new THREE.JSONLoader(u),setup:i},{extensions:["obj"],loader:new THREE.OBJLoader(u),setup:i},{extensions:["vrml"],loader:new THREE.VRMLLoader(u),setup:i},{extensions:["png","jpg"],loader:new THREE.ImageLoader(u),setup:i},{extensions:["stl"],loader:new THREE.STLLoader,setup:o}],u=new THREE.LoadingManager;u.onProgress=function(e,t,r){console.log(e,t,r)}},function(e,t,r){"use strict";THREE.DRACOLoader=function(e){this.timeLoaded=0,this.manager=e||THREE.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=THREE.TrianglesDrawMode,this.attributeUniqueIdMap={},this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}},THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),i.load(e,function(e){n.decodeDracoFile(e,t)},r,a)},setPath:function(e){this.path=e},setCrossOrigin:function(e){this.crossOrigin=e},setVerbosity:function(e){this.verbosity=e},setDrawMode:function(e){this.drawMode=e},setSkipDequantization:function(e,t){var r=!0;void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r},decodeDracoFile:function(e,t,r){var a=this;this.attributeUniqueIdMap=r||{},THREE.DRACOLoader.getDecoderModule().then(function(r){a.decodeDracoFileInternal(e,r.decoder,t)})},decodeDracoFileInternal:function(e,t,r){var a=new t.DecoderBuffer;a.Init(new Int8Array(e),e.byteLength);var n=new t.Decoder,i=n.GetEncodedGeometryType(a);if(i==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(i!=t.POINT_CLOUD){var o="THREE.DRACOLoader: Unknown geometry type.";throw console.error(o),new Error(o)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,n,i,a))},addAttributeToGeometry:function(e,t,r,a,n,i,o){if(0===n.ptr){var s="THREE.DRACOLoader: No attribute "+a;throw console.error(s),new Error(s)}var u=n.num_components(),c=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(r,n,c);var l=r.num_points(),h=l*u;o[a]=new Float32Array(h);for(var d=0;d<h;d++)o[a][d]=c.GetValue(d);i.addAttribute(a,new THREE.Float32BufferAttribute(o[a],u)),e.destroy(c)},convertDracoGeometryTo3JS:function(e,t,r,a){!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var n,i;const o=performance.now();if(r===e.TRIANGULAR_MESH?(n=new e.Mesh,i=t.DecodeBufferToMesh(a,n)):(n=new e.PointCloud,i=t.DecodeBufferToPointCloud(a,n)),!i.ok()||0==n.ptr){var s="THREE.DRACOLoader: Decoding failed: ";throw s+=i.error_msg(),console.error(s),e.destroy(t),e.destroy(n),new Error(s)}var u=performance.now();e.destroy(a);var c;r==e.TRIANGULAR_MESH?(c=n.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+c.toString())):c=0;var l=n.num_points(),h=n.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+l.toString()),console.log("Number of attributes loaded: "+h.toString()));var d=t.GetAttributeId(n,e.POSITION);if(-1==d){var s="THREE.DRACOLoader: No position attribute found.";throw console.error(s),e.destroy(t),e.destroy(n),new Error(s)}var f=t.GetAttribute(n,d),p={},m=new THREE.BufferGeometry;for(var E in this.nativeAttributeMap)if(void 0===this.attributeUniqueIdMap[E]){var v=t.GetAttributeId(n,e[this.nativeAttributeMap[E]]);if(-1!==v){this.verbosity>0&&console.log("Loaded "+E+" attribute.");var g=t.GetAttribute(n,v);this.addAttributeToGeometry(e,t,n,E,g,m,p)}}for(var E in this.attributeUniqueIdMap){var y=this.attributeUniqueIdMap[E],g=t.GetAttributeByUniqueId(n,y);this.addAttributeToGeometry(e,t,n,E,g,m,p)}if(r==e.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){var T=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(n,T);p.indices=new Uint32Array(T.size());for(var b=0;b<T.size();++b)p.indices[b]=T.GetValue(b);e.destroy(T)}else{var R=3*c;p.indices=new Uint32Array(R);for(var A=new e.DracoInt32Array,b=0;b<c;++b){t.GetFaceFromMesh(n,b,A);var w=3*b;p.indices[w]=A.GetValue(0),p.indices[w+1]=A.GetValue(1),p.indices[w+2]=A.GetValue(2)}e.destroy(A)}m.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&m.setIndex(new(p.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(p.indices,1));var H=new e.AttributeQuantizationTransform;if(H.InitFromAttribute(f)){m.attributes.position.isQuantized=!0,m.attributes.position.maxRange=H.range(),m.attributes.position.numQuantizationBits=H.quantization_bits(),m.attributes.position.minValues=new Float32Array(3);for(var b=0;b<3;++b)m.attributes.position.minValues[b]=H.min_value(b)}return e.destroy(H),e.destroy(t),e.destroy(n),this.decode_time=u-o,this.import_time=performance.now()-u,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),m},isVersionSupported:function(e,t){THREE.DRACOLoader.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},THREE.DRACOLoader.decoderPath="./",THREE.DRACOLoader.decoderConfig={},THREE.DRACOLoader.decoderModulePromise=null,THREE.DRACOLoader.setDecoderPath=function(e){THREE.DRACOLoader.decoderPath=e},THREE.DRACOLoader.setDecoderConfig=function(e){var t=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=e||{},THREE.DRACOLoader.decoderModulePromise=null,t&&(THREE.DRACOLoader.decoderConfig.wasmBinary=t)},THREE.DRACOLoader.getDecoderModule=function(){var e=this,t=THREE.DRACOLoader.decoderPath,r=THREE.DRACOLoader.decoderConfig,a=THREE.DRACOLoader.decoderModulePromise;return a||("undefined"!=typeof DracoDecoderModule?a=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?a=THREE.DRACOLoader._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",a=THREE.DRACOLoader._loadScript(t+"draco_wasm_wrapper.js").then(function(){return THREE.DRACOLoader._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),a=a.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),THREE.DRACOLoader.decoderModulePromise=a,a)},THREE.DRACOLoader._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],a=document.createElement("script");return a.id="decoder_script",a.type="text/javascript",a.src=e,new Promise(function(e){a.onload=e,r.appendChild(a)})},THREE.DRACOLoader._loadArrayBuffer=function(e){var t=new THREE.FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(r,a){t.load(e,r,void 0,a)})}},function(e,t){THREE.ThreeMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.availableExtensions=[]},THREE.ThreeMFLoader.prototype={constructor:THREE.ThreeMFLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e){var t=(new DOMParser).parseFromString(e,"application/xml"),r=t.querySelector("Relationship");return{target:r.getAttribute("Target"),id:r.getAttribute("Id"),type:r.getAttribute("Type")}}function r(e){for(var t={},r=0;r<e.length;r++){var a=e[r],n=a.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(n)&&(t[n]=a.textContent)}return t}function a(e){}function n(e,t){for(var r={},a=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var o=n[i],s=o.getAttribute("x"),u=o.getAttribute("y"),c=o.getAttribute("z");a.push(parseFloat(s),parseFloat(u),parseFloat(c))}r.vertices=new Float32Array(a.length);for(var i=0;i<a.length;i++)r.vertices[i]=a[i];for(var l=[],h=[],d=e.querySelectorAll("triangles triangle"),i=0;i<d.length;i++){var f=d[i],p=f.getAttribute("v1"),m=f.getAttribute("v2"),E=f.getAttribute("v3"),v=f.getAttribute("p1"),g=f.getAttribute("p2"),y=f.getAttribute("p3"),T=f.getAttribute("pid");h.push(parseInt(p,10),parseInt(m,10),parseInt(E,10));var b={};v&&(b.p1=parseInt(v,10)),g&&(b.p2=parseInt(g,10)),y&&(b.p3=parseInt(y,10)),T&&(b.pid=T),0<Object.keys(b).length&&l.push(b)}r.triangleProperties=l,r.triangles=new Uint32Array(h.length);for(var i=0;i<h.length;i++)r.triangles[i]=h[i];return r}function i(e){}function o(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var a=e.getAttribute("pid");a&&(t.pid=a);var o=e.getAttribute("pindex");o&&(t.pindex=o);var s=e.getAttribute("thumbnail");s&&(t.thumbnail=s);var u=e.getAttribute("partnumber");u&&(t.partnumber=u);var c=e.getAttribute("name");c&&(t.name=c);var l=e.querySelector("mesh");l&&(t.mesh=n(l));var h=e.querySelector("components");return h&&(t.components=i(h)),t}function s(e){var t={},r=e.querySelector("basematerials");r&&(t.basematerial=a(r)),t.object={};for(var n=e.querySelectorAll("object"),i=0;i<n.length;i++){var s=n[i],u=o(s);t.object[u.id]=u}return t}function u(e){for(var t=[],r=e.querySelectorAll("item"),a=0;a<r.length;a++){var n=r[a],i={objectid:n.getAttribute("objectid")},o=n.getAttribute("transform");if(o){var s=[];o.split(" ").forEach(function(e){s.push(parseFloat(e))});var u=new THREE.Matrix4;i.transform=u.set(s[0],s[3],s[6],s[9],s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],0,0,0,1)}t.push(i)}return t}function c(e){var t={unit:e.getAttribute("unit")||"millimeter"},a=e.querySelectorAll("metadata");a&&(t.metadata=r(a));var n=e.querySelector("resources");n&&(t.resources=s(n));var i=e.querySelector("build");return i&&(t.build=u(i)),t}function l(e,t){var r=new THREE.BufferGeometry;r.setIndex(new THREE.BufferAttribute(e.triangles,1)),r.addAttribute("position",new THREE.BufferAttribute(e.vertices,3)),e.colors&&r.addAttribute("color",new THREE.BufferAttribute(e.colors,3)),r.computeBoundingSphere();var a={flatShading:!0};e.colors&&0<e.colors.length?a.vertexColors=THREE.VertexColors:a.color=11184895;var n=new THREE.MeshPhongMaterial(a);return new THREE.Mesh(r,n)}function h(e,t,r,a){if(e){for(var n=[],i=Object.keys(e),o=0;o<i.length;o++)for(var s=i[o],u=0;u<d.availableExtensions.length;u++){var c=d.availableExtensions[u];c.ns===s&&n.push(c)}for(var o=0;o<n.length;o++){var c=n[o];c.apply(r,e[c.ns],t)}}}var d=this,f=function(e){var r,a,n=null,i=null,o=[],s=[],u=[],l=[],h={},d={},f={},p={};try{n=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.ThreeMFLoader: jszip missing and file is compressed."),null}for(i in n.files)i.match(/\.rels$/)?r=i:i.match(/^3D\/.*\.model$/)?o.push(i):i.match(/^3D\/Metadata\/.*\.xml$/)?s.push(i):i.match(/^3D\/Textures\/.*/)?u.push(i):i.match(/^3D\/Other\/.*/)&&l.push(i);var m=new Uint8Array(n.file(r).asArrayBuffer());a=t(THREE.LoaderUtils.decodeText(m));for(var E=0;E<o.length;E++){var v=o[E],g=new Uint8Array(n.file(v).asArrayBuffer()),y=THREE.LoaderUtils.decodeText(g),T=(new DOMParser).parseFromString(y,"application/xml");"model"!==T.documentElement.nodeName.toLowerCase()&&console.error("THREE.ThreeMFLoader: Error loading 3MF - no 3MF document found: ",v);for(var b=T.querySelector("model"),R={},E=0;E<b.attributes.length;E++){var A=b.attributes[E];A.name.match(/^xmlns:(.+)$/)&&(R[A.value]=RegExp.$1)}var w=c(b);w.xml=b,0<Object.keys(R).length&&(w.extensions=R),h[v]=w}for(var E=0;E<u.length;E++){var H=u[E];f[H]=n.file(H).asBinary()}return{rels:a,model:h,printTicket:d,texture:f,other:p}}(e),p=function(e){for(var t=e.model,r={},a=Object.keys(t),n=0;n<a.length;n++)for(var i=a[n],o=t[i],s=o.xml,u=o.extensions,c=Object.keys(o.resources.object),d=0;d<c.length;d++){var f=c[d],p=o.resources.object[f],m=p.mesh;h(u,m,s,e),r[f]=l(m,e)}return r}(f);return function(e,t,r){for(var a=new THREE.Group,n=r.model[t.target.substring(1)].build,i=0;i<n.length;i++){var o=n[i],s=e[o.objectid];o.transform&&s.geometry.applyMatrix(o.transform),a.add(s)}return a}(p,f.rels,f)},addExtension:function(e){this.availableExtensions.push(e)}}},function(e,t){THREE.AMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AMFLoader.prototype={constructor:THREE.AMFLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];"r"===a.nodeName?t.r=a.textContent:"g"===a.nodeName?t.g=a.textContent:"b"===a.nodeName?t.b=a.textContent:"a"===a.nodeName&&(t.a=a.textContent)}return t}function r(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var a=r.getElementsByTagName("v1")[0].textContent,n=r.getElementsByTagName("v2")[0].textContent,i=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(a,n,i)}r=r.nextElementSibling}return t}function a(e){for(var t=[],r=[],a=e.firstElementChild;a;){if("vertex"===a.nodeName)for(var n=a.firstElementChild;n;){if("coordinates"===n.nodeName){var i=n.getElementsByTagName("x")[0].textContent,o=n.getElementsByTagName("y")[0].textContent,s=n.getElementsByTagName("z")[0].textContent;t.push(i,o,s)}else if("normal"===n.nodeName){var u=n.getElementsByTagName("nx")[0].textContent,c=n.getElementsByTagName("ny")[0].textContent,l=n.getElementsByTagName("nz")[0].textContent;r.push(u,c,l)}n=n.nextElementSibling}a=a.nextElementSibling}return{vertices:t,normals:r}}var n,i,o=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,a=null;console.log("THREE.AMFLoader: Loading Zip");try{r=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(a in r.files)if(".amf"===a.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+a),t=new DataView(r.file(a).asArrayBuffer())}var n=THREE.LoaderUtils.decodeText(t),i=(new DOMParser).parseFromString(n,"application/xml");return"amf"!==i.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):i}(e),s="",u="",c=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var a={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==a[r]&&(t=a[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(o),l={},h={},d=o.documentElement.childNodes;for(n=0;n<d.length;n++){var f=d[n];if("metadata"===f.nodeName)void 0!==f.attributes.type&&("name"===f.attributes.type.value?s=f.textContent:"author"===f.attributes.type.value&&(u=f.textContent));else if("material"===f.nodeName){var p=function(e){for(var r="AMF Material",a=e.attributes.id.textContent,n={r:1,g:1,b:1,a:1},i=null,o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(r=s.textContent):"color"===s.nodeName&&(n=t(s))}return i=new THREE.MeshPhongMaterial({flatShading:!0,color:new THREE.Color(n.r,n.g,n.b),name:r}),1!==n.a&&(i.transparent=!0,i.opacity=n.a),{id:a,material:i}}(f);l[p.id]=p.material}else if("object"===f.nodeName){var m=function(e){for(var n=e.attributes.id.textContent,i={name:"amfobject",meshes:[]},o=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(i.name=s.textContent);else if("color"===s.nodeName)o=t(s);else if("mesh"===s.nodeName){for(var u=s.firstElementChild,c={vertices:[],normals:[],volumes:[],color:o};u;){if("vertices"===u.nodeName){var l=a(u);c.normals=c.normals.concat(l.normals),c.vertices=c.vertices.concat(l.vertices)}else"volume"===u.nodeName&&c.volumes.push(r(u));u=u.nextElementSibling}i.meshes.push(c)}s=s.nextElementSibling}return{id:n,obj:i}}(f);h[m.id]=m.obj}}var E=new THREE.Group,v=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});E.name=s,E.userData.author=u,E.userData.loader="AMF";for(var g in h){var y=h[g],T=y.meshes,b=new THREE.Group;for(b.name=y.name||"",n=0;n<T.length;n++){var R=v,A=T[n],w=new THREE.Float32BufferAttribute(A.vertices,3),H=null;if(A.normals.length&&(H=new THREE.Float32BufferAttribute(A.normals,3)),A.color){var x=A.color;R=v.clone(),R.color=new THREE.Color(x.r,x.g,x.b),1!==x.a&&(R.transparent=!0,R.opacity=x.a)}var M=A.volumes;for(i=0;i<M.length;i++){var _=M[i],L=new THREE.BufferGeometry,F=R;L.setIndex(_.triangles),L.addAttribute("position",w.clone()),H&&L.addAttribute("normal",H.clone()),void 0!==l[_.materialId]&&(F=l[_.materialId]),L.scale(c,c,c),b.add(new THREE.Mesh(L,F.clone()))}}E.add(b)}return E}}},function(e,t){THREE.AssimpJSONLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AssimpJSONLoader.prototype={constructor:THREE.AssimpJSONLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this,i=THREE.LoaderUtils.extractUrlBase(e);new THREE.FileLoader(this.manager).load(e,function(e){var r=JSON.parse(e),o=r.__metadata__;if(void 0!==o){if("assimp2json"!==o.format)return void a("THREE.AssimpJSONLoader: Not an assimp2json scene.");if(o.version<100&&o.version>=200)return void a("THREE.AssimpJSONLoader: Unsupported assimp2json file format version.")}t(n.parse(r,i))},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=new Array(e.length),a=0;a<e.length;++a)r[a]=t.call(this,e[a]);return r}function a(e){var t,r,a,n=new THREE.BufferGeometry,i=[],o=e.vertices||[],s=e.normals||[],u=e.texturecoords||[],c=e.colors||[];for(u=u[0]||[],t=0,r=e.faces.length;t<r;t++)a=e.faces[t],i.push(a[0],a[1],a[2]);return n.setIndex(i),n.addAttribute("position",new THREE.Float32BufferAttribute(o,3)),s.length>0&&n.addAttribute("normal",new THREE.Float32BufferAttribute(s,3)),u.length>0&&n.addAttribute("uv",new THREE.Float32BufferAttribute(u,2)),c.length>0&&n.addAttribute("color",new THREE.Float32BufferAttribute(c,3)),n.computeBoundingSphere(),n}function n(e){var t=new THREE.MeshPhongMaterial;for(var r in e.properties){var a=e.properties[r],n=a.key,i=a.value;switch(n){case"$tex.file":var s=a.semantic;if(1===s||2===s||5===s||6===s){var u;switch(s){case 1:u="map";break;case 2:u="specularMap";break;case 5:u="bumpMap";break;case 6:u="normalMap"}var c=o.load(i);c.wrapS=c.wrapT=THREE.RepeatWrapping,t[u]=c}break;case"?mat.name":t.name=i;break;case"$clr.diffuse":t.color.fromArray(i);break;case"$clr.specular":t.specular.fromArray(i);break;case"$clr.emissive":t.emissive.fromArray(i);break;case"$mat.shininess":t.shininess=i;break;case"$mat.shadingm":t.flatShading=1===i;break;case"$mat.opacity":i<1&&(t.opacity=i,t.transparent=!0)}}return t}function i(e,t,r,a){var n,o,s=new THREE.Object3D;for(s.name=t.name||"",s.matrix=(new THREE.Matrix4).fromArray(t.transformation).transpose(),s.matrix.decompose(s.position,s.quaternion,s.scale),n=0;t.meshes&&n<t.meshes.length;n++)o=t.meshes[n],s.add(new THREE.Mesh(r[o],a[e.meshes[o].materialindex]));for(n=0;t.children&&n<t.children.length;n++)s.add(i(e,t.children[n],r,a));return s}var o=new THREE.TextureLoader(this.manager);o.setPath(t).setCrossOrigin(this.crossOrigin);var s=r(e.meshes,a),u=r(e.materials,n);return i(e,e.rootnode,s,u)}}},function(e,t){THREE.AssimpLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AssimpLoader.prototype={constructor:THREE.AssimpLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this,i=THREE.LoaderUtils.extractUrlBase(e),o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e,i))},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e){return xe<<e}function a(e){return Me<<e}function n(e){for(var t in e.mMeshes){var r=e.mMeshes[t];for(var a in r.mBones){var n=e.findNode(r.mBones[a].mName);n&&(n.isBone=!0)}}}function i(e,t){var r=new THREE.Bone;r.matrix.copy(e.matrix),r.matrixWorld.copy(e.matrixWorld),r.position.copy(e.position),r.quaternion.copy(e.quaternion),r.scale.copy(e.scale),t.nodeCount++,r.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(r);for(var a in e.children){var n=i(e.children[a],t);n&&r.add(n)}return r}function o(e,t){for(var r=[],a=0;a<e.length;a++)r.push({i:e[a],w:t[a]});for(r.sort(function(e,t){return t.w-e.w});r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);for(var n=0,a=0;a<4;a++)n+=r[a].w*r[a].w;n=Math.sqrt(n);for(var a=0;a<4;a++)r[a].w=r[a].w/n,e[a]=r[a].i,t[a]=r[a].w}function s(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(var r in e.children){var a=s(e.children[r],t);if(a)return a}}function u(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e,t){if(0!=this.mBones.length){for(var r=[],a=[],n=e.findNode(this.mBones[0].mName);n.mParent&&n.mParent.isBone;)n=n.mParent;var o=n.toTHREE(e),u=i(o,e);this.threeNode.add(u);for(var c=0;c<this.mBones.length;c++){var l=s(u,this.mBones[c].mName);if(l){var h=l;r.push(h),a.push(this.mBones[c].mOffsetMatrix.toTHREE())}else{var n=e.findNode(this.mBones[c].mName);if(!n)return;var o=n.toTHREE(e),u=(o.parent,i(o,e));this.threeNode.add(u);var l=s(u,this.mBones[c].mName),h=l;r.push(h),a.push(this.mBones[c].mOffsetMatrix.toTHREE())}}var d=new THREE.Skeleton(r,a);this.threeNode.bind(d,new THREE.Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,r=new THREE.BufferGeometry;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new THREE.MeshLambertMaterial,r.setIndex(new THREE.BufferAttribute(new Uint32Array(this.mIndexArray),1)),r.addAttribute("position",new THREE.BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&r.addAttribute("normal",new THREE.BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&r.addAttribute("color",new THREE.BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&r.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&r.addAttribute("uv1",new THREE.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&r.addAttribute("tangents",new THREE.BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&r.addAttribute("bitangents",new THREE.BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){for(var a=[],n=[],i=0;i<this.mBones.length;i++)for(var s=0;s<this.mBones[i].mWeights.length;s++){var u=this.mBones[i].mWeights[s];u&&(a[u.mVertexId]||(a[u.mVertexId]=[]),n[u.mVertexId]||(n[u.mVertexId]=[]),a[u.mVertexId].push(u.mWeight),n[u.mVertexId].push(parseInt(i)))}for(var i in n)o(n[i],a[i]);for(var c=[],l=[],i=0;i<a.length;i++)for(var s=0;s<4;s++)a[i]&&n[i]?(c.push(a[i][s]),l.push(n[i][s])):(c.push(0),l.push(0));r.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(c),Oe)),r.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(l),Oe))}var h;return 0==this.mBones.length&&(h=new THREE.Mesh(r,t)),this.mBones.length>0&&(h=new THREE.SkinnedMesh(r,t)),this.threeNode=h,h}}function c(){this.mNumIndices=0,this.mIndices=[]}function l(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new THREE.Vector3(this.x,this.y,this.z)}}function h(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new THREE.Color(this.r,this.g,this.b,1)}}function d(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}}function f(){this.mVertexId=0,this.mWeight=0}function p(){this.data=[],this.toString=function(){var e="";return this.data.forEach(function(t){e+=String.fromCharCode(t)}),e.replace(/[^\x20-\x7E]+/g,"")}}function m(){this.mTime=0,this.mValue=null}function E(){this.mTime=0,this.mValue=null}function v(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new THREE.Object3D;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(var r=0;r<this.mChildren.length;r++)t.add(this.mChildren[r].toTHREE(e));for(var r=0;r<this.mMeshes.length;r++)t.add(e.mMeshes[this.mMeshes[r]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function g(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function y(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e),r=t.getFloat32(0,!0),a=t.getFloat32(4,!0),n=t.getFloat32(8,!0);return new THREE.Color(r,a,n)},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new p;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new p;e.data=this.mData;var t=e.toString();return t=t.replace(/\\/g,"/"),-1!=t.indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),ue.load(t)}}function T(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(e){for(var t=(this.mProperties[0].dataAsString(),new THREE.MeshPhongMaterial),r=0;r<this.mProperties.length;r++)if("float"==Pe[this.mProperties[r].mKey]&&(t[Be[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==Pe[this.mProperties[r].mKey]&&(t[Be[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==Pe[this.mProperties[r].mKey]&&(t[Be[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==Pe[this.mProperties[r].mKey]&&(t[Be[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==Pe[this.mProperties[r].mKey]){var a=this.mProperties[r];a.mSemantic==Ce&&(t.map=this.mProperties[r].dataAsMap()),a.mSemantic==Se&&(t.normalMap=this.mProperties[r].dataAsMap()),a.mSemantic==Ne&&(t.lightMap=this.mProperties[r].dataAsMap()),a.mSemantic==Ie&&(t.alphaMap=this.mProperties[r].dataAsMap())}return t.ambient.r=.53,t.ambient.g=.53,t.ambient.b=.53,t.color.r=1,t.color.g=1,t.color.b=1,t}}function b(e,t,r){var a=new THREE.Vector3,n=1-r;return a.x=e.x*r+t.x*n,a.y=e.y*r+t.y*n,a.z=e.z*r+t.z*n,a}function R(e,t,r){return e.clone().slerp(t,1-r)}function A(e,t,r,a){if(1==e.length)return e[0].mValue.toTHREE();for(var n=1/0,i=null,o=null,s=0;s<e.length;s++){var u=Math.abs(e[s].mTime-t);u<n&&e[s].mTime<=t&&(n=u,i=e[s],o=e[s+1])}if(i){if(o){var c=o.mTime-i.mTime,l=i.mTime-t,h=l/c;return a(i.mValue.toTHREE(),o.mValue.toTHREE(),h)}o=e[0].clone(),o.mTime+=r;var c=o.mTime-i.mTime,l=i.mTime-t,h=l/c;return a(i.mValue.toTHREE(),o.mValue.toTHREE(),h)}return null}function w(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(e){return e.mTime})))},this.toTHREE=function(e,t){this.sortKeys();for(var r=this.getLength(),a=new ce.KeyFrameTrack,n=0;n<r;n+=.05){var i=new THREE.Matrix4,o=n,s=A(this.mPositionKeys,o,r,b),u=A(this.mScalingKeys,o,r,b),c=A(this.mRotationKeys,o,r,R);i.compose(s,c,u);var l=new ce.KeyFrame(o,i);a.addKey(l)}a.target=e.findNode(this.mNodeName).toTHREE();var h=[a];if(e.nodeToBoneMap[this.mNodeName])for(var n=0;n<e.nodeToBoneMap[this.mNodeName].length;n++){var d=a.clone();d.target=e.nodeToBoneMap[this.mNodeName][n],h.push(d)}return h}}function H(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new ce.Animation;for(var r in this.mChannels){this.mChannels[r].init(this.mTicksPerSecond);var a=this.mChannels[r].toTHREE(e);for(var n in a)a[n].init(),t.addTrack(a[n])}return t.length=Math.max.apply(null,t.tracks.map(function(e){return e.length})),t}}function x(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function M(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function _(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}function L(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(var r=0;r<t.mChildren.length;r++){var a=this.findNode(e,t.mChildren[r]);if(a)return a}return null},this.toTHREE=function(){this.nodeCount=0,n(this);var e=this.mRootNode.toTHREE(this);for(var t in this.mMeshes)this.mMeshes[t].hookupSkeletons(this,e);if(this.mAnimations.length>0)var r=this.mAnimations[0].toTHREE(this);return{object:e,animation:r}}}function F(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var e=new THREE.Matrix4,t=0;t<4;++t)for(var r=0;r<4;++r)e.elements[4*t+r]=this.elements[r][t];return e}}function k(e){var t=e.getFloat32(e.readOffset,Ue);return e.readOffset+=4,t}function C(e){var t=e.getFloat64(e.readOffset,Ue);return e.readOffset+=8,t}function S(e){var t=e.getUint8(e.readOffset);return e.readOffset+=1,t}function I(e){var t=e.getUint16(e.readOffset,Ue);return e.readOffset+=2,t}function N(e){var t=e.getUint32(e.readOffset,Ue);return e.readOffset+=4,t}function O(e){var t=e.getUint32(e.readOffset,Ue);return e.readOffset+=4,t}function B(e){var t=new l;return t.x=k(e),t.y=k(e),t.z=k(e),t}function P(e){var t=new h;return t.r=k(e),t.g=k(e),t.b=k(e),t}function U(e){var t=new d;return t.w=k(e),t.x=k(e),t.y=k(e),t.z=k(e),t}function D(e){var t=new p,r=N(e);return e.ReadBytes(t.data,1,r),t.toString()}function V(e){var t=new f;return t.mVertexId=N(e),t.mWeight=k(e),t}function G(e){for(var t=new F,r=0;r<4;++r)for(var a=0;a<4;++a)t.elements[r][a]=k(e);return t}function j(e){var t=new m;return t.mTime=C(e),t.mValue=B(e),t}function z(e){var t=new E;return t.mTime=C(e),t.mValue=U(e),t}function K(e,t,r){for(var a=0;a<r;a++)t[a]=V(e)}function W(e,t,r){for(var a=0;a<r;a++)t[a]=j(e)}function Y(e,t,r){for(var a=0;a<r;a++)t[a]=z(e)}function q(e,t,r){return e.Seek(sizeof(t)*r,De)}function Q(e){if(!e)throw"asset failed"}function X(e,t,r){Q(O(e)==Te),O(e);var a=new v;if(a.mParent=t,a.mDepth=r,a.mName=D(e),a.mTransformation=G(e),a.mNumChildren=N(e),a.mNumMeshes=N(e),a.mNumMeshes){a.mMeshes=[];for(var n=0;n<a.mNumMeshes;++n)a.mMeshes[n]=N(e)}if(a.mNumChildren){a.mChildren=[];for(var n=0;n<a.mNumChildren;++n){var i=X(e,a,r++);a.mChildren[n]=i}}return a}function Z(e,t){return Q(O(e)==ge),O(e),t.mName=D(e),t.mNumWeights=N(e),t.mOffsetMatrix=G(e),le?q(e,t.mWeights,t.mNumWeights):(t.mWeights=[],K(e,t.mWeights,t.mNumWeights)),t}function J(e,t){Q(O(e)==me),O(e),t.mPrimitiveTypes=N(e),t.mNumVertices=N(e),t.mNumFaces=N(e),t.mNumBones=N(e),t.mMaterialIndex=N(e),t.mNumUVComponents=[];var n=N(e);n&Ae&&(le?q(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De))),n&we&&(le?q(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De))),n&He&&(le?(q(e,t.mTangents,t.mNumVertices),q(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De)));for(var i=0;i<_e&&n&a(i);++i)le?q(e,t.mColors[i],t.mNumVertices):(t.mColors[i]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,De));t.mTexCoordsBuffers=[];for(var i=0;i<Le&&n&r(i);++i)if(t.mNumUVComponents[i]=N(e),le)q(e,t.mTextureCoords[i],t.mNumVertices);else{t.mTextureCoords[i]=[],t.mTexCoordsBuffers[i]=[];for(var o=0;o<t.mNumVertices;o++)t.mTexCoordsBuffers[i].push(k(e)),t.mTexCoordsBuffers[i].push(k(e)),k(e)}if(le)N(e);else{t.mFaces=[];t.mIndexArray=[];for(var s=0;s<t.mNumFaces;++s){var u=t.mFaces[s]=new c;u.mNumIndices=I(e),u.mIndices=[];for(var l=0;l<u.mNumIndices;++l)t.mNumVertices<65536?u.mIndices[l]=I(e):u.mIndices[l]=N(e);if(3===u.mNumIndices)t.mIndexArray.push(u.mIndices[0]),t.mIndexArray.push(u.mIndices[1]),t.mIndexArray.push(u.mIndices[2]);else{if(4!==u.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(u.mIndices[0]),t.mIndexArray.push(u.mIndices[1]),t.mIndexArray.push(u.mIndices[2]),t.mIndexArray.push(u.mIndices[2]),t.mIndexArray.push(u.mIndices[3]),t.mIndexArray.push(u.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(var l=0;l<t.mNumBones;++l)t.mBones[l]=new g,Z(e,t.mBones[l])}}function $(e,t){Q(O(e)==Re),O(e),t.mKey=D(e),t.mSemantic=N(e),t.mIndex=N(e),t.mDataLength=N(e),t.mType=N(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function ee(e,t){if(Q(O(e)==be),O(e),t.mNumAllocated=t.mNumProperties=N(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(var r=0;r<t.mNumProperties;++r)t.mProperties[r]=new y,$(e,t.mProperties[r])}}function te(e,t){Q(O(e)==Ee),O(e),t.mNodeName=D(e),t.mNumPositionKeys=N(e),t.mNumRotationKeys=N(e),t.mNumScalingKeys=N(e),t.mPreState=N(e),t.mPostState=N(e),t.mNumPositionKeys&&(le?q(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],W(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(le?q(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],Y(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(le?q(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],W(e,t.mScalingKeys,t.mNumScalingKeys)))}function re(e,t){if(Q(O(e)==ye),O(e),t.mName=D(e),t.mDuration=C(e),t.mTicksPerSecond=C(e),t.mNumChannels=N(e),t.mNumChannels){t.mChannels=[];for(var r=0;r<t.mNumChannels;++r)t.mChannels[r]=new w,te(e,t.mChannels[r])}}function ae(e,t){Q(O(e)==pe),O(e),t.mWidth=N(e),t.mHeight=N(e),e.ReadBytes(t.achFormatHint,1,4),le||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function ne(e,t){Q(O(e)==fe),O(e),t.mName=D(e),t.mType=N(e),t.mType!=Fe&&(t.mAttenuationConstant=k(e),t.mAttenuationLinear=k(e),t.mAttenuationQuadratic=k(e)),t.mColorDiffuse=P(e),t.mColorSpecular=P(e),t.mColorAmbient=P(e),t.mType==ke&&(t.mAngleInnerCone=k(e),t.mAngleOuterCone=k(e))}function ie(e,t){Q(O(e)==de),O(e),t.mName=D(e),t.mPosition=B(e),t.mLookAt=B(e),t.mUp=B(e),t.mHorizontalFOV=k(e),t.mClipPlaneNear=k(e),t.mClipPlaneFar=k(e),t.mAspect=k(e)}function oe(e,t){if(Q(O(e)==ve),O(e),t.mFlags=N(e),t.mNumMeshes=N(e),t.mNumMaterials=N(e),t.mNumAnimations=N(e),t.mNumTextures=N(e),t.mNumLights=N(e),t.mNumCameras=N(e),t.mRootNode=new v,t.mRootNode=X(e,null,0),t.mNumMeshes){t.mMeshes=[];for(var r=0;r<t.mNumMeshes;++r)t.mMeshes[r]=new u,J(e,t.mMeshes[r])}if(t.mNumMaterials){t.mMaterials=[];for(var r=0;r<t.mNumMaterials;++r)t.mMaterials[r]=new T,ee(e,t.mMaterials[r])}if(t.mNumAnimations){t.mAnimations=[];for(var r=0;r<t.mNumAnimations;++r)t.mAnimations[r]=new H,re(e,t.mAnimations[r])}if(t.mNumTextures){t.mTextures=[];for(var r=0;r<t.mNumTextures;++r)t.mTextures[r]=new x,ae(e,t.mTextures[r])}if(t.mNumLights){t.mLights=[];for(var r=0;r<t.mNumLights;++r)t.mLights[r]=new M,ne(e,t.mLights[r])}if(t.mNumCameras){t.mCameras=[];for(var r=0;r<t.mNumCameras;++r)t.mCameras[r]=new _,ie(e,t.mCameras[r])}}function se(e){e.readOffset=0,e.Seek=function(t,r){r==De&&(e.readOffset+=t),r==Ve&&(e.readOffset=t)},e.ReadBytes=function(e,t,r){for(var a=t*r,n=0;n<a;n++)e[n]=S(this)},e.subArray32=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Float32Array(a)},e.subArrayUint16=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Uint16Array(a)},e.subArrayUint8=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Uint8Array(a)},e.subArrayUint32=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Uint32Array(a)}}var ue=new THREE.TextureLoader(this.manager);ue.setPath(t).setCrossOrigin(this.crossOrigin);var ce={};ce.KeyFrame=function(e,t){this.time=e,this.matrix=t.clone(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new ce.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){t-=this.time;var r=e.time-this.time,a=t/r,n=1-a,i=this.position,o=this.quaternion,s=e.position,u=e.quaternion;return ce.KeyFrame.tempAniPos.x=i.x*n+s.x*a,ce.KeyFrame.tempAniPos.y=i.y*n+s.y*a,ce.KeyFrame.tempAniPos.z=i.z*n+s.z*a,ce.KeyFrame.tempAniQuat.set(o.x,o.y,o.z,o.w),ce.KeyFrame.tempAniQuat.slerp(u,a),ce.KeyFrame.tempAniMatrix.compose(ce.KeyFrame.tempAniPos,ce.KeyFrame.tempAniQuat,ce.KeyFrame.tempAniScale)}},ce.KeyFrame.tempAniPos=new THREE.Vector3,ce.KeyFrame.tempAniQuat=new THREE.Quaternion,ce.KeyFrame.tempAniScale=new THREE.Vector3(1,1,1),ce.KeyFrame.tempAniMatrix=new THREE.Matrix4,ce.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(var e=0;e<this.length*this.fps;e++)for(var t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;for(var r=e.hierarchy[0].keys,a=0;a<r.length;a++)this.addKey(new ce.KeyFrame(a/t||r[a].time,r[a].targets[0].data));this.init()},this.parseFromCollada=function(e){for(var t=e.keys,r=this.fps,a=0;a<t.length;a++)this.addKey(new ce.KeyFrame(a/r||t[a].time,t[a].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new ce.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(var t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=ce.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);for(var t=null,r=null,a=this.keySearchAccel(e);a<this.keys.length;a++){if(this.keys[a].time==e){t=this.keys[a],r=this.keys[a];break}if(this.keys[a].time<e&&this.keys[a+1]&&this.keys[a+1].time>e){t=this.keys[a],r=this.keys[a+1];break}if(this.keys[a].time<e&&a==this.keys.length-1){t=this.keys[a],r=this.keys[0].clone(),r.time+=this.length+.05;break}}return t&&r&&t!==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(r,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&r&&t==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},ce.TrackTargetNodeNameCompare=function(e,t){function r(e,t){if(e.name==t)return e;for(var a=0;a<e.children.length;a++){var n=r(e.children[a],t);if(n)return n}return null}return r(e,t.name)},ce.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=ce.TrackTargetNodeNameCompare);var r=new ce.Animation;r.target=e;for(var a=0;a<this.tracks.length;a++){var n=this.tracks[a].clone();n.reTarget(e,t),r.addTrack(n)}return r}};var le,he,de=4660,fe=4661,pe=4662,me=4663,Ee=4664,ve=4665,ge=4666,ye=4667,Te=4668,be=4669,Re=4670,Ae=1,we=2,He=4,xe=256,Me=65536,_e=1,Le=4,Fe=1,ke=3,Ce=1,Se=6,Ie=8,Ne=10,Oe=4,Be={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},Pe={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"},Ue=!0,De=0,Ve=1;return function(e){var t=new L,r=new DataView(e);se(r),r.Seek(44,De);N(r),N(r),N(r),N(r);if(le=I(r)>0,he=I(r)>0,le)throw"Shortened binaries are not supported!";if(r.Seek(256,De),r.Seek(128,De),r.Seek(64,De),!he)return oe(r,t),t.toTHREE();var a=O(r),n=r.FileSize()-r.Tell(),i=[];r.Read(i,1,n);var o=[];uncompress(o,a,i,n),oe(new ArrayBuffer(o),t)}(e)}}},function(e,t){!function(){function e(){this.id=0,this.data=null}function t(){}t.prototype={set:function(e,t){this[e]=t},get:function(e,t){return this.hasOwnProperty(e)?this[e]:t}},THREE.AWDLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.trunk=new THREE.Object3D,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new e],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1},THREE.AWDLoader.prototype={constructor:THREE.AWDLoader,load:function(e,t,r,a){var n=this;this._url=e,this._baseDir=e.substr(0,e.lastIndexOf("/")+1);var i=new THREE.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){var t=e.byteLength;for(this._ptr=0,this._data=new DataView(e),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==e.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,t-this._ptr);this._ptr<t;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,r,a,n,i=this.readU32(),r=(this.readU8(),this.readU8()),a=(this.readU8(),this.readU32());switch(r){case 1:t=this.parseMeshData(a);break;case 22:t=this.parseContainer(a);break;case 23:t=this.parseMeshInstance(a);break;case 81:t=this.parseMaterial(a);break;case 82:t=this.parseTexture(a);break;case 101:t=this.parseSkeleton(a);break;case 112:t=this.parseMeshPoseAnimation(a,!1);break;case 113:t=this.parseVertexAnimationSet(a);break;case 102:t=this.parseSkeletonPose(a);break;case 103:t=this.parseSkeletonAnimation(a);break;case 122:t=this.parseAnimatorSet(a);break;default:this._ptr+=a}this._blocks[i]=n=new e,n.data=t,n.id=i},_parseHeader:function(){var e=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");e[0]=this.readU8(),e[1]=this.readU8();var t=this.readU16();this._streaming=1==(1&t),2===e[0]&&1===e[1]&&(this._accuracyMatrix=2==(2&t),this._accuracyGeo=4==(4&t),this._accuracyProps=8==(8&t)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&t),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(e){var t,r=new THREE.Object3D,a=this.readU32(),n=this.parseMatrix4();return r.name=this.readUTF(),r.applyMatrix(n),t=this._blocks[a].data||this.trunk,t.add(r),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),r.extra=this.parseUserAttributes(),r},parseMeshInstance:function(e){var t,r,a,n,i,o,s,u,c,l,h,d,f,p;for(o=this.readU32(),u=this.parseMatrix4(),t=this.readUTF(),s=this.readU32(),d=this.readU16(),a=this.getBlock(s),c=[],p=0;p<d;p++)h=this.readU32(),l=this.getBlock(h),c.push(l);if(n=a.length,i=[],n>1)for(r=new THREE.Object3D,p=0;p<n;p++){var m=new THREE.Mesh(a[p]);i.push(m),r.add(m)}else r=new THREE.Mesh(a[0]),i.push(r);r.applyMatrix(u),r.name=t,f=this.getBlock(o)||this.trunk,f.add(r);var E=c.length,v=Math.max(n,E);for(p=0;p<v;p++)i[p%n].material=c[p%E];return this.parseProperties(null),r.extra=this.parseUserAttributes(),r},parseMaterial:function(e){var t,r,a,n,i,o,s;for(t=this.readUTF(),r=this.readU8(),o=this.readU8(),a=this.parseProperties({1:3,2:23,11:21,12:7,13:21}),s=0;s<o;){this.readU16();this.parseProperties(null),this.parseUserAttributes()}if(i=this.parseUserAttributes(),void 0!==this.materialFactory&&(n=this.materialFactory(t)))return n;if(n=new THREE.MeshPhongMaterial,1===r)n.color.setHex(a.get(1,13421772));else if(2===r){var u=a.get(2,0);n.map=this.getBlock(u)}return n.extra=i,n.alphaThreshold=a.get(12,0),n.repeat=a.get(13,!1),n},parseTexture:function(e){var t,r,a=(this.readUTF(),this.readU8());if(0===a){r=this.readU32();var n=this.readUTFBytes(r);console.log(n),t=this.loadTexture(n)}return this.parseProperties(null),this.parseUserAttributes(),t},loadTexture:function(e){var t=new THREE.Texture;return new THREE.ImageLoader(this.manager).load(this._baseDir+e,function(e){t.image=e,t.needsUpdate=!0}),t},parseSkeleton:function(e){var t=(this.readUTF(),this.readU16()),r=[],a=0;for(this.parseProperties(null);a<t;){var n,i;this.readU16(),n=new THREE.Bone,n.parent=this.readU16()-1,n.name=this.readUTF(),i=this.parseMatrix4(),n.skinMatrix=i,this.parseProperties(null),this.parseUserAttributes(),r.push(n),a++}return this.parseUserAttributes(),r},parseSkeletonPose:function(e){var t=(this.readUTF(),this.readU16());this.parseProperties(null);for(var r=[],a=0;a<t;){var n,i;n=this.readU8(),i=1===n?this.parseMatrix4():new THREE.Matrix4,r[a]=i,a++}return this.parseUserAttributes(),r},parseSkeletonAnimation:function(e){var t,r,a,n=(this.readUTF(),[]),i=this.readU16();this.parseProperties(null);for(var o=0;o<i;)r=this.readU32(),t=this.readU16(),a=this._blocks[r].data,n.push({pose:a,duration:t}),o++;if(0!==n.length)return this.parseUserAttributes(),n},parseVertexAnimationSet:function(e){for(var t,r=(this.readUTF(),this.readU16()),a=(this.parseProperties({1:5}),0),n=[];a<r;)t=this.readU32(),n.push(this._blocks[t].data),a++;return this.parseUserAttributes(),n},parseAnimatorSet:function(e){var t,r,a=(this.readUTF(),this.readU16()),n=this.parseProperties({1:23});t=this.readU32();for(var i=this.readU16(),o=[],s=0;s<i;s++)o.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var u=[];for(s=0;s<o.length;s++)u.push(this._blocks[o[s]].data);r=this._blocks[t].data;var c;for(1==a&&(c={animationSet:r,skeleton:this._blocks[n.get(1,0)].data}),s=0;s<u.length;s++)u[s].animator=c;return c},parseMeshData:function(e){var t,r,a=this.readUTF(),n=this.readU16(),i=0,o=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});i<n;){var s,u,c;for(t=new THREE.BufferGeometry,t.name=a,o.push(t),s=this.readU32(),u=this._ptr+s,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<u;){var l=0,h=this.readU8(),d=(this.readU8(),this.readU32()),f=d+this._ptr;if(1===h)for(r=new Float32Array(d/12*3),c=new THREE.BufferAttribute(r,3),t.addAttribute("position",c),l=0;this._ptr<f;)r[l]=-this.readF32(),r[l+1]=this.readF32(),r[l+2]=this.readF32(),l+=3;else if(2===h)for(r=new Uint16Array(d/2),c=new THREE.BufferAttribute(r,1),t.setIndex(c),l=0;this._ptr<f;)r[l+1]=this.readU16(),r[l]=this.readU16(),r[l+2]=this.readU16(),l+=3;else if(3===h)for(r=new Float32Array(d/8*2),c=new THREE.BufferAttribute(r,2),t.addAttribute("uv",c),l=0;this._ptr<f;)r[l]=this.readF32(),r[l+1]=1-this.readF32(),l+=2;else if(4===h)for(r=new Float32Array(d/12*3),c=new THREE.BufferAttribute(r,3),t.addAttribute("normal",c),l=0;this._ptr<f;)r[l]=-this.readF32(),r[l+1]=this.readF32(),r[l+2]=this.readF32(),l+=3;else this._ptr=f}this.parseUserAttributes(),t.computeBoundingSphere(),i++}return this.parseUserAttributes(),o},parseMeshPoseAnimation:function(e,t){var r,a,n,i,o,s,u,c,l,h=1,d=0,f={},p=[],m=(this.readUTF(),this.readU32()),E=this.getBlock(m);if(null===E)return void console.log("parseMeshPoseAnimation target mesh not found at:",m);for(s=E.geometry,s.morphTargets=[],t||(h=this.readU16()),r=this.readU16(),u=this.readU16(),c=0;c<u;)p.push(this.readU16()),c++;for(l=this.parseProperties({1:21,2:21}),f.looping=l.get(1,!0),f.stitchFinalFrame=l.get(2,!1),a=0;a<h;){for(this.readU16(),n=0;n<r;)for(c=0,i=this.readU32(),o=this._ptr+i;c<u;){if(1===p[c]){var v=new Float32Array(i/4);for(s.morphTargets.push({array:v}),d=0;this._ptr<o;)v[d]=this.readF32(),v[d+1]=this.readF32(),v[d+2]=this.readF32(),d+=3;n++}else this._ptr=o;c++}a++}return this.parseUserAttributes(),null},getBlock:function(e){return this._blocks[e].data},parseMatrix4:function(){var e=new THREE.Matrix4,t=e.elements;return t[0]=this.readF32(),t[1]=this.readF32(),t[2]=this.readF32(),t[3]=0,t[4]=this.readF32(),t[5]=this.readF32(),t[6]=this.readF32(),t[7]=0,t[8]=this.readF32(),t[9]=this.readF32(),t[10]=this.readF32(),t[11]=0,t[12]=-this.readF32(),t[13]=this.readF32(),t[14]=this.readF32(),t[15]=1,e},parseProperties:function(e){var r=this.readU32(),a=this._ptr+r,n=new t;if(e)for(;this._ptr<a;){var i,o=this.readU16(),s=this.readU32();e.hasOwnProperty(o)?(i=e[o],n.set(o,this.parseAttrValue(i,s))):this._ptr+=s}return n},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(e,t){var r,a;switch(e){case 1:r=1,a=this.readI8;break;case 2:r=2,a=this.readI16;break;case 3:r=4,a=this.readI32;break;case 21:case 4:r=1,a=this.readU8;break;case 5:r=2,a=this.readU16;break;case 6:case 23:r=4,a=this.readU32;break;case 7:r=4,a=this.readF32;break;case 8:r=8,a=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:r=8,a=this.readF64}if(r<t){var n,i,o;for(n=[],i=0,o=t/r;i<o;)n.push(a.call(this)),i++;return n}return a.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var e=this._data.getUint16(this._ptr,!0);return this._ptr+=2,e},readI16:function(){var e=this._data.getInt16(this._ptr,!0);return this._ptr+=2,e},readU32:function(){var e=this._data.getUint32(this._ptr,!0);return this._ptr+=4,e},readI32:function(){var e=this._data.getInt32(this._ptr,!0);return this._ptr+=4,e},readF32:function(){var e=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,e},readF64:function(){var e=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,e},readUTF:function(){var e=this.readU16();return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t=[],r=0;t.length<e;){var a=this._data.getUint8(this._ptr++,!0);if(a<128)t[r++]=String.fromCharCode(a);else if(a>191&&a<224){var n=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((31&a)<<6|63&n)}else{var n=this._data.getUint8(this._ptr++,!0),i=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((15&a)<<12|(63&n)<<6|63&i)}}return t.join("")}}}()},function(e,t){THREE.BabylonLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BabylonLoader.prototype={constructor:THREE.BabylonLoader,load:function(e,t,r,a){var n=this;new THREE.FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},r,a)},parse:function(e){function t(e){var t=new THREE.BufferGeometry,r=e.indices,a=e.positions,n=e.normals,i=e.uvs;t.setIndex(r);for(var o=2,s=a.length;o<s;o+=3)a[o]=-a[o];if(t.addAttribute("position",new THREE.Float32BufferAttribute(a,3)),n){for(var o=2,s=n.length;o<s;o+=3)n[o]=-n[o];t.addAttribute("normal",new THREE.Float32BufferAttribute(n,3))}i&&t.addAttribute("uv",new THREE.Float32BufferAttribute(i,2));var u=e.subMeshes;if(u)for(var o=0,s=u.length;o<s;o++){var c=u[o];t.addGroup(c.indexStart,c.indexCount)}return t}var r=function(e){for(var t={},r=0,a=e.materials.length;r<a;r++){var n=e.materials[r],i=new THREE.MeshPhongMaterial;i.name=n.name,i.color.fromArray(n.diffuse),i.emissive.fromArray(n.emissive),i.specular.fromArray(n.specular),i.shininess=n.specularPower,i.opacity=n.alpha,t[n.id]=i}if(e.multiMaterials)for(var r=0,a=e.multiMaterials.length;r<a;r++){var n=e.multiMaterials[r];console.warn("THREE.BabylonLoader: Multi materials not yet supported."),t[n.id]=new THREE.MeshPhongMaterial}return t}(e);return function(e,r){for(var a={},n=new THREE.Scene,i=e.cameras,o=0,s=i.length;o<s;o++){var u=i[o],c=new THREE.PerspectiveCamera(u.fov/Math.PI*180,1.33,u.minZ,u.maxZ);c.name=u.name,c.position.fromArray(u.position),u.rotation&&c.rotation.fromArray(u.rotation),a[u.id]=c}for(var l=e.lights,o=0,s=l.length;o<s;o++){var h,u=l[o];switch(u.type){case 0:h=new THREE.PointLight;break;case 1:h=new THREE.DirectionalLight;break;case 2:h=new THREE.SpotLight;break;case 3:h=new THREE.HemisphereLight}h.name=u.name,u.position&&h.position.set(u.position[0],u.position[1],-u.position[2]),h.color.fromArray(u.diffuse),u.groundColor&&h.groundColor.fromArray(u.groundColor),u.intensity&&(h.intensity=u.intensity),a[u.id]=h,n.add(h)}for(var d=e.meshes,o=0,s=d.length;o<s;o++){var f,u=d[o];if(u.indices){var p=t(u);f=new THREE.Mesh(p,r[u.materialId])}else f=new THREE.Group;f.name=u.name,f.position.set(u.position[0],u.position[1],-u.position[2]),f.rotation.fromArray(u.rotation),u.rotationQuaternion&&f.quaternion.fromArray(u.rotationQuaternion),f.scale.fromArray(u.scaling),u.parentId?a[u.parentId].add(f):n.add(f),a[u.id]=f}return n}(e,r)}}},function(e,t){THREE.BinaryLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.BinaryLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BinaryLoader.prototype={constructor:THREE.BinaryLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this.texturePath||THREE.LoaderUtils.extractUrlBase(e),i=this.binaryPath||THREE.LoaderUtils.extractUrlBase(e),o=this;new THREE.FileLoader(this.manager).load(e,function(e){var s=JSON.parse(e),u=i+s.buffers,c=new THREE.FileLoader(o.manager);c.setResponseType("arraybuffer"),c.load(u,function(e){o.parse(e,t,n,s.materials)},r,a)},r,a)},setBinaryPath:function(e){this.binaryPath=e},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t,r,a){var n=function(){function t(e){return e%4?4-e%4:0}function r(e,t,r){return THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function a(e,t){return new Uint8Array(e,t,1)[0]}function n(e,t){return new Uint32Array(e,t,1)[0]}function i(t,r){var a,n,i,o,s,u,c,l,h,d,f=new Uint32Array(e,r,3*t);for(a=0;a<t;a++)n=f[3*a],i=f[3*a+1],o=f[3*a+2],s=C[2*n],l=C[2*n+1],u=C[2*i],h=C[2*i+1],c=C[2*o],d=C[2*o+1],L.faceVertexUvs[0].push([new THREE.Vector2(s,l),new THREE.Vector2(u,h),new THREE.Vector2(c,d)])}function o(t,r){var a,n,i,o,s,u,c,l,h,d,f,p,m,E=new Uint32Array(e,r,4*t);for(a=0;a<t;a++)n=E[4*a],i=E[4*a+1],o=E[4*a+2],s=E[4*a+3],u=C[2*n],d=C[2*n+1],c=C[2*i],f=C[2*i+1],l=C[2*o],p=C[2*o+1],h=C[2*s],m=C[2*s+1],L.faceVertexUvs[0].push([new THREE.Vector2(u,d),new THREE.Vector2(c,f),new THREE.Vector2(h,m)]),L.faceVertexUvs[0].push([new THREE.Vector2(c,f),new THREE.Vector2(l,p),new THREE.Vector2(h,m)])}function s(t,r,a){var n,i,o,s,u,c=new Uint32Array(e,r,3*t),l=new Uint16Array(e,a,t);for(n=0;n<t;n++)i=c[3*n],o=c[3*n+1],s=c[3*n+2],u=l[n],L.faces.push(new THREE.Face3(i,o,s,null,null,u))}function u(t,r,a){var n,i,o,s,u,c,l=new Uint32Array(e,r,4*t),h=new Uint16Array(e,a,t);for(n=0;n<t;n++)i=l[4*n],o=l[4*n+1],s=l[4*n+2],u=l[4*n+3],c=h[n],L.faces.push(new THREE.Face3(i,o,u,null,null,c)),L.faces.push(new THREE.Face3(o,s,u,null,null,c))}function c(t,r,a,n){var i,o,s,u,c,l,h,d,f=new Uint32Array(e,r,3*t),p=new Uint32Array(e,a,3*t),m=new Uint16Array(e,n,t);for(i=0;i<t;i++){o=f[3*i],s=f[3*i+1],u=f[3*i+2],l=p[3*i],h=p[3*i+1],d=p[3*i+2],c=m[i];var E=k[3*l],v=k[3*l+1],g=k[3*l+2],y=k[3*h],T=k[3*h+1],b=k[3*h+2],R=k[3*d],A=k[3*d+1],w=k[3*d+2];L.faces.push(new THREE.Face3(o,s,u,[new THREE.Vector3(E,v,g),new THREE.Vector3(y,T,b),new THREE.Vector3(R,A,w)],null,c))}}function l(t,r,a,n){var i,o,s,u,c,l,h,d,f,p,m=new Uint32Array(e,r,4*t),E=new Uint32Array(e,a,4*t),v=new Uint16Array(e,n,t);for(i=0;i<t;i++){o=m[4*i],s=m[4*i+1],u=m[4*i+2],c=m[4*i+3],h=E[4*i],d=E[4*i+1],f=E[4*i+2],p=E[4*i+3],l=v[i];var g=k[3*h],y=k[3*h+1],T=k[3*h+2],b=k[3*d],R=k[3*d+1],A=k[3*d+2],w=k[3*f],H=k[3*f+1],x=k[3*f+2],M=k[3*p],_=k[3*p+1],F=k[3*p+2];L.faces.push(new THREE.Face3(o,s,c,[new THREE.Vector3(g,y,T),new THREE.Vector3(b,R,A),new THREE.Vector3(M,_,F)],null,l)),L.faces.push(new THREE.Face3(s,u,c,[new THREE.Vector3(b,R,A),new THREE.Vector3(w,H,x),new THREE.Vector3(M,_,F)],null,l))}}var h,d,f,p,m,E,v,g,y,T,b,R,A,w,H,x,M,_,L=this,F=0,k=[],C=[];THREE.Geometry.call(this),h=function(e,t){return{signature:r(e,t,12),header_bytes:a(e,t+12),vertex_coordinate_bytes:a(e,t+13),normal_coordinate_bytes:a(e,t+14),uv_coordinate_bytes:a(e,t+15),vertex_index_bytes:a(e,t+16),normal_index_bytes:a(e,t+17),uv_index_bytes:a(e,t+18),material_index_bytes:a(e,t+19),nvertices:n(e,t+20),nnormals:n(e,t+20+4),nuvs:n(e,t+20+8),ntri_flat:n(e,t+20+12),ntri_smooth:n(e,t+20+16),ntri_flat_uv:n(e,t+20+20),ntri_smooth_uv:n(e,t+20+24),nquad_flat:n(e,t+20+28),nquad_smooth:n(e,t+20+32),nquad_flat_uv:n(e,t+20+36),nquad_smooth_uv:n(e,t+20+40)}}(e,F),F+=h.header_bytes,T=3*h.vertex_index_bytes+h.material_index_bytes,b=4*h.vertex_index_bytes+h.material_index_bytes,R=h.ntri_flat*T,A=h.ntri_smooth*(T+3*h.normal_index_bytes),w=h.ntri_flat_uv*(T+3*h.uv_index_bytes),H=h.ntri_smooth_uv*(T+3*h.normal_index_bytes+3*h.uv_index_bytes),x=h.nquad_flat*b,M=h.nquad_smooth*(b+4*h.normal_index_bytes),_=h.nquad_flat_uv*(b+4*h.uv_index_bytes),F+=function(t){var r,a,n,i,o=h.nvertices,s=new Float32Array(e,t,3*o);for(r=0;r<o;r++)a=s[3*r],n=s[3*r+1],i=s[3*r+2],L.vertices.push(new THREE.Vector3(a,n,i));return 3*o*Float32Array.BYTES_PER_ELEMENT}(F),F+=function(t){var r=h.nnormals;if(r){var a,n,i,o,s=new Int8Array(e,t,3*r);for(a=0;a<r;a++)n=s[3*a],i=s[3*a+1],o=s[3*a+2],k.push(n/127,i/127,o/127)}return 3*r*Int8Array.BYTES_PER_ELEMENT}(F),F+=t(3*h.nnormals),F+=function(t){var r=h.nuvs;if(r){var a,n,i,o=new Float32Array(e,t,2*r);for(a=0;a<r;a++)n=o[2*a],i=o[2*a+1],C.push(n,i)}return 2*r*Float32Array.BYTES_PER_ELEMENT}(F),d=F,f=d+R+t(2*h.ntri_flat),p=f+A+t(2*h.ntri_smooth),m=p+w+t(2*h.ntri_flat_uv),E=m+H+t(2*h.ntri_smooth_uv),v=E+x+t(2*h.nquad_flat),g=v+M+t(2*h.nquad_smooth),y=g+_+t(2*h.nquad_flat_uv),function(e){var t=h.ntri_flat_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3;s(t,e,r+t*Uint32Array.BYTES_PER_ELEMENT*3),i(t,r)}}(p),function(e){var t=h.ntri_smooth_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3,a=r+t*Uint32Array.BYTES_PER_ELEMENT*3;c(t,e,r,a+t*Uint32Array.BYTES_PER_ELEMENT*3),i(t,a)}}(m),function(e){var t=h.nquad_flat_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4;u(t,e,r+t*Uint32Array.BYTES_PER_ELEMENT*4),o(t,r)}}(g),function(e){var t=h.nquad_smooth_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4,a=r+t*Uint32Array.BYTES_PER_ELEMENT*4;l(t,e,r,a+t*Uint32Array.BYTES_PER_ELEMENT*4),o(t,a)}}(y),function(e){var t=h.ntri_flat;t&&s(t,e,e+t*Uint32Array.BYTES_PER_ELEMENT*3)}(d),function(e){var t=h.ntri_smooth;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3;c(t,e,r,r+t*Uint32Array.BYTES_PER_ELEMENT*3)}}(f),function(e){var t=h.nquad_flat;t&&u(t,e,e+t*Uint32Array.BYTES_PER_ELEMENT*4)}(E),function(e){var t=h.nquad_smooth;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4;l(t,e,r,r+t*Uint32Array.BYTES_PER_ELEMENT*4)}}(v),this.computeFaceNormals()};n.prototype=Object.create(THREE.Geometry.prototype),n.prototype.constructor=n,t(new n,THREE.Loader.prototype.initMaterials(a,r,this.crossOrigin))}}},function(e,t){THREE.BVHLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.animateBonePositions=!0,this.animateBoneRotations=!0},THREE.BVHLoader.prototype={constructor:THREE.BVHLoader,load:function(e,t,r,a){var n=this;new THREE.FileLoader(n.manager).load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e,r,a){if("ENDSITE"!==a.type){var n={time:r,position:new THREE.Vector3,rotation:new THREE.Quaternion};a.frames.push(n);for(var i=new THREE.Quaternion,o=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),u=new THREE.Vector3(0,0,1),c=0;c<a.channels.length;c++)switch(a.channels[c]){case"Xposition":n.position.x=parseFloat(e.shift().trim());break;case"Yposition":n.position.y=parseFloat(e.shift().trim());break;case"Zposition":n.position.z=parseFloat(e.shift().trim());break;case"Xrotation":i.setFromAxisAngle(o,parseFloat(e.shift().trim())*Math.PI/180),n.rotation.multiply(i);break;case"Yrotation":i.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),n.rotation.multiply(i);break;case"Zrotation":i.setFromAxisAngle(u,parseFloat(e.shift().trim())*Math.PI/180),n.rotation.multiply(i);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(var c=0;c<a.children.length;c++)t(e,r,a.children[c])}}function r(e,t,a){var i={name:"",type:"",frames:[]};a.push(i);var o=t.split(/[\s]+/);"END"===o[0].toUpperCase()&&"SITE"===o[1].toUpperCase()?(i.type="ENDSITE",i.name="ENDSITE"):(i.name=o[1],i.type=o[0].toUpperCase()),"{"!==n(e)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),o=n(e).split(/[\s]+/),"OFFSET"!==o[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+o[0]),4!==o.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");var s=new THREE.Vector3(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));if((isNaN(s.x)||isNaN(s.y)||isNaN(s.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),i.offset=s,"ENDSITE"!==i.type){o=n(e).split(/[\s]+/),"CHANNELS"!==o[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");var u=parseInt(o[1]);i.channels=o.splice(2,u),i.children=[]}for(;;){var c=n(e);if("}"===c)return i;i.children.push(r(e,c,a))}}function a(e,t){var r=new THREE.Bone;if(t.push(r),r.position.add(e.offset),r.name=e.name,"ENDSITE"!==e.type)for(var n=0;n<e.children.length;n++)r.add(a(e.children[n],t));return r}function n(e){for(var t;0===(t=e.shift().trim()).length;);return t}var i=this,o=e.split(/[\r\n]+/g),s=function(e){"HIERARCHY"!==n(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");var a=[],i=r(e,n(e),a);"MOTION"!==n(e)&&console.error("THREE.BVHLoader: MOTION expected.");var o=n(e).split(/[\s]+/),s=parseInt(o[1]);isNaN(s)&&console.error("THREE.BVHLoader: Failed to read number of frames."),o=n(e).split(/[\s]+/);var u=parseFloat(o[2]);isNaN(u)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(var c=0;c<s;c++)o=n(e).split(/[\s]+/),t(o,c*u,i);return a}(o),u=[];a(s[0],u);var c=function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r];if("ENDSITE"!==a.type){for(var n=[],o=[],s=[],u=0;u<a.frames.length;u++){var c=a.frames[u];n.push(c.time),o.push(c.position.x+a.offset.x),o.push(c.position.y+a.offset.y),o.push(c.position.z+a.offset.z),s.push(c.rotation.x),s.push(c.rotation.y),s.push(c.rotation.z),s.push(c.rotation.w)}i.animateBonePositions&&t.push(new THREE.VectorKeyframeTrack(".bones["+a.name+"].position",n,o)),i.animateBoneRotations&&t.push(new THREE.QuaternionKeyframeTrack(".bones["+a.name+"].quaternion",n,s))}}return new THREE.AnimationClip("animation",-1,t)}(s);return{skeleton:new THREE.Skeleton(u),clip:c}}}},function(e,t){THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this,i=void 0===n.path?THREE.LoaderUtils.extractUrlBase(e):n.path;new THREE.FileLoader(n.manager).load(e,function(e){t(n.parse(e,i))},r,a)},setPath:function(e){this.path=e},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=[],a=e.childNodes,n=0,i=a.length;n<i;n++){var o=a[n];o.nodeName===t&&r.push(o)}return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=t[a];return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseFloat(t[a]);return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseInt(t[a]);return r}function o(e){return e.substring(1)}function s(){return"three_default_"+ut++}function u(e){return 0===Object.keys(e).length}function c(e){return void 0!==e?parseFloat(e.getAttribute("meter")):1}function l(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,a,n){var i=r(e,t)[0];if(void 0!==i)for(var o=r(i,a),s=0;s<o.length;s++)n(o[s])}function d(e,t){for(var r in e){e[r].build=t(e[r])}}function f(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function p(e){for(var t={sources:{},samplers:{},channels:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType){var i;switch(n.nodeName){case"source":i=n.getAttribute("id"),t.sources[i]=Ee(n);break;case"sampler":i=n.getAttribute("id"),t.samplers[i]=m(n);break;case"channel":i=n.getAttribute("target"),t.channels[i]=E(n);break;default:console.log(n)}}}ct.animations[e.getAttribute("id")]=t}function m(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var i=o(n.getAttribute("source")),s=n.getAttribute("semantic");t.inputs[s]=i}}return t}function E(e){var t={},r=e.getAttribute("target"),a=r.split("/"),n=a.shift(),i=a.shift(),s=-1!==i.indexOf("("),u=-1!==i.indexOf(".");if(u)a=i.split("."),i=a.shift(),t.member=a.shift();else if(s){var c=i.split("(");i=c.shift();for(var l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));t.indices=c}return t.id=n,t.sid=i,t.arraySyntax=s,t.memberSyntax=u,t.sampler=o(e.getAttribute("source")),t}function v(e){var t=[],r=e.channels,a=e.samplers,n=e.sources;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i],s=a[o.sampler],u=s.inputs.INPUT,c=s.inputs.OUTPUT,l=n[u],h=n[c],d=y(o,l,h);b(d,t)}return t}function g(e){return f(ct.animations[e],v)}function y(e,t,r){var a,n,i,o,s,u,c=ct.nodes[e.id],l=We(c.id),h=c.transforms[e.sid],d=c.matrix.clone().transpose(),f={};switch(h){case"matrix":for(i=0,o=t.array.length;i<o;i++)if(a=t.array[i],n=i*r.stride,void 0===f[a]&&(f[a]={}),!0===e.arraySyntax){var p=r.array[n],m=e.indices[0]+4*e.indices[1];f[a][m]=p}else for(s=0,u=r.stride;s<u;s++)f[a][s]=r.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var E=T(f,d);return{name:l.uuid,keyframes:E}}function T(e,t){function r(e,t){return e.time-t.time}var a=[];for(var n in e)a.push({time:parseFloat(n),value:e[n]});a.sort(r);for(var i=0;i<16;i++)R(a,i,t.elements[i]);return a}function b(e,t){for(var r=e.keyframes,a=e.name,n=[],i=[],o=[],s=[],u=0,c=r.length;u<c;u++){var l=r[u],h=l.time,d=l.value;$e.fromArray(d).transpose(),$e.decompose(Xe,Je,Ze),n.push(h),i.push(Xe.x,Xe.y,Xe.z),o.push(Je.x,Je.y,Je.z,Je.w),s.push(Ze.x,Ze.y,Ze.z)}return i.length>0&&t.push(new THREE.VectorKeyframeTrack(a+".position",n,i)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(a+".quaternion",n,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(a+".scale",n,s)),t}function R(e,t,r){var a,n,i,o=!0;for(n=0,i=e.length;n<i;n++)a=e[n],void 0===a.value[t]?a.value[t]=null:o=!1;if(!0===o)for(n=0,i=e.length;n<i;n++)a=e[n],a.value[t]=r;else A(e,t)}function A(e,t){for(var r,a,n=0,i=e.length;n<i;n++){var o=e[n];if(null===o.value[t]){if(r=w(e,n,t),a=H(e,n,t),null===r){o.value[t]=a.value[t];continue}if(null===a){o.value[t]=r.value[t];continue}x(o,r,a,t)}}}function w(e,t,r){for(;t>=0;){var a=e[t];if(null!==a.value[r])return a;t--}return null}function H(e,t,r){for(;t<e.length;){var a=e[t];if(null!==a.value[r])return a;t++}return null}function x(e,t,r,a){if(r.time-t.time==0)return void(e.value[a]=t.value[a]);e.value[a]=(e.time-t.time)*(r.value[a]-t.value[a])/(r.time-t.time)+t.value[a]}function M(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(o(n.getAttribute("url")))}}ct.clips[e.getAttribute("id")]=t}function _(e){for(var t=[],r=e.name,a=e.end-e.start||-1,n=e.animations,i=0,o=n.length;i<o;i++)for(var s=g(n[i]),u=0,c=s.length;u<c;u++)t.push(s[u]);return new THREE.AnimationClip(r,a,t)}function L(e){return f(ct.clips[e],_)}function F(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=o(n.getAttribute("source")),t.skin=k(n);break;case"morph":t.id=o(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}ct.controllers[e.getAttribute("id")]=t}function k(e){for(var t={sources:{}},r=0,a=e.childNodes.length;r<a;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(i.textContent);break;case"source":var o=i.getAttribute("id");t.sources[o]=Ee(i);break;case"joints":t.joints=C(i);break;case"vertex_weights":t.vertexWeights=S(i)}}return t}function C(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var i=n.getAttribute("semantic"),s=o(n.getAttribute("source"));t.inputs[i]=s}}return t}function S(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=n.getAttribute("semantic"),u=o(n.getAttribute("source")),c=parseInt(n.getAttribute("offset"));t.inputs[s]={id:u,offset:c};break;case"vcount":t.vcount=i(n.textContent);break;case"v":t.v=i(n.textContent)}}return t}function I(e){var t={id:e.id},r=ct.geometries[t.id];return void 0!==e.skin&&(t.skin=N(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function N(e){function t(e,t){return t.weight-e.weight}var r,a,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,s=e.vertexWeights,u=s.vcount,c=s.v,l=s.inputs.JOINT.offset,h=s.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],f=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[s.inputs.WEIGHT.id].array,m=0;for(r=0,n=u.length;r<n;r++){var E=u[r],v=[];for(a=0;a<E;a++){var g=c[m+l],y=c[m+h],T=p[y];v.push({index:g,weight:T}),m+=2}for(v.sort(t),a=0;a<4;a++){var b=v[a];void 0!==b?(i.indices.array.push(b.index),i.weights.array.push(b.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(i.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose(),r=0,n=d.array.length;r<n;r++){var R=d.array[r],A=(new THREE.Matrix4).fromArray(f.array,r*f.stride).transpose();i.joints.push({name:R,boneInverse:A})}return i}function O(e){return f(ct.controllers[e],I)}function B(e){var t={init_from:r(e,"init_from")[0].textContent};ct.images[e.getAttribute("id")]=t}function P(e){return void 0!==e.build?e.build:e.init_from}function U(e){return f(ct.images[e],P)}function D(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=V(n)}}ct.effects[e.getAttribute("id")]=t}function V(e){for(var t={surfaces:{},samplers:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":G(n,t);break;case"technique":t.technique=K(n);break;case"extra":t.extra=Z(n)}}return t}function G(e,t){for(var r=e.getAttribute("sid"),a=0,n=e.childNodes.length;a<n;a++){var i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[r]=j(i);break;case"sampler2D":t.samplers[r]=z(i)}}}function j(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function z(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function K(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=W(n)}}return t}function W(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":t[n.nodeName]=Y(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:Y(n)}}}return t}function Y(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=n(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:q(i)}}}return t}function q(e){for(var t={technique:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":Q(n,t)}}return t}function Q(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":X(n,t)}}}function X(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function Z(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=J(n)}}return t}function J(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent)}}return t}function $(e){return e}function ee(e){return f(ct.effects[e],$)}function te(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=o(n.getAttribute("url"))}}ct.materials[e.getAttribute("id")]=t}function re(e){function t(e){var t,r=a.profile.samplers[e.id];if(void 0!==r){t=U(a.profile.surfaces[r.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),t=U(e.id);if(void 0!==t){var n=it.load(t),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===u(i.technique)){var o=i.technique;n.wrapS=o.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=o.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.offset.set(o.offsetU||0,o.offsetV||0),n.repeat.set(o.repeatU||1,o.repeatV||1)}else n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping;return n}return console.error("THREE.ColladaLoader: Unable to load texture with ID:",e.id),null}var r,a=ee(e.url),n=a.profile.technique,i=a.profile.extra;switch(n.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}r.name=e.name;var o=n.parameters;for(var s in o){var c=o[s];switch(s){case"diffuse":c.color&&r.color.fromArray(c.color),c.texture&&(r.map=t(c.texture));break;case"specular":c.color&&r.specular&&r.specular.fromArray(c.color),c.texture&&(r.specularMap=t(c.texture));break;case"shininess":c.float&&r.shininess&&(r.shininess=c.float);break;case"emission":c.color&&r.emissive&&r.emissive.fromArray(c.color)}}var l=o.transparent,h=o.transparency;if(void 0===h&&l&&(h={float:1}),void 0===l&&h&&(l={opaque:"A_ONE",data:{color:[1,1,1,1]}}),l&&h)if(l.data.texture)r.alphaMap=t(l.data.texture),r.transparent=!0;else{var d=l.data.color;switch(l.opaque){case"A_ONE":r.opacity=d[3]*h.float;break;case"RGB_ZERO":r.opacity=1-d[0]*h.float;break;case"A_ZERO":r.opacity=1-d[3]*h.float;break;case"RGB_ONE":r.opacity=d[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',l.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(r.side=THREE.DoubleSide),r}function ae(e){return f(ct.materials[e],re)}function ne(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=ie(n)}}ct.cameras[e.getAttribute("id")]=t}function ie(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return oe(r)}}return{}}function oe(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"perspective":case"orthographic":t.technique=a.nodeName,t.parameters=se(a)}}return t}function se(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[a.nodeName]=parseFloat(a.textContent)}}return t}function ue(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,a=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;a=void 0===a?r*n:a,r=void 0===r?a/n:r,a*=.5,r*=.5,t=new THREE.OrthographicCamera(-a,a,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function ce(e){var t=ct.cameras[e];return void 0!==t?f(t,ue):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function le(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=he(n)}}ct.lights[e.getAttribute("id")]=t}function he(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=de(n)}}return t}function de(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":var o=n(i.textContent);t.color=(new THREE.Color).fromArray(o);break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":var s=parseFloat(i.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function fe(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function pe(e){var t=ct.lights[e];return void 0!==t?f(t,fe):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function me(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},a=r(e,"mesh")[0];if(void 0!==a){for(var n=0;n<a.childNodes.length;n++){var i=a.childNodes[n];if(1===i.nodeType){var o=i.getAttribute("id");switch(i.nodeName){case"source":t.sources[o]=Ee(i);break;case"vertices":t.vertices=ve(i);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",i.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ge(i));break;default:console.log(i)}}}ct.geometries[e.getAttribute("id")]=t}}function Ee(e){for(var t={array:[],stride:3},i=0;i<e.childNodes.length;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=n(o.textContent);break;case"Name_array":t.array=a(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ve(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];1===a.nodeType&&(t[a.getAttribute("semantic")]=o(a.getAttribute("source")))}return t}function ge(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=o(n.getAttribute("source")),u=n.getAttribute("semantic"),c=parseInt(n.getAttribute("offset"));t.inputs[u]={id:s,offset:c},t.stride=Math.max(t.stride,c+1);break;case"vcount":t.vcount=i(n.textContent);break;case"p":t.p=i(n.textContent)}}return t}function ye(e){for(var t={},r=0;r<e.length;r++){var a=e[r];void 0===t[a.type]&&(t[a.type]=[]),t[a.type].push(a)}return t}function Te(e){var t={},r=e.sources,a=e.vertices,n=e.primitives;if(0===n.length)return{};var i=ye(n);for(var o in i)t[o]=be(i[o],r,a);return t}function be(e,t,r){for(var a={},n={array:[],stride:0},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},u={array:[],stride:4},c={array:[],stride:4},l=new THREE.BufferGeometry,h=[],d=0,f=0,p=0;p<e.length;p++){var m=e[p],E=m.inputs,v=1;m.vcount&&4===m.vcount[0]&&(v=2),f="lines"===m.type||"linestrips"===m.type?2*m.count:3*m.count*v,l.addGroup(d,f,p),d+=f,m.material&&h.push(m.material);for(var g in E){var y=E[g];switch(g){case"VERTEX":for(var T in r){var b=r[T];switch(T){case"POSITION":Re(m,t[b],y.offset,n.array),n.stride=t[b].stride,t.skinWeights&&t.skinIndices&&(Re(m,t.skinIndices,y.offset,u.array),Re(m,t.skinWeights,y.offset,c.array));break;case"NORMAL":Re(m,t[b],y.offset,i.array),i.stride=t[b].stride;break;case"COLOR":Re(m,t[b],y.offset,s.array),s.stride=t[b].stride;break;case"TEXCOORD":Re(m,t[b],y.offset,o.array),o.stride=t[b].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',T)}}break;case"NORMAL":Re(m,t[y.id],y.offset,i.array),i.stride=t[y.id].stride;break;case"COLOR":Re(m,t[y.id],y.offset,s.array),s.stride=t[y.id].stride;break;case"TEXCOORD":Re(m,t[y.id],y.offset,o.array),o.stride=t[y.id].stride}}}return n.array.length>0&&l.addAttribute("position",new THREE.Float32BufferAttribute(n.array,n.stride)),i.array.length>0&&l.addAttribute("normal",new THREE.Float32BufferAttribute(i.array,i.stride)),s.array.length>0&&l.addAttribute("color",new THREE.Float32BufferAttribute(s.array,s.stride)),o.array.length>0&&l.addAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),u.array.length>0&&l.addAttribute("skinIndex",new THREE.Float32BufferAttribute(u.array,u.stride)),c.array.length>0&&l.addAttribute("skinWeight",new THREE.Float32BufferAttribute(c.array,c.stride)),a.data=l,a.type=e[0].type,a.materialKeys=h,a}function Re(e,t,r,a){function n(e){for(var t=i[e+r]*l,n=t+l;t<n;t++)a.push(c[t])}var i=e.p,o=e.stride,s=e.vcount,u=0,c=t.array,l=t.stride;if(void 0!==e.vcount){for(var h=0,d=0,f=s.length;d<f;d++){var p=s[d];if(4===p){var m=h+0*o,E=h+1*o,v=h+2*o,g=h+3*o;n(m),n(E),n(g),n(E),n(v),n(g)}else if(3===p){var m=h+0*o,E=h+1*o,v=h+2*o;n(m),n(E),n(v)}else u=Math.max(u,p);h+=o*p}u>0&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(var d=0,f=i.length;d<f;d+=o)n(d)}function Ae(e){return f(ct.geometries[e],Te)}function we(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"technique_common":Me(a,t)}}ct.kinematicsModels[e.getAttribute("id")]=t}function He(e){return void 0!==e.build?e.build:e}function xe(e){return f(ct.kinematicsModels[e],He)}function Me(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"joint":t.joints[a.getAttribute("sid")]=_e(a);break;case"link":t.links.push(Fe(a))}}}function _e(e){for(var t,r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"prismatic":case"revolute":t=Le(a)}}return t}function Le(e,t){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":var i=n(a.textContent);t.axis.fromArray(i);break;case"limits":var o=a.getElementsByTagName("max")[0],s=a.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function Fe(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"attachment_full":t.attachments.push(ke(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(Ce(a))}}return t}function ke(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"link":t.links.push(Fe(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(Ce(a))}}return t}function Ce(e){var t={type:e.nodeName},r=n(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.Math.degToRad(r[3])}return t}function Se(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ie(a))}}ct.kinematicsScenes[o(e.getAttribute("url"))]=t}function Ie(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":var n=a.getElementsByTagName("param")[0];t.axis=n.textContent;var i=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=i.substr(0,i.length-1)}}return t}function Ne(e){return void 0!==e.build?e.build:e}function Oe(e){return f(ct.kinematicsScenes[e],Ne)}function Be(e){for(var t=[],r=rt.querySelector('[id="'+e.id+'"]'),a=0;a<r.childNodes.length;a++){var i=r.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"matrix":var o=n(i.textContent),s=(new THREE.Matrix4).fromArray(o).transpose();t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:s});break;case"translate":case"scale":var o=n(i.textContent),u=(new THREE.Vector3).fromArray(o);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:u});break;case"rotate":var o=n(i.textContent),u=(new THREE.Vector3).fromArray(o),c=THREE.Math.degToRad(o[3]);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:u,angle:c})}}return t}function Pe(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var a=t[r];!1===a.hasAttribute("id")&&a.setAttribute("id",s())}}function Ue(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"node":t.nodes.push(a.getAttribute("id")),Ue(a);break;case"instance_camera":t.instanceCameras.push(o(a.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(De(a));break;case"instance_light":t.instanceLights.push(o(a.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(De(a));break;case"instance_node":t.instanceNodes.push(o(a.getAttribute("url")));break;case"matrix":var i=n(a.textContent);t.matrix.multiply($e.fromArray(i).transpose()),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":var i=n(a.textContent);et.fromArray(i),t.matrix.multiply($e.makeTranslation(et.x,et.y,et.z)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":var i=n(a.textContent),s=THREE.Math.degToRad(i[3]);t.matrix.multiply($e.makeRotationAxis(et.fromArray(i),s)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":var i=n(a.textContent);t.matrix.scale(et.fromArray(i)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return ct.nodes[t.id]=t,t}function De(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"bind_material":for(var n=a.getElementsByTagName("instance_material"),i=0;i<n.length;i++){var s=n[i],u=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[u]=o(c)}break;case"skeleton":t.skeletons.push(o(a.textContent))}}return t}function Ve(e,t){var r,a,n,i=[],o=[];for(r=0;r<e.length;r++){Ge(We(e[r]),t,i)}for(r=0;r<t.length;r++)for(a=0;a<i.length;a++)if(n=i[a],n.bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<i.length;r++)n=i[r],!1===n.processed&&(o.push(n),n.processed=!0);var s=[],u=[];for(r=0;r<o.length;r++)n=o[r],s.push(n.bone),u.push(n.boneInverse);return new THREE.Skeleton(s,u)}function Ge(e,t,r){e.traverse(function(e){if(!0===e.isBone){for(var a,n=0;n<t.length;n++){var i=t[n];if(i.name===e.name){a=i.boneInverse;break}}void 0===a&&(a=new THREE.Matrix4),r.push({bone:e,boneInverse:a,processed:!1})}})}function je(e){for(var t=[],r=e.matrix,a=e.nodes,n=e.type,i=e.instanceCameras,o=e.instanceControllers,s=e.instanceLights,u=e.instanceGeometries,c=e.instanceNodes,l=0,h=a.length;l<h;l++)t.push(We(a[l]));for(var l=0,h=i.length;l<h;l++){var d=ce(i[l]);null!==d&&t.push(d.clone())}for(var l=0,h=o.length;l<h;l++)for(var f=o[l],p=O(f.id),m=Ae(p.id),E=Ke(m,f.materials),v=f.skeletons,g=p.skin.joints,y=Ve(v,g),T=0,b=E.length;T<b;T++){var R=E[T];R.isSkinnedMesh&&(R.bind(y,p.skin.bindMatrix),R.normalizeSkinWeights()),t.push(R)}for(var l=0,h=s.length;l<h;l++){var A=pe(s[l]);null!==A&&t.push(A.clone())}for(var l=0,h=u.length;l<h;l++)for(var f=u[l],m=Ae(f.id),E=Ke(m,f.materials),T=0,b=E.length;T<b;T++)t.push(E[T]);for(var l=0,h=c.length;l<h;l++)t.push(We(c[l]).clone());var R;if(0===a.length&&1===t.length)R=t[0];else{R="JOINT"===n?new THREE.Bone:new THREE.Group;for(var l=0;l<t.length;l++)R.add(t[l])}return R.name="JOINT"===n?e.sid:e.name,R.matrix.copy(r),R.matrix.decompose(R.position,R.quaternion,R.scale),R}function ze(e,t){for(var r=[],a=0,n=e.length;a<n;a++){var i=t[e[a]];r.push(ae(i))}return r}function Ke(e,t){var r=[];for(var a in e){var n=e[a],i=ze(n.materialKeys,t);0===i.length&&("lines"===a||"linestrips"===a?i.push(new THREE.LineBasicMaterial):i.push(new THREE.MeshPhongMaterial));var o=void 0!==n.data.attributes.skinIndex;if(o)for(var s=0,u=i.length;s<u;s++)i[s].skinning=!0;var c,l=1===i.length?i[0]:i;switch(a){case"lines":c=new THREE.LineSegments(n.data,l);break;case"linestrips":c=new THREE.Line(n.data,l);break;case"triangles":case"polylist":c=o?new THREE.SkinnedMesh(n.data,l):new THREE.Mesh(n.data,l)}r.push(c)}return r}function We(e){return f(ct.nodes[e],je)}function Ye(e){var t={name:e.getAttribute("name"),children:[]};Pe(e);for(var a=r(e,"node"),n=0;n<a.length;n++)t.children.push(Ue(a[n]));ct.visualScenes[e.getAttribute("id")]=t}function qe(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,a=0;a<r.length;a++){var n=r[a];null===n.id?t.add(je(n)):t.add(We(n.id))}return t}function Qe(e){return f(ct.visualScenes[e],qe)}var Xe=new THREE.Vector3,Ze=new THREE.Vector3,Je=new THREE.Quaternion,$e=new THREE.Matrix4,et=new THREE.Vector3;if(console.time("THREE.ColladaLoader"),0===e.length)return{scene:new THREE.Scene};console.time("THREE.ColladaLoader: DOMParser");var tt=(new DOMParser).parseFromString(e,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var rt=r(tt,"COLLADA")[0],at=rt.getAttribute("version");console.log("THREE.ColladaLoader: File version",at);var nt=function(e){return{unit:c(r(e,"unit")[0]),upAxis:l(r(e,"up_axis")[0])}}(r(rt,"asset")[0]),it=new THREE.TextureLoader(this.manager);it.setPath(t).setCrossOrigin(this.crossOrigin);var ot=[],st={},ut=0,ct={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse"),h(rt,"library_animations","animation",p),h(rt,"library_animation_clips","animation_clip",M),h(rt,"library_controllers","controller",F),h(rt,"library_images","image",B),h(rt,"library_effects","effect",D),h(rt,"library_materials","material",te),h(rt,"library_cameras","camera",ne),h(rt,"library_lights","light",le),h(rt,"library_geometries","geometry",me),h(rt,"library_nodes","node",Ue),h(rt,"library_visual_scenes","visual_scene",Ye),h(rt,"library_kinematics_models","kinematics_model",we),h(rt,"scene","instance_kinematics_scene",Se),console.timeEnd("THREE.ColladaLoader: Parse"),console.time("THREE.ColladaLoader: Build"),d(ct.animations,v),d(ct.clips,_),d(ct.controllers,I),d(ct.images,P),d(ct.effects,$),d(ct.materials,re),d(ct.cameras,ue),d(ct.lights,fe),d(ct.geometries,Te),d(ct.visualScenes,qe),console.timeEnd("THREE.ColladaLoader: Build"),function(){var e=ct.clips;if(!0===u(e)){if(!1===u(ct.animations)){var t=[];for(var r in ct.animations)for(var a=g(r),n=0,i=a.length;n<i;n++)t.push(a[n]);ot.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)ot.push(L(r))}(),function(){var e=Object.keys(ct.kinematicsModels)[0],t=Object.keys(ct.kinematicsScenes)[0],r=Object.keys(ct.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var a=xe(e),n=Oe(t),i=Qe(r),o=n.bindJointAxis,s={},u=0,c=o.length;u<c;u++){var l=o[u],h=rt.querySelector('[sid="'+l.target+'"]');if(h){var d=h.parentElement;!function(e,t){var r=t.getAttribute("name"),n=a.joints[e];i.traverse(function(a){a.name===r&&(s[e]={object:a,transforms:Be(t),joint:n,position:n.zeroPosition})})}(l.jointIndex,d)}}var f=new THREE.Matrix4;st={joints:a&&a.joints,getJointValue:function(e){var t=s[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=s[e];if(r){var a=r.joint;if(t>a.limits.max||t<a.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+").");else if(a.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var n=r.object,i=a.axis,o=r.transforms;$e.identity();for(var u=0;u<o.length;u++){var c=o[u];if(c.sid&&-1!==c.sid.indexOf(e))switch(a.type){case"revolute":$e.multiply(f.makeRotationAxis(i,THREE.Math.degToRad(t)));break;case"prismatic":$e.multiply(f.makeTranslation(i.x*t,i.y*t,i.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+a.type)}else switch(c.type){case"matrix":$e.multiply(c.obj);break;case"translate":$e.multiply(f.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":$e.scale(c.obj);break;case"rotate":$e.multiply(f.makeRotationAxis(c.obj,c.angle))}}n.matrix.copy($e),n.matrix.decompose(n.position,n.quaternion,n.scale),s[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}}();var lt=function(e){return Qe(o(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(rt,"scene")[0]);return"Z_UP"===nt.upAxis&&(lt.rotation.x=-Math.PI/2),lt.scale.multiplyScalar(nt.unit),console.timeEnd("THREE.ColladaLoader"),{animations:ot,kinematics:st,library:ct,scene:lt}}}},function(e,t){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var a={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},n=r("DXT1"),i=r("DXT3"),o=r("DXT5"),s=r("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),a;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),a;var c,l=u[21],h=!1;switch(l){case n:c=8,a.format=THREE.RGB_S3TC_DXT1_Format;break;case i:c=16,a.format=THREE.RGBA_S3TC_DXT3_Format;break;case o:c=16,a.format=THREE.RGBA_S3TC_DXT5_Format;break;case s:c=8,a.format=THREE.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(l)),a;h=!0,c=64,a.format=THREE.RGBAFormat}a.mipmapCount=1,131072&u[2]&&!1!==t&&(a.mipmapCount=Math.max(1,u[7]));var d=u[28];if(a.isCubemap=!!(512&d),a.isCubemap&&(!(1024&d)||!(2048&d)||!(4096&d)||!(8192&d)||!(16384&d)||!(32768&d)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),a;a.width=u[4],a.height=u[3];for(var f=u[1]+4,p=a.isCubemap?6:1,m=0;m<p;m++)for(var E=a.width,v=a.height,g=0;g<a.mipmapCount;g++){if(h)var y=function(e,t,r,a){for(var n=r*a*4,i=new Uint8Array(e,t,n),o=new Uint8Array(n),s=0,u=0,c=0;c<a;c++)for(var l=0;l<r;l++){var h=i[u];u++;var d=i[u];u++;var f=i[u];u++;var p=i[u];u++,o[s]=f,s++,o[s]=d,s++,o[s]=h,s++,o[s]=p,s++}return o}(e,f,E,v),T=y.length;else var T=Math.max(4,E)/4*Math.max(4,v)/4*c,y=new Uint8Array(e,f,T);var b={data:y,width:E,height:v};a.mipmaps.push(b),f+=T,E=Math.max(E>>1,1),v=Math.max(v>>1,1)}return a}},function(e,t){!function(){function e(e){var t=new Map;if("Connections"in e){e.Connections.connections.forEach(function(e){var r=e[0],a=e[1],n=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var i={ID:a,relationship:n};t.get(r).parents.push(i),t.has(a)||t.set(a,{parents:[],children:[]});var o={ID:r,relationship:n};t.get(a).children.push(o)})}return t}function t(e){var t={},a={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var o=n[i],s=parseInt(i);if(t[s]=o.Filename,"Content"in o){var u=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c="string"==typeof o.Content&&""!==o.Content;if(u||c){var l=r(n[i]);a[o.Filename]=l}}}}for(var s in t){var h=t[s];void 0!==a[h]?t[s]=a[h]:t[s]=t[s].split("\\").pop()}return t}function r(e){var t,r=e.Content,a=e.RelativeFilename||e.Filename,n=a.slice(a.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var i=new Uint8Array(r);return window.URL.createObjectURL(new Blob([i],{type:t}))}function a(e,t,r,a){var i=new Map;if("Texture"in e.Objects){var o=e.Objects.Texture;for(var s in o){var u=n(o[s],t,r,a);i.set(parseInt(s),u)}}return i}function n(e,t,r,a){var n=i(e,t,r,a);n.ID=e.id,n.name=e.attrName;var o=e.WrapModeU,s=e.WrapModeV,u=void 0!==o?o.value:0,c=void 0!==s?s.value:0;if(n.wrapS=0===u?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=0===c?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n}function i(e,t,r,a){var n,i=t.path,o=a.get(e.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(n=r[o[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||t.setPath(void 0));var s=t.load(n);return t.setPath(i),s}function o(e,t,r){var a=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var o=s(e,n[i],t,r);null!==o&&a.set(parseInt(i),o)}}return a}function s(e,t,r,a){var n=t.id,i=t.attrName,o=t.ShadingModel;if("object"==typeof o&&(o=o.value),!a.has(n))return null;var s,c=u(e,t,r,n,a);switch(o.toLowerCase()){case"phong":s=new THREE.MeshPhongMaterial;break;case"lambert":s=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new THREE.MeshPhongMaterial({color:3342591})}return s.setValues(c),s.name=i,s}function u(e,t,r,a,n){var i={};return t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse&&(i.color=(new THREE.Color).fromArray(t.Diffuse.value)),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Specular&&(i.specular=(new THREE.Color).fromArray(t.Specular.value)),t.Shininess&&(i.shininess=t.Shininess.value),t.Emissive&&(i.emissive=(new THREE.Color).fromArray(t.Emissive.value)),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),n.get(a).children.forEach(function(t){var a=t.relationship;switch(a){case"Bump":i.bumpMap=r.get(t.ID);break;case"DiffuseColor":i.map=c(e,r,t.ID,n);break;case"DisplacementColor":i.displacementMap=c(e,r,t.ID,n);break;case"EmissiveColor":i.emissiveMap=c(e,r,t.ID,n);break;case"NormalMap":i.normalMap=c(e,r,t.ID,n);break;case"ReflectionColor":i.envMap=c(e,r,t.ID,n),i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=c(e,r,t.ID,n);break;case"TransparentColor":i.alphaMap=c(e,r,t.ID,n),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a)}}),i}function c(e,t,r,a){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=a.get(r).children[0].ID),t.get(r)}function l(e,t){var r={};if("Deformer"in e.Objects){var a=e.Objects.Deformer;for(var n in a){if("Skin"===a[n].attrType){var i=t.get(parseInt(n)),o=h(i,a);o.ID=n,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=i.parents[0].ID,r[n]=o}}}return r}function h(e,t){var r=[];return e.children.forEach(function(e){var a=t[e.ID];if("Cluster"===a.attrType){var n={ID:e.ID,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(a.Transform.a),transformLink:(new THREE.Matrix4).fromArray(a.TransformLink.a),linkMode:a.Mode};"Indexes"in a&&(n.indices=a.Indexes.a,n.weights=a.Weights.a),r.push(n)}}),{rawBones:r,bones:[]}}function d(e,t,r){var a=new Map;if("Geometry"in e.Objects){var n=e.Objects.Geometry;for(var i in n){var o=t.get(parseInt(i)),s=f(e,o,n[i],r);a.set(parseInt(i),s)}}return a}function f(e,t,r,a){switch(r.attrType){case"Mesh":return p(e,t,r,a);case"NurbsCurve":return b(r)}}function p(e,t,r,a){var n=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==n.length){var i=t.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null),o=new THREE.Matrix4,s=n[0];if("GeometricRotation"in s){var u=s.GeometricRotation.value.map(THREE.Math.degToRad);u[3]="ZYX",o.makeRotationFromEuler((new THREE.Euler).fromArray(u))}return"GeometricTranslation"in s&&o.setPosition((new THREE.Vector3).fromArray(s.GeometricTranslation.value)),m(e,t,r,i,o)}}function m(e,t,r,a,n){var i=r.Vertices.a,o=r.PolygonVertexIndex.a,s=[],u=[],c=[],l=[],h=[],d=[],f=[];if(r.LayerElementColor)var p=g(r.LayerElementColor[0]);if(r.LayerElementMaterial)var m=y(r.LayerElementMaterial[0]);if(r.LayerElementNormal)var b=E(r.LayerElementNormal[0]);if(r.LayerElementUV)for(var R=[],A=0;r.LayerElementUV[A];)R.push(v(r.LayerElementUV[A])),A++;var w={};null!==a&&a.rawBones.forEach(function(e,t){e.indices.forEach(function(r,a){void 0===w[r]&&(w[r]=[]),w[r].push({id:t,weight:e.weights[a]})})});var H=0,x=0,M=!1,_=[],L=[],F=[],k=[],C=[],S=[];o.forEach(function(e,t){var r=!1;e<0&&(e^=-1,o[t]=e,r=!0);var n=[],E=[];if(_.push(3*e,3*e+1,3*e+2),p){var v=T(t,H,e,p);F.push(v[0],v[1],v[2])}if(a){if(void 0!==w[e]&&w[e].forEach(function(e){E.push(e.weight),n.push(e.id)}),E.length>4){M||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),M=!0);var g=[0,0,0,0],y=[0,0,0,0];E.forEach(function(e,t){var r=e,a=n[t];y.forEach(function(e,t,n){if(r>e){n[t]=r,r=e;var i=g[t];g[t]=a,a=i}})}),n=g,E=y}for(;E.length<4;)E.push(0),n.push(0);for(var A=0;A<4;++A)C.push(E[A]),S.push(n[A])}if(b){var v=T(t,H,e,b);L.push(v[0],v[1],v[2])}if(m&&"AllSame"!==m.mappingType)var I=T(t,H,e,m)[0];if(R&&R.forEach(function(r,a){var n=T(t,H,e,r);void 0===k[a]&&(k[a]=[]),k[a].push(n[0]),k[a].push(n[1])}),x++,r){for(var A=2;A<x;A++)s.push(i[_[0]]),s.push(i[_[1]]),s.push(i[_[2]]),s.push(i[_[3*(A-1)]]),s.push(i[_[3*(A-1)+1]]),s.push(i[_[3*(A-1)+2]]),s.push(i[_[3*A]]),s.push(i[_[3*A+1]]),s.push(i[_[3*A+2]]),a&&(d.push(C[0]),d.push(C[1]),d.push(C[2]),d.push(C[3]),d.push(C[4*(A-1)]),d.push(C[4*(A-1)+1]),d.push(C[4*(A-1)+2]),d.push(C[4*(A-1)+3]),d.push(C[4*A]),d.push(C[4*A+1]),d.push(C[4*A+2]),d.push(C[4*A+3]),f.push(S[0]),f.push(S[1]),f.push(S[2]),f.push(S[3]),f.push(S[4*(A-1)]),f.push(S[4*(A-1)+1]),f.push(S[4*(A-1)+2]),f.push(S[4*(A-1)+3]),f.push(S[4*A]),f.push(S[4*A+1]),f.push(S[4*A+2]),f.push(S[4*A+3])),p&&(c.push(F[0]),c.push(F[1]),c.push(F[2]),c.push(F[3*(A-1)]),c.push(F[3*(A-1)+1]),c.push(F[3*(A-1)+2]),c.push(F[3*A]),c.push(F[3*A+1]),c.push(F[3*A+2])),m&&"AllSame"!==m.mappingType&&(h.push(I),h.push(I),h.push(I)),b&&(u.push(L[0]),u.push(L[1]),u.push(L[2]),u.push(L[3*(A-1)]),u.push(L[3*(A-1)+1]),u.push(L[3*(A-1)+2]),u.push(L[3*A]),u.push(L[3*A+1]),u.push(L[3*A+2])),R&&R.forEach(function(e,t){void 0===l[t]&&(l[t]=[]),l[t].push(k[t][0]),l[t].push(k[t][1]),l[t].push(k[t][2*(A-1)]),l[t].push(k[t][2*(A-1)+1]),l[t].push(k[t][2*A]),l[t].push(k[t][2*A+1])});H++,x=0,_=[],L=[],F=[],k=[],C=[],S=[]}});var I=new THREE.BufferGeometry;I.name=r.name;var N=new THREE.Float32BufferAttribute(s,3);if(n.applyToBufferAttribute(N),I.addAttribute("position",N),c.length>0&&I.addAttribute("color",new THREE.Float32BufferAttribute(c,3)),a&&(I.addAttribute("skinIndex",new THREE.Float32BufferAttribute(f,4)),I.addAttribute("skinWeight",new THREE.Float32BufferAttribute(d,4)),I.FBX_Deformer=a),u.length>0){var O=new THREE.Float32BufferAttribute(u,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(O),I.addAttribute("normal",O)}if(l.forEach(function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),I.addAttribute(r,new THREE.Float32BufferAttribute(l[t],2))}),m&&"AllSame"!==m.mappingType){var B=h[0],P=0;if(h.forEach(function(e,t){e!==B&&(I.addGroup(P,t-P,B),B=e,P=t)}),I.groups.length>0){var U=I.groups[I.groups.length-1],D=U.start+U.count;D!==h.length&&I.addGroup(D,h.length-D,B)}0===I.groups.length&&I.addGroup(0,h.length,h[0])}return I}function E(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:n,mappingType:t,referenceType:r}}function v(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:a,indices:n,mappingType:t,referenceType:r}}function g(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Colors.a,n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:a,indices:n,mappingType:t,referenceType:r}}function y(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var a=e.Materials.a,n=[],i=0;i<a.length;++i)n.push(i);return{dataSize:1,buffer:a,indices:n,mappingType:t,referenceType:r}}function T(e,t,r,a){return ie[a.mappingType][a.referenceType](e,t,r,a)}function b(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r=t-1,a=e.KnotVector.a,n=[],i=e.Points.a,o=0,s=i.length;o<s;o+=4)n.push((new THREE.Vector4).fromArray(i,o));var u,c;if("Closed"===e.Form)n.push(n[0]);else if("Periodic"===e.Form){u=r,c=a.length-1-u;for(var o=0;o<r;++o)n.push(n[o])}var l=new THREE.NURBSCurve(r,a,n,u,c),h=l.getPoints(7*n.length),d=new Float32Array(3*h.length);h.forEach(function(e,t){e.toArray(d,3*t)});var f=new THREE.BufferGeometry;return f.addAttribute("position",new THREE.BufferAttribute(d,3)),f}function R(e,t,r,a,n){var i=new THREE.Group,o=A(e,r,a,n,t),s=e.Objects.Model;return o.forEach(function(r){var a=s[r.ID];F(e,r,a,t,i),t.get(r.ID).parents.forEach(function(e){var t=o.get(e.ID);void 0!==t&&t.add(r)}),null===r.parent&&i.add(r)}),C(e,r,a,o,t),U(e,t,i),L(e,i),i}function A(e,t,r,a,n){var i=new Map,o=e.Objects.Model;for(var s in o){var u=parseInt(s),c=o[s],l=n.get(u),h=w(l,t,u,c.attrName);if(!h){switch(c.attrType){case"Camera":h=H(e,l);break;case"Light":h=x(e,l);break;case"Mesh":h=M(e,l,r,a);break;case"NurbsCurve":h=_(l,r);break;case"LimbNode":case"Null":default:h=new THREE.Group}h.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),h.ID=u}k(e,h,c),i.set(u,h)}return i}function w(e,t,r,a){var n=null;return e.parents.forEach(function(e){for(var i in t){var o=t[i];o.rawBones.forEach(function(t,i){if(t.ID===e.ID){var s=n;n=new THREE.Bone,n.matrixWorld.copy(t.transformLink),n.name=THREE.PropertyBinding.sanitizeNodeName(a),n.ID=r,o.bones[i]=n,null!==s&&n.add(s)}})}}),n}function H(e,t){var r,a;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(a=r)}),void 0===a)r=new THREE.Object3D;else{var n=0;void 0!==a.CameraProjectionType&&1===a.CameraProjectionType.value&&(n=1);var i=1;void 0!==a.NearPlane&&(i=a.NearPlane.value/1e3);var o=1e3;void 0!==a.FarPlane&&(o=a.FarPlane.value/1e3);var s=window.innerWidth,u=window.innerHeight;void 0!==a.AspectWidth&&void 0!==a.AspectHeight&&(s=a.AspectWidth.value,u=a.AspectHeight.value);var c=s/u,l=45;void 0!==a.FieldOfView&&(l=a.FieldOfView.value);var h=a.FocalLength?a.FocalLength.value:null;switch(n){case 0:r=new THREE.PerspectiveCamera(l,c,i,o),null!==h&&r.setFocalLength(h);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,u/2,-u/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),r=new THREE.Object3D}}return r}function x(e,t){var r,a;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(a=r)}),void 0===a)r=new THREE.Object3D;else{var n;n=void 0===a.LightType?0:a.LightType.value;var i=16777215;void 0!==a.Color&&(i=(new THREE.Color).fromArray(a.Color.value));var o=void 0===a.Intensity?1:a.Intensity.value/100;void 0!==a.CastLightOnObject&&0===a.CastLightOnObject.value&&(o=0);var s=0;void 0!==a.FarAttenuationEnd&&(s=void 0!==a.EnableFarAttenuation&&0===a.EnableFarAttenuation.value?0:a.FarAttenuationEnd.value/1e3);switch(n){case 0:r=new THREE.PointLight(i,o,s,1);break;case 1:r=new THREE.DirectionalLight(i,o);break;case 2:var u=Math.PI/3;void 0!==a.InnerAngle&&(u=THREE.Math.degToRad(a.InnerAngle.value));var c=0;void 0!==a.OuterAngle&&(c=THREE.Math.degToRad(a.OuterAngle.value),c=Math.max(c,1)),r=new THREE.SpotLight(i,o,s,u,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+a.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(i,o)}void 0!==a.CastShadows&&1===a.CastShadows.value&&(r.castShadow=!0)}return r}function M(e,t,r,a){var n,i=null,o=null,s=[];return t.children.forEach(function(e){r.has(e.ID)&&(i=r.get(e.ID)),a.has(e.ID)&&s.push(a.get(e.ID))}),s.length>1?o=s:s.length>0?o=s[0]:(o=new THREE.MeshPhongMaterial({color:13421772}),s.push(o)),"color"in i.attributes&&s.forEach(function(e){e.vertexColors=THREE.VertexColors}),i.FBX_Deformer?(s.forEach(function(e){e.skinning=!0}),n=new THREE.SkinnedMesh(i,o)):n=new THREE.Mesh(i,o),n}function _(e,t){var r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),a=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,a)}function L(e,t){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var r=e.GlobalSettings.AmbientColor.value,a=r[0],n=r[1],i=r[2];if(0!==a||0!==n||0!==i){var o=new THREE.Color(a,n,i);t.add(new THREE.AmbientLight(o,1))}}}function F(e,t,r,a,n){if("LookAtProperty"in r){a.get(t.ID).children.forEach(function(r){if("LookAtProperty"===r.relationship){var a=e.Objects.Model[r.ID];if("Lcl_Translation"in a){var i=a.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(i),n.add(t.target)):t.lookAt((new THREE.Vector3).fromArray(i))}}})}}function k(e,t,r){if("RotationOrder"in r){var a=["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"],n=parseInt(r.RotationOrder.value,10);n>0&&n<6?console.warn("THREE.FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",a[n]):6===n&&console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in r&&t.position.fromArray(r.Lcl_Translation.value),"Lcl_Rotation"in r){var i=r.Lcl_Rotation.value.map(THREE.Math.degToRad);i.push("ZYX"),t.rotation.fromArray(i)}if("Lcl_Scaling"in r&&t.scale.fromArray(r.Lcl_Scaling.value),"PreRotation"in r){var o=r.PreRotation.value.map(THREE.Math.degToRad);o[3]="ZYX";var s=(new THREE.Euler).fromArray(o);s=(new THREE.Quaternion).setFromEuler(s);var u=(new THREE.Quaternion).setFromEuler(t.rotation);s.multiply(u),t.rotation.setFromQuaternion(s,"ZYX")}}function C(e,t,r,a,n){var i=S(e);for(var o in t){var s=t[o];n.get(parseInt(s.ID)).parents.forEach(function(e){if(r.has(e.ID)){var t=e.ID;n.get(t).parents.forEach(function(e){if(a.has(e.ID)){a.get(e.ID).bind(new THREE.Skeleton(s.bones),i[e.ID])}})}})}}function S(e){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var a in r)if("BindPose"===r[a].attrType){var n=r[a].PoseNode;Array.isArray(n)?n.forEach(function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)}):t[n.Node]=(new THREE.Matrix4).fromArray(n.Matrix.a)}}return t}function I(e,t){if(void 0!==e.Objects.AnimationCurve){var r=N(e);O(e,t,r);return P(e,t,B(e,t,r))}}function N(e){var t=e.Objects.AnimationCurveNode,r=new Map;for(var a in t){var n=t[a];if(null!==n.attrName.match(/S|R|T/)){var i={id:n.id,attr:n.attrName,curves:{}};r.set(i.id,i)}}return r}function O(e,t,r){var a=e.Objects.AnimationCurve;for(var n in a){var i={id:a[n].id,times:a[n].KeyTime.a.map($),values:a[n].KeyValueFloat.a},o=t.get(i.id);if(void 0!==o){var s=o.parents[0].ID,u=o.parents[0].relationship,c="";if(u.match(/X/))c="x";else if(u.match(/Y/))c="y";else{if(!u.match(/Z/))continue;c="z"}r.get(s).curves[c]=i}}}function B(e,t,r){var a=e.Objects.AnimationLayer,n=new Map;for(var i in a){var o=[],s=t.get(parseInt(i));if(void 0!==s){s.children.forEach(function(a,n){if(r.has(a.ID)){var i=r.get(a.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===o[n]){var s;t.get(a.ID).parents.forEach(function(e){void 0!==e.relationship&&(s=e.ID)});var u=e.Objects.Model[s.toString()],c={modelName:THREE.PropertyBinding.sanitizeNodeName(u.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in u&&(c.initialPosition=u.Lcl_Translation.value),"Lcl_Rotation"in u&&(c.initialRotation=u.Lcl_Rotation.value),"Lcl_Scaling"in u&&(c.initialScale=u.Lcl_Scaling.value),"PreRotation"in u&&(c.preRotations=u.PreRotation.value),o[n]=c}o[n][i.attr]=i}}}),n.set(parseInt(i),o)}}return n}function P(e,t,r){var a=e.Objects.AnimationStack,n={};for(var i in a){var o=t.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);n[i]={name:a[i].attrName,layer:s}}return n}function U(e,t,r){r.animations=[];var a=I(e,t);if(void 0!==a)for(var n in a){var i=a[n],o=D(i);r.animations.push(o)}}function D(e){var t=[];return e.layer.forEach(function(e){t=t.concat(V(e))}),new THREE.AnimationClip(e.name,-1,t)}function V(e){var t=[];if(void 0!==e.T&&Object.keys(e.T.curves).length>0){var r=G(e.modelName,e.T.curves,e.initialPosition,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=j(e.modelName,e.R.curves,e.initialRotation,e.preRotations);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var n=G(e.modelName,e.S.curves,e.initialScale,"scale");void 0!==n&&t.push(n)}return t}function G(e,t,r,a){var n=K(t),i=z(n,t,r);return new THREE.VectorKeyframeTrack(e+"."+a,n,i)}function j(e,t,r,a){void 0!==t.x&&(t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(t.z.values=t.z.values.map(THREE.Math.degToRad));var n=K(t),i=z(n,t,r);void 0!==a&&(a=a.map(THREE.Math.degToRad),a.push("ZYX"),a=(new THREE.Euler).fromArray(a),a=(new THREE.Quaternion).setFromEuler(a));for(var o=new THREE.Quaternion,s=new THREE.Euler,u=[],c=0;c<i.length;c+=3)s.set(i[c],i[c+1],i[c+2],"ZYX"),o.setFromEuler(s),void 0!==a&&o.premultiply(a),o.toArray(u,c/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",n,u)}function z(e,t,r){var a=r,n=[],i=-1,o=-1,s=-1;return e.forEach(function(e){if(t.x&&(i=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==i){var r=t.x.values[i];n.push(r),a[0]=r}else n.push(a[0]);if(-1!==o){var u=t.y.values[o];n.push(u),a[1]=u}else n.push(a[1]);if(-1!==s){var c=t.z.values[s];n.push(c),a[2]=c}else n.push(a[2])}),n}function K(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,r){return r.indexOf(e)==t})}function W(){}function Y(){}function q(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function Q(){}function X(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===te(e,0,t.length)}function Z(e){for(var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0,a=0;a<t.length;++a){if(function(t){var a=e[t-1];return e=e.slice(r+t),r++,a}(1)===t[a])return!1}return!0}function J(e){var t=/FBXVersion: (\d+)/,r=e.match(t);if(r){return parseInt(r[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function $(e){return e/46186158e3}function ee(e){return e.split(",").map(function(e){return parseFloat(e)})}function te(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function re(e,t){for(var r=0,a=e.length,n=t.length;r<n;r++,a++)e[a]=t[r]}function ae(e,t,r,a){for(var n=r,i=0;n<a;n++,i++)e[i]=t[n];return e}THREE.FBXLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.FBXLoader.prototype,{load:function(e,t,r,a){var n=this,i=THREE.LoaderUtils.extractUrlBase(e),o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(r){try{var o=n.parse(r,i);t(o)}catch(t){window.setTimeout(function(){a&&a(t),n.manager.itemError(e)},0)}},r,a)},parse:function(r,n){var i;if(X(r))i=(new Y).parse(r);else{var s=te(r);if(!Z(s))throw new Error("THREE.FBXLoader: Unknown format.");if(J(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+J(s));i=(new W).parse(s)}var u=e(i),c=t(i),h=a(i,new THREE.TextureLoader(this.manager).setPath(n),c,u),f=o(i,h,u),p=l(i,u);return R(i,u,p,d(i,u,p),f)}});var ne=[],ie={ByPolygonVertex:{Direct:function(e,t,r,a){var n=e*a.dataSize,i=e*a.dataSize+a.dataSize;return ae(ne,a.buffer,n,i)},IndexToDirect:function(e,t,r,a){var n=a.indices[e],i=n*a.dataSize,o=n*a.dataSize+a.dataSize;return ae(ne,a.buffer,i,o)}},ByPolygon:{Direct:function(e,t,r,a){var n=t*a.dataSize,i=t*a.dataSize+a.dataSize;return ae(ne,a.buffer,n,i)},IndexToDirect:function(e,t,r,a){var n=a.indices[t],i=n*a.dataSize,o=n*a.dataSize+a.dataSize;return ae(ne,a.buffer,i,o)}},ByVertice:{Direct:function(e,t,r,a){var n=r*a.dataSize,i=r*a.dataSize+a.dataSize;return ae(ne,a.buffer,n,i)}},AllSame:{IndexToDirect:function(e,t,r,a){var n=a.indices[0]*a.dataSize,i=a.indices[0]*a.dataSize+a.dataSize;return ae(ne,a.buffer,n,i)}}};Object.assign(W.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new Q,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split("\n");return r.forEach(function(e,a){var n=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(!n&&!i){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++a]):u?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),a=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:r},i=this.parseNodeAttr(a),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in o?("PoseNode"===r?o.PoseNode.push(n):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==i.id&&(o[r][i.id]=n)):"number"==typeof i.id?(o[r]={},o[r][i.id]=n):"Properties70"!==r&&(o[r]="PoseNode"===r?[n]:n),"number"==typeof i.id&&(n.id=i.id),""!==i.name&&(n.attrName=i.name),""!==i.type&&(n.attrType=i.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",a="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:t,name:r,type:a}},parseNodeProperty:function(e,t,r){var a=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===a&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());var i=this.getCurrentNode();if("Properties70"===i.name)return void this.parseNodeSpecialProperty(e,a,n);if("C"===a){var o=n.split(",").slice(1),s=parseInt(o[0]),u=parseInt(o[1]),c=n.split(",").slice(3);c=c.map(function(e){return e.trim().replace(/^"/,"")}),a="connections",n=[s,u],re(n,c),void 0===i[a]&&(i[a]=[])}"Node"===a&&(i.id=n),a in i&&Array.isArray(i[a])?i[a].push(n):"a"!==a?i[a]=n:i.a=n,this.setCurrentProp(i,a),"a"===a&&","!==n.slice(-1)&&(i.a=ee(n))},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=ee(t.a))},parseNodeSpecialProperty:function(e,t,r){var a=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=a[0],i=a[1],o=a[2],s=a[3],u=a[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=ee(u)}this.getPrevNode()[n]={type:i,type2:o,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),n)}}),Object.assign(Y.prototype,{parse:function(e){var t=new q(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var a=new Q;!this.endOfContent(t);){var n=this.parseNode(t,r);null!==n&&a.add(n.name,n)}return a},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},a=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32(),i=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(i);if(0===a)return null;for(var s=[],u=0;u<n;u++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",l=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===n&&e.getOffset()===a;a>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,r,d)}return r.propertyList=s,"number"==typeof c&&(r.id=c),""!==l&&(r.attrName=l),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var a=r.propertyList[0];Array.isArray(a)?(t[r.name]=r,r.a=a):t[r.name]=a}else if("Connections"===e&&"C"===r.name){var n=[];r.propertyList.forEach(function(e,t){0!==t&&n.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(n)}else if("Properties70"===r.name){var i=Object.keys(r);i.forEach(function(e){t[e]=r[e]})}else if("Properties70"===e&&"P"===r.name){var o,s=r.propertyList[0],u=r.propertyList[1],c=r.propertyList[2],l=r.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===u.indexOf("Lcl ")&&(u=u.replace("Lcl ","Lcl_")),o="Color"===u||"ColorRGB"===u||"Vector"===u||"Vector3D"===u||0===u.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[s]={type:u,type2:c,flag:l,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":var r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var a=e.getUint32(),n=e.getUint32(),i=e.getUint32();if(0===n)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}void 0===window.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(i))),s=new q(o.decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(a);case"d":return s.getFloat64Array(a);case"f":return s.getFloat32Array(a);case"i":return s.getInt32Array(a);case"l":return s.getInt64Array(a)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}),Object.assign(q.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=new Uint8Array(e),r=0;r<e;r++)t[r]=this.getUint8();var a=t.indexOf(0);return a>=0&&(t=t.slice(0,a)),THREE.LoaderUtils.decodeText(t)}}),Object.assign(Q.prototype,{add:function(e,t){this[e]=t}})}()},function(e,t){THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}function r(e){this.name=f.KHR_LIGHTS,this.lights={};var t=e.extensions&&e.extensions[f.KHR_LIGHTS]||{},r=t.lights||{};for(var a in r){var n,i=r[a],o=(new THREE.Color).fromArray(i.color);switch(i.type){case"directional":n=new THREE.DirectionalLight(o),n.position.set(0,0,1);break;case"point":n=new THREE.PointLight(o);break;case"spot":n=new THREE.SpotLight(o),n.position.set(0,0,1);break;case"ambient":n=new THREE.AmbientLight(o)}n&&(void 0!==i.constantAttenuation&&(n.intensity=i.constantAttenuation),void 0!==i.linearAttenuation&&(n.distance=1/i.linearAttenuation),void 0!==i.quadraticAttenuation&&(n.decay=i.quadraticAttenuation),void 0!==i.fallOffAngle&&(n.angle=i.fallOffAngle),void 0!==i.fallOffExponent&&console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported."),n.name=i.name||"light_"+a,this.lights[a]=n)}}function a(e){this.name=f.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,m);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==p)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,m),a=0;a<r.byteLength;){var n=r.getUint32(a,!0);a+=4;var i=r.getUint32(a,!0);if(a+=4,i===E.JSON){var o=new Uint8Array(e,m+a,n);this.content=THREE.LoaderUtils.decodeText(o)}else if(i===E.BIN){var s=m+a;this.body=e.slice(s,s+n)}a+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function n(){return{name:f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var a=t.extensions[this.name],n=THREE.ShaderLib.standard,i=THREE.UniformsUtils.clone(n.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",l);delete i.roughness,delete i.metalness,delete i.roughnessMap,delete i.metalnessMap,i.specular={value:(new THREE.Color).setHex(1118481)},i.glossiness={value:.5},i.specularMap={value:null},i.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=i,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(a.diffuseFactor)){var f=a.diffuseFactor;e.color.fromArray(f),e.opacity=f[3]}if(void 0!==a.diffuseTexture&&d.push(r.assignTexture(e,"map",a.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var p=a.specularGlossinessTexture.index;d.push(r.assignTexture(e,"glossinessMap",p)),d.push(r.assignTexture(e,"specularMap",p))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,a=0,n=r.length;a<n;a++)t[r[a]]=e[r[a]];return t},refreshUniforms:function(e,t,r,a,n,i){if(!0===n.isGLTFSpecularGlossinessMaterial){var o=n.uniforms,s=n.defines;o.opacity.value=n.opacity,o.diffuse.value.copy(n.color),o.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),o.map.value=n.map,o.specularMap.value=n.specularMap,o.alphaMap.value=n.alphaMap,o.lightMap.value=n.lightMap,o.lightMapIntensity.value=n.lightMapIntensity,o.aoMap.value=n.aoMap,o.aoMapIntensity.value=n.aoMapIntensity;var u;if(n.map?u=n.map:n.specularMap?u=n.specularMap:n.displacementMap?u=n.displacementMap:n.normalMap?u=n.normalMap:n.bumpMap?u=n.bumpMap:n.glossinessMap?u=n.glossinessMap:n.alphaMap?u=n.alphaMap:n.emissiveMap&&(u=n.emissiveMap),void 0!==u){u.isWebGLRenderTarget&&(u=u.texture);var c,l;if(void 0!==u.matrix){if(!0===u.matrixAutoUpdate){c=u.offset,l=u.repeat;var h=u.rotation,d=u.center;u.matrix.setUvTransform(c.x,c.y,l.x,l.y,h,d.x,d.y)}o.uvTransform.value.copy(u.matrix)}else c=u.offset,l=u.repeat,o.offsetRepeat.value.set(c.x,c.y,l.x,l.y)}o.envMap.value=n.envMap,o.envMapIntensity.value=n.envMapIntensity,o.flipEnvMap.value=n.envMap&&n.envMap.isCubeTexture?-1:1,o.refractionRatio.value=n.refractionRatio,o.specular.value.copy(n.specular),o.glossiness.value=n.glossiness,o.glossinessMap.value=n.glossinessMap,o.emissiveMap.value=n.emissiveMap,o.bumpMap.value=n.bumpMap,o.normalMap.value=n.normalMap,o.displacementMap.value=n.displacementMap,o.displacementScale.value=n.displacementScale,o.displacementBias.value=n.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function i(e,t,r,a){THREE.Interpolant.call(this,e,t,r,a)}function o(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function s(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function u(e,t,r,a){var n=e.geometry,i=e.material,o=r.targets,s=n.morphAttributes;s.position=[],s.normal=[],i.morphTargets=!0;for(var u=0,c=o.length;u<c;u++){var l,d,f=o[u],p="morphTarget"+u;if(void 0!==f.POSITION){l=h(a[f.POSITION]);for(var m=n.attributes.position,E=0,v=l.count;E<v;E++)l.setXYZ(E,l.getX(E)+m.getX(E),l.getY(E)+m.getY(E),l.getZ(E)+m.getZ(E))}else n.attributes.position&&(l=h(n.attributes.position));if(void 0!==l&&(l.name=p,s.position.push(l)),void 0!==f.NORMAL){i.morphNormals=!0,d=h(a[f.NORMAL]);for(var g=n.attributes.normal,E=0,v=d.count;E<v;E++)d.setXYZ(E,d.getX(E)+g.getX(E),d.getY(E)+g.getY(E),d.getZ(E)+g.getZ(E))}else void 0!==n.attributes.normal&&(d=h(n.attributes.normal));void 0!==d&&(d.name=p,s.normal.push(d))}if(e.updateMorphTargets(),void 0!==t.weights)for(var u=0,c=t.weights.length;u<c;u++)e.morphTargetInfluences[u]=t.weights[u]}function c(e,t){if(e.indices!==t.indices)return!1;var r=e.attributes||{},a=t.attributes||{},n=Object.keys(r),i=Object.keys(a);if(n.length!==i.length)return!1;for(var o=0,s=n.length;o<s;o++){var u=n[o];if(r[u]!==a[u])return!1}return!0}function l(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r];if(c(n.primitive,t))return n.geometry}return null}function h(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,a=e.array.slice(0,t*r),n=0;n<t;++n)a[n]=e.getX(n),r>=2&&(a[n+1]=e.getY(n)),r>=3&&(a[n+2]=e.getZ(n)),r>=4&&(a[n+3]=e.getW(n));return new THREE.BufferAttribute(a,r,e.normalized)}return e.clone()}function d(e,r,a){this.json=e||{},this.extensions=r||{},this.options=a||{},this.cache=new t,this.primitiveCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this,i=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o=new THREE.FileLoader(n.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){try{n.parse(e,i,t,a)}catch(e){if(void 0===a)throw e;a(e)}},r,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},parse:function(e,t,i,o){var s,u={};if("string"==typeof e)s=e;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===p){try{u[f.KHR_BINARY_GLTF]=new a(e)}catch(e){return void(o&&o(e))}s=u[f.KHR_BINARY_GLTF].content}else s=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var c=JSON.parse(s);if(void 0===c.asset||c.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")));c.extensionsUsed&&(c.extensionsUsed.indexOf(f.KHR_LIGHTS)>=0&&(u[f.KHR_LIGHTS]=new r(c)),c.extensionsUsed.indexOf(f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(u[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new n)),console.time("GLTFLoader"),new d(c,u,{path:t||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(e,t,r,a,n){console.timeEnd("GLTFLoader"),i({scene:e,scenes:t,cameras:r,animations:a,asset:n})},o)}};var f={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"},p="glTF",m=12,E={JSON:1313821514,BIN:5130562};i.prototype=Object.create(THREE.Interpolant.prototype),i.prototype.constructor=i,i.prototype.interpolate_=function(e,t,r,a){for(var n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=2*o,u=3*o,c=a-t,l=(r-t)/c,h=l*l,d=h*l,f=e*u,p=f-u,m=2*d-3*h+1,E=d-2*h+l,v=-2*d+3*h,g=d-h,y=0;y!==o;y++){var T=i[p+y+o],b=i[p+y+s]*c,R=i[f+y+o],A=i[f+y]*c;n[y]=m*T+E*b+v*R+g*A}return n};var v={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},g=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),y={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},T={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},b={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},R={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},A=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),w={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},x={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};return d.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var a=t.scenes||[],n=a[r.scene||0],i=t.animations||[],o=r.asset,s=t.cameras||[];e(n,a,s,i,o)}).catch(t)},d.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a={},n={},i=0,o=t.length;i<o;i++)for(var s=t[i].joints,u=0,c=s.length;u<c;u++)e[s[u]].isBone=!0;for(var l=0,h=e.length;l<h;l++){var d=e[l];void 0!==d.mesh&&(void 0===a[d.mesh]&&(a[d.mesh]=n[d.mesh]=0),a[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=n},d.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){a=this["load"+e.charAt(0).toUpperCase()+e.slice(1)](t),this.cache.add(r,a)}return a},d.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(a.map(function(t,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t},d.prototype.getMultiDependencies=function(e){for(var t={},r=[],a=0,n=e.length;a<n;a++){var i=e[a],o=this.getDependencies(i);o=o.then(function(e,r){t[e]=r}.bind(this,i+("mesh"===i?"es":"s"))),r.push(o)}return Promise.all(r).then(function(){return t})},d.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[f.KHR_BINARY_GLTF].body);var a=this.options;return new Promise(function(e,n){r.load(o(t.uri,a.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},d.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+r)})},d.prototype.loadAccessor=function(e){var t=this,r=this.json,a=this.json.accessors[e],n=[];return void 0!==a.bufferView?n.push(this.getDependency("bufferView",a.bufferView)):n.push(null),void 0!==a.sparse&&(n.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,i,o=e[0],s=A[a.type],u=g[a.componentType],c=u.BYTES_PER_ELEMENT,l=c*s,h=a.byteOffset||0,d=r.bufferViews[a.bufferView].byteStride,f=!0===a.normalized;if(d&&d!==l){var p="InterleavedBuffer:"+a.bufferView+":"+a.componentType,m=t.cache.get(p);m||(n=new u(o),m=new THREE.InterleavedBuffer(n,d/c),t.cache.add(p,m)),i=new THREE.InterleavedBufferAttribute(m,s,h/c,f)}else n=null===o?new u(a.count*s):new u(o,h,a.count*s),i=new THREE.BufferAttribute(n,s,f);if(void 0!==a.sparse){var E=A.SCALAR,v=g[a.sparse.indices.componentType],y=a.sparse.indices.byteOffset||0,T=a.sparse.values.byteOffset||0,b=new v(e[1],y,a.sparse.count*E),R=new u(e[2],T,a.sparse.count*s);null!==o&&i.setArray(i.array.slice());for(var w=0,H=b.length;w<H;w++){var x=b[w];if(i.setX(x,R[w*s]),s>=2&&i.setY(x,R[w*s+1]),s>=3&&i.setZ(x,R[w*s+2]),s>=4&&i.setW(x,R[w*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i})},d.prototype.loadTexture=function(e){var t=this,r=this.json,a=this.options,n=this.textureLoader,i=window.URL||window.webkitURL,s=r.textures[e],u=r.images[s.source],c=u.uri,l=!1;return void 0!==u.bufferView&&(c=t.getDependency("bufferView",u.bufferView).then(function(e){l=!0;var t=new Blob([e],{type:u.mimeType});return c=i.createObjectURL(t)})),Promise.resolve(c).then(function(e){var t=THREE.Loader.Handlers.get(e)||n;return new Promise(function(r,n){t.load(o(e,a.path),r,void 0,n)})}).then(function(e){!0===l&&i.revokeObjectURL(c),e.flipY=!1,void 0!==s.name&&(e.name=s.name),e.format=void 0!==s.format?b[s.format]:THREE.RGBAFormat,void 0!==s.internalFormat&&e.format!==b[s.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==s.type?R[s.type]:THREE.UnsignedByteType;var t=r.samplers||{},a=t[s.sampler]||{};return e.magFilter=y[a.magFilter]||THREE.LinearFilter,e.minFilter=y[a.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=T[a.wrapS]||THREE.RepeatWrapping,e.wrapT=T[a.wrapT]||THREE.RepeatWrapping,e})},d.prototype.assignTexture=function(e,t,r){return this.getDependency("texture",r).then(function(r){e[t]=r})},d.prototype.loadMaterial=function(e){var t,r=this,a=(this.json,this.extensions),n=this.json.materials[e],i={},o=n.extensions||{},s=[];if(o[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=a[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(n),s.push(u.extendParams(i,n,r))}else if(void 0!==n.pbrMetallicRoughness){t=THREE.MeshStandardMaterial;var c=n.pbrMetallicRoughness;if(i.color=new THREE.Color(1,1,1),i.opacity=1,Array.isArray(c.baseColorFactor)){var l=c.baseColorFactor;i.color.fromArray(l),i.opacity=l[3]}if(void 0!==c.baseColorTexture&&s.push(r.assignTexture(i,"map",c.baseColorTexture.index)),i.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,i.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture){var h=c.metallicRoughnessTexture.index;s.push(r.assignTexture(i,"metalnessMap",h)),s.push(r.assignTexture(i,"roughnessMap",h))}}else t=THREE.MeshPhongMaterial;!0===n.doubleSided&&(i.side=THREE.DoubleSide);var d=n.alphaMode||x.OPAQUE;return d===x.BLEND?i.transparent=!0:(i.transparent=!1,d===x.MASK&&(i.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&(s.push(r.assignTexture(i,"normalMap",n.normalTexture.index)),i.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&i.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&(s.push(r.assignTexture(i,"aoMap",n.occlusionTexture.index)),void 0!==n.occlusionTexture.strength&&(i.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&(t===THREE.MeshBasicMaterial?i.color=(new THREE.Color).fromArray(n.emissiveFactor):i.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&(t===THREE.MeshBasicMaterial?s.push(r.assignTexture(i,"map",n.emissiveTexture.index)):s.push(r.assignTexture(i,"emissiveMap",n.emissiveTexture.index))),Promise.all(s).then(function(){var e;return e=t===THREE.ShaderMaterial?a[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new t(i),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.x=-e.normalScale.x),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),n.extras&&(e.userData=n.extras),e})},d.prototype.loadGeometries=function(e){var t=this.primitiveCache;return this.getDependencies("accessor").then(function(r){for(var a=[],n=0,i=e.length;n<i;n++){var o=e[n],s=l(t,o);if(s)a.push(s);else{var u=new THREE.BufferGeometry,c=o.attributes;for(var h in c){var d=c[h],f=r[d];switch(h){case"POSITION":u.addAttribute("position",f);break;case"NORMAL":u.addAttribute("normal",f);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":u.addAttribute("uv",f);break;case"TEXCOORD_1":u.addAttribute("uv2",f);break;case"COLOR_0":case"COLOR0":case"COLOR":u.addAttribute("color",f);break;case"WEIGHTS_0":case"WEIGHT":u.addAttribute("skinWeight",f);break;case"JOINTS_0":case"JOINT":u.addAttribute("skinIndex",f)}}void 0!==o.indices&&u.setIndex(r[o.indices]),t.push({primitive:o,geometry:u}),a.push(u)}}return a})},d.prototype.loadMesh=function(e){var t=this,r=(this.json,this.extensions),a=this.json.meshes[e];return this.getMultiDependencies(["accessor","material"]).then(function(n){var i=new THREE.Group,o=a.primitives;return t.loadGeometries(o).then(function(c){for(var l=0,h=o.length;l<h;l++){var d=o[l],p=c[l],m=void 0===d.material?s():n.materials[d.material];m.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new THREE.BufferAttribute(p.attributes.uv.array,2)));var E=void 0!==p.attributes.color,g=void 0===p.attributes.normal,y=!0===a.isSkinnedMesh,T=void 0!==d.targets;if(E||g||y||T)if(m.isGLTFSpecularGlossinessMaterial){var b=r[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];m=b.cloneMaterial(m)}else m=m.clone();E&&(m.vertexColors=THREE.VertexColors,m.needsUpdate=!0),g&&(m.flatShading=!0);var R;if(d.mode===v.TRIANGLES||d.mode===v.TRIANGLE_STRIP||d.mode===v.TRIANGLE_FAN||void 0===d.mode)y?(R=new THREE.SkinnedMesh(p,m),m.skinning=!0):R=new THREE.Mesh(p,m),d.mode===v.TRIANGLE_STRIP?R.drawMode=THREE.TriangleStripDrawMode:d.mode===v.TRIANGLE_FAN&&(R.drawMode=THREE.TriangleFanDrawMode);else if(d.mode===v.LINES||d.mode===v.LINE_STRIP||d.mode===v.LINE_LOOP){var A="LineBasicMaterial:"+m.uuid,w=t.cache.get(A);w||(w=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(w,m),w.color.copy(m.color),w.lights=!1,t.cache.add(A,w)),m=w,R=d.mode===v.LINES?new THREE.LineSegments(p,m):d.mode===v.LINE_STRIP?new THREE.Line(p,m):new THREE.LineLoop(p,m)}else{if(d.mode!==v.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);var A="PointsMaterial:"+m.uuid,H=t.cache.get(A);H||(H=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(H,m),H.color.copy(m.color),H.map=m.map,H.lights=!1,t.cache.add(A,H)),m=H,R=new THREE.Points(p,m)}if(R.name=a.name||"mesh_"+e,T&&u(R,a,d,n.accessors),void 0!==a.extras&&(R.userData=a.extras),void 0!==d.extras&&(R.geometry.userData=d.extras),!0===m.isGLTFSpecularGlossinessMaterial&&(R.onBeforeRender=r[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(o.length>1))return R;R.name+="_"+l,i.add(R)}return i})})},d.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],a=r[r.type];if(!a)return void console.warn("THREE.GLTFLoader: Missing camera parameters.");if("perspective"===r.type){var n=a.aspectRatio||1,i=a.yfov*n;t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i),n,a.znear||1,a.zfar||2e6)}else"orthographic"===r.type&&(t=new THREE.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar));return void 0!==r.name&&(t.name=r.name),r.extras&&(t.userData=r.extras),Promise.resolve(t)},d.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},d.prototype.loadAnimation=function(e){var t=(this.json,this.json.animations[e]);return this.getMultiDependencies(["accessor","node"]).then(function(r){for(var a=[],n=0,o=t.channels.length;n<o;n++){var s=t.channels[n],u=t.samplers[s.sampler];if(u){var c=s.target,l=void 0!==c.node?c.node:c.id,h=void 0!==t.parameters?t.parameters[u.input]:u.input,d=void 0!==t.parameters?t.parameters[u.output]:u.output,f=r.accessors[h],p=r.accessors[d],m=r.nodes[l];if(m){m.updateMatrix(),m.matrixAutoUpdate=!0;var E;switch(w[c.path]){case w.weights:E=THREE.NumberKeyframeTrack;break;case w.rotation:E=THREE.QuaternionKeyframeTrack;break;case w.position:case w.scale:default:E=THREE.VectorKeyframeTrack}var v=m.name?m.name:m.uuid,g=void 0!==u.interpolation?H[u.interpolation]:THREE.InterpolateLinear,y=[];w[c.path]===w.weights?m.traverse(function(e){!0===e.isMesh&&!0===e.material.morphTargets&&y.push(e.name?e.name:e.uuid)}):y.push(v);for(var T=0,b=y.length;T<b;T++){var R=new E(y[T]+"."+w[c.path],THREE.AnimationUtils.arraySlice(f.array,0),THREE.AnimationUtils.arraySlice(p.array,0),g);"CUBICSPLINE"===u.interpolation&&(R.createInterpolant=function(e){return new i(this.times,this.values,this.getValueSize()/3,e)}),a.push(R)}}}}var l=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(l,void 0,a)})},d.prototype.loadNode=function(e){var t=(this.json,this.extensions),r=this.json.meshReferences,a=this.json.meshUses,n=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(e){var i;if(!0===n.isBone)i=new THREE.Bone;else if(void 0!==n.mesh){var o=e.meshes[n.mesh];if(i=o.clone(),!0===o.isGroup)for(var s=0,u=o.children.length;s<u;s++){var c=o.children[s];c.material&&!0===c.material.isGLTFSpecularGlossinessMaterial&&(i.children[s].onBeforeRender=c.onBeforeRender)}else o.material&&!0===o.material.isGLTFSpecularGlossinessMaterial&&(i.onBeforeRender=o.onBeforeRender);r[n.mesh]>1&&(i.name+="_instance_"+a[n.mesh]++)}else if(void 0!==n.camera)i=e.cameras[n.camera];else if(n.extensions&&n.extensions[f.KHR_LIGHTS]&&void 0!==n.extensions[f.KHR_LIGHTS].light){var l=t[f.KHR_LIGHTS].lights;i=l[n.extensions[f.KHR_LIGHTS].light]}else i=new THREE.Object3D;if(void 0!==n.name&&(i.name=THREE.PropertyBinding.sanitizeNodeName(n.name)),n.extras&&(i.userData=n.extras),void 0!==n.matrix){var h=new THREE.Matrix4;h.fromArray(n.matrix),i.applyMatrix(h)}else void 0!==n.translation&&i.position.fromArray(n.translation),void 0!==n.rotation&&i.quaternion.fromArray(n.rotation),void 0!==n.scale&&i.scale.fromArray(n.scale);return i})},d.prototype.loadScene=function(){function e(t,r,a,n,i){var o=n[t],s=a.nodes[t];if(void 0!==s.skin)for(var u=!0===o.isGroup?o.children:[o],c=0,l=u.length;c<l;c++){for(var h=u[c],d=i[s.skin],f=[],p=[],m=0,E=d.joints.length;m<E;m++){var v=d.joints[m],g=n[v];if(g){f.push(g);var y=new THREE.Matrix4;void 0!==d.inverseBindMatrices&&y.fromArray(d.inverseBindMatrices.array,16*m),p.push(y)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',v)}h.bind(new THREE.Skeleton(f,p),h.matrixWorld)}if(r.add(o),s.children)for(var T=s.children,c=0,l=T.length;c<l;c++){var b=T[c];e(b,o,a,n,i)}}return function(t){var r=this.json,a=this.extensions,n=this.json.scenes[t];return this.getMultiDependencies(["node","skin"]).then(function(t){var i=new THREE.Scene;void 0!==n.name&&(i.name=n.name),n.extras&&(i.userData=n.extras);for(var o=n.nodes||[],s=0,u=o.length;s<u;s++)e(o[s],i,r,t.nodes,t.skins);if(n.extensions&&n.extensions[f.KHR_LIGHTS]&&void 0!==n.extensions[f.KHR_LIGHTS].light){var c=a[f.KHR_LIGHTS].lights;i.add(c[n.extensions[f.KHR_LIGHTS].light])}return i})}}(),e}()},function(e,t){THREE.HDRCubeTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.hdrLoader=new THREE.RGBELoader},THREE.HDRCubeTextureLoader.prototype.load=function(e,t,r,a,n){var i=function(e,t,r,a){var n=e[t+3],i=Math.pow(2,n-128)/255;r[a+0]=e[t+0]*i,r[a+1]=e[t+1]*i,r[a+2]=e[t+2]*i},o=function(){function e(e){t[0]=e;var a=r[0],n=a>>16&32768,i=a>>12&2047,o=a>>23&255;return o<103?n:o>142?(n|=31744,n|=(255==o?0:1)&&8388607&a):o<113?(i|=2048,n|=(i>>114-o)+(i>>113-o&1)):(n|=o-112<<10|i>>1,n+=1&i)}var t=new Float32Array(1),r=new Int32Array(t.buffer);return function(t,r,a,n){var i=t[r+3],o=Math.pow(2,i-128)/255;a[n+0]=e(t[r+0]*o),a[n+1]=e(t[r+1]*o),a[n+2]=e(t[r+2]*o)}}(),s=new THREE.CubeTexture;s.type=e,s.encoding=e===THREE.UnsignedByteType?THREE.RGBEEncoding:THREE.LinearEncoding,s.format=e===THREE.UnsignedByteType?THREE.RGBAFormat:THREE.RGBFormat,s.minFilter=s.encoding===THREE.RGBEEncoding?THREE.NearestFilter:THREE.LinearFilter,s.magFilter=s.encoding===THREE.RGBEEncoding?THREE.NearestFilter:THREE.LinearFilter,s.generateMipmaps=s.encoding!==THREE.RGBEEncoding,s.anisotropy=0;for(var u=this.hdrLoader,c=0,l=0;l<t.length;l++)!function(r,a,n,l){var h=new THREE.FileLoader(this.manager);h.setResponseType("arraybuffer"),h.load(t[r],function(t){c++;var n=u._parser(t);if(n){if(e===THREE.FloatType){for(var l=n.data.length/4*3,h=new Float32Array(l),d=0;d<l;d++)i(n.data,4*d,h,3*d);n.data=h}else if(e===THREE.HalfFloatType){for(var l=n.data.length/4*3,f=new Uint16Array(l),d=0;d<l;d++)o(n.data,4*d,f,3*d);n.data=f}if(void 0!==n.image)s[r].images=n.image;else if(void 0!==n.data){var p=new THREE.DataTexture(n.data,n.width,n.height);p.format=s.format,p.type=s.type,p.encoding=s.encoding,p.minFilter=s.minFilter,p.magFilter=s.magFilter,p.generateMipmaps=s.generateMipmaps,s.images[r]=p}6===c&&(s.needsUpdate=!0,a&&a(s))}},n,l)}(l,r,a,n);return s}},function(e,t){THREE.KMZLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.KMZLoader.prototype={constructor:THREE.KMZLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){var t=new JSZip(e),r=t.file(/dae$/i);if(r.length){var a=r[0],n=(new THREE.ColladaLoader).parse(a.asText()),i=n.library.images;for(var o in i)!function(e){var r=decodeURI(e.init_from);r=r.replace("../","");var a=new RegExp(r+"$"),n=t.file(a);if(n.length){var i=n[0],o=new Blob([i.asArrayBuffer()],{type:"application/octet-binary"});e.build.src=URL.createObjectURL(o)}}(i[o]);return n}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new THREE.Group}}}},function(e,t){THREE.MD2Loader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MD2Loader.prototype={constructor:THREE.MD2Loader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(){var e=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(t){console.time("MD2Loader");for(var r=new DataView(t),a={},n=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],i=0;i<n.length;i++)a[n[i]]=r.getInt32(4*i,!0);if(844121161!==a.ident||8!==a.version)return void console.error("Not a valid MD2 file");if(a.offset_end!==r.byteLength)return void console.error("Corrupted MD2 file");for(var o=new THREE.Geometry,s=[],u=a.offset_st,i=0,c=a.num_st;i<c;i++){var l=r.getInt16(u+0,!0),h=r.getInt16(u+2,!0);s.push(new THREE.Vector2(l/a.skinwidth,1-h/a.skinheight)),u+=4}for(var u=a.offset_tris,i=0,c=a.num_tris;i<c;i++){var d=r.getUint16(u+0,!0),f=r.getUint16(u+2,!0),p=r.getUint16(u+4,!0);o.faces.push(new THREE.Face3(d,f,p)),o.faceVertexUvs[0].push([s[r.getUint16(u+6,!0)],s[r.getUint16(u+8,!0)],s[r.getUint16(u+10,!0)]]),u+=12}for(var m=new THREE.Vector3,E=new THREE.Vector3,v=[],u=a.offset_frames,i=0,c=a.num_frames;i<c;i++){E.set(r.getFloat32(u+0,!0),r.getFloat32(u+4,!0),r.getFloat32(u+8,!0)),m.set(r.getFloat32(u+12,!0),r.getFloat32(u+16,!0),r.getFloat32(u+20,!0)),u+=24;for(var g=0;g<16;g++){var y=r.getUint8(u+g,!0);if(0===y)break;v[g]=y}var T={name:String.fromCharCode.apply(null,v),vertices:[],normals:[]};u+=16;for(var g=0;g<a.num_vertices;g++){var b=r.getUint8(u++,!0),R=r.getUint8(u++,!0),A=r.getUint8(u++,!0),w=e[r.getUint8(u++,!0)],H=new THREE.Vector3(b*E.x+m.x,A*E.z+m.z,R*E.y+m.y),x=new THREE.Vector3(w[0],w[2],w[1]);T.vertices.push(H),T.normals.push(x)}o.morphTargets.push(T)}o.vertices=o.morphTargets[0].vertices;for(var M=o.morphTargets[0],g=0,_=o.faces.length;g<_;g++){var L=o.faces[g];L.vertexNormals=[M.normals[L.a],M.normals[L.b],M.normals[L.c]]}for(var i=0,c=o.morphTargets.length;i<c;i++){for(var M=o.morphTargets[i],F=[],g=0,_=o.faces.length;g<_;g++){var L=o.faces[g];F.push({a:M.normals[L.a],b:M.normals[L.b],c:M.normals[L.c]})}o.morphNormals.push({vertexNormals:F})}return o.animations=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(o.morphTargets,10),console.timeEnd("MD2Loader"),o}}()}},function(e,t){THREE.MMDLoader=function(e){THREE.Loader.call(this),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.parser=new MMDParser.Parser,this.textureCrossOrigin=null},THREE.MMDLoader.prototype=Object.create(THREE.Loader.prototype),THREE.MMDLoader.prototype.constructor=THREE.MMDLoader,THREE.MMDLoader.prototype.defaultToonTextures=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],THREE.MMDLoader.prototype.setTextureCrossOrigin=function(e){this.textureCrossOrigin=e},THREE.MMDLoader.prototype.load=function(e,t,r,a,n){var i=this;this.loadModel(e,function(e){i.loadVmds(t,function(t){i.pourVmdIntoModel(e,t),r(e)},a,n)},a,n)},THREE.MMDLoader.prototype.loadModel=function(e,t,r,a){var n=this,i=THREE.LoaderUtils.extractUrlBase(e),o=this.extractExtension(e);this.loadFileAsBuffer(e,function(e){t(n.createModel(e,o,i,r,a))},r,a)},THREE.MMDLoader.prototype.createModel=function(e,t,r,a,n){return this.createMesh(this.parseModel(e,t),r,a,n)},THREE.MMDLoader.prototype.loadVmd=function(e,t,r,a){var n=this;this.loadFileAsBuffer(e,function(e){t(n.parseVmd(e))},r,a)},THREE.MMDLoader.prototype.loadVmds=function(e,t,r,a){function n(){var s=e.shift();i.loadVmd(s,function(r){o.push(r),e.length>0?n():t(i.mergeVmds(o))},r,a)}var i=this,o=[];e=e.slice(),n()},THREE.MMDLoader.prototype.loadAudio=function(e,t,r,a){var n=new THREE.AudioListener,i=new THREE.Audio(n);new THREE.AudioLoader(this.manager).load(e,function(e){i.setBuffer(e),t(i,n)},r,a)},THREE.MMDLoader.prototype.loadVpd=function(e,t,r,a,n){var i=this;(n&&"unicode"===n.charcode?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this)(e,function(e){t(i.parseVpd(e))},r,a)},THREE.MMDLoader.prototype.parseModel=function(e,t){switch(t.toLowerCase()){case"pmd":return this.parsePmd(e);case"pmx":return this.parsePmx(e);default:throw"extension "+t+" is not supported."}},THREE.MMDLoader.prototype.parsePmd=function(e){return this.parser.parsePmd(e,!0)},THREE.MMDLoader.prototype.parsePmx=function(e){return this.parser.parsePmx(e,!0)},THREE.MMDLoader.prototype.parseVmd=function(e){return this.parser.parseVmd(e,!0)},THREE.MMDLoader.prototype.parseVpd=function(e){return this.parser.parseVpd(e,!0)},THREE.MMDLoader.prototype.mergeVmds=function(e){return this.parser.mergeVmds(e)},THREE.MMDLoader.prototype.pourVmdIntoModel=function(e,t,r){this.createAnimation(e,t,r)},THREE.MMDLoader.prototype.pourVmdIntoCamera=function(e,t,r){var a=new THREE.MMDLoader.DataCreationHelper;!function(){for(var n=a.createOrderedMotionArray(t.cameras),i=[],o=[],s=[],u=[],c=[],l=[],h=[],d=[],f=[],p=new THREE.Quaternion,m=new THREE.Euler,E=new THREE.Vector3,v=new THREE.Vector3,g=function(e,t){e.push(t.x),e.push(t.y),e.push(t.z)},y=function(e,t,r){e.push(t[4*r+0]/127),e.push(t[4*r+1]/127),e.push(t[4*r+2]/127),e.push(t[4*r+3]/127)},T=function(e,t,r,a,n){if(r.length>2){r=r.slice(),a=a.slice(),n=n.slice();for(var i=a.length/r.length,o=3===i?12:4,s=1,u=2,c=r.length;u<c;u++){for(var l=0;l<i;l++)if(a[s*i+l]!==a[(s-1)*i+l]||a[s*i+l]!==a[u*i+l]){s++;break}if(u>s){r[s]=r[u];for(var l=0;l<i;l++)a[s*i+l]=a[u*i+l];for(var l=0;l<o;l++)n[s*o+l]=n[u*o+l]}}r.length=s+1,a.length=(s+1)*i,n.length=(s+1)*o}return new THREE.MMDLoader[t](e,r,a,n)},b=0;b<n.length;b++){var R=n[b],A=R.frameNum/30,w=R.position,H=R.rotation,x=R.distance,M=R.fov,_=R.interpolation;E.set(0,0,-x),v.set(w[0],w[1],w[2]),m.set(-H[0],-H[1],-H[2]),p.setFromEuler(m),E.add(v),E.applyQuaternion(p),i.length>0&&A<i[i.length-1]+.05&&(i[i.length-1]=A-1e-13),i.push(A),g(o,v),function(e,t){e.push(t.x),e.push(t.y),e.push(t.z),e.push(t.w)}(s,p),g(u,E),c.push(M);for(var L=0;L<3;L++)y(l,_,L);y(h,_,3);for(var L=0;L<3;L++)y(d,_,4);y(f,_,5)}if(0!==i.length){var F=[];F.push(T(".center","VectorKeyframeTrackEx",i,o,l)),F.push(T(".quaternion","QuaternionKeyframeTrackEx",i,s,h)),F.push(T(".position","VectorKeyframeTrackEx",i,u,d)),F.push(T(".fov","NumberKeyframeTrackEx",i,c,f));var k=new THREE.AnimationClip(void 0===r?THREE.Math.generateUUID():r,-1,F);void 0===e.center&&(e.center=new THREE.Vector3(0,0,0)),void 0===e.animations&&(e.animations=[]),e.animations.push(k)}}()},THREE.MMDLoader.prototype.extractExtension=function(e){var t=e.lastIndexOf(".");return t<0?null:e.slice(t+1)},THREE.MMDLoader.prototype.loadFile=function(e,t,r,a,n,i){var o=new THREE.FileLoader(this.manager);return void 0!==i&&o.setMimeType(i),o.setResponseType(n),o.load(e,function(e){t(e)},r,a)},THREE.MMDLoader.prototype.loadFileAsBuffer=function(e,t,r,a){this.loadFile(e,t,r,a,"arraybuffer")},THREE.MMDLoader.prototype.loadFileAsText=function(e,t,r,a){this.loadFile(e,t,r,a,"text")},THREE.MMDLoader.prototype.loadFileAsShiftJISText=function(e,t,r,a){this.loadFile(e,t,r,a,"text","text/plain; charset=shift_jis")},THREE.MMDLoader.prototype.createMesh=function(e,t,r,a){var n=this,i=new THREE.BufferGeometry,o=[],s={};s.vertices=[],s.uvs=[],s.normals=[],s.skinIndices=[],s.skinWeights=[],s.indices=[];return function(){for(var t=0;t<e.metadata.vertexCount;t++){for(var r=e.vertices[t],a=0,n=r.position.length;a<n;a++)s.vertices.push(r.position[a]);for(var a=0,n=r.normal.length;a<n;a++)s.normals.push(r.normal[a]);for(var a=0,n=r.uv.length;a<n;a++)s.uvs.push(r.uv[a]);for(var a=0;a<4;a++)s.skinIndices.push(r.skinIndices.length-1>=a?r.skinIndices[a]:0);for(var a=0;a<4;a++)s.skinWeights.push(r.skinWeights.length-1>=a?r.skinWeights[a]:0)}}(),function(){for(var t=0;t<e.metadata.faceCount;t++)for(var r=e.faces[t],a=0,n=r.indices.length;a<n;a++)s.indices.push(r.indices[a])}(),function(){for(var t=[],r=e.rigidBodies,a={},n=0,o=r.length;n<o;n++){var s=r[n],u=a[s.boneIndex];u=void 0===u?s.type:Math.max(s.type,u),a[s.boneIndex]=u}for(var n=0;n<e.metadata.boneCount;n++){var c={},l=e.bones[n];c.parent=l.parentIndex,c.name=l.name,c.pos=[l.position[0],l.position[1],l.position[2]],c.rotq=[0,0,0,1],c.scl=[1,1,1],-1!==c.parent&&(c.pos[0]-=e.bones[c.parent].position[0],c.pos[1]-=e.bones[c.parent].position[1],c.pos[2]-=e.bones[c.parent].position[2]),c.rigidBodyType=void 0!==a[n]?a[n]:-1,t.push(c)}i.bones=t}(),function(){var t=[];if("pmd"===e.metadata.format)for(var r=0;r<e.metadata.ikCount;r++){var a=e.iks[r],n={};n.target=a.target,n.effector=a.effector,n.iteration=a.iteration,n.maxAngle=4*a.maxAngle,n.links=[];for(var o=0;o<a.links.length;o++){var s={};s.index=a.links[o].index,e.bones[s.index].name.indexOf("")>=0&&(s.limitation=new THREE.Vector3(1,0,0)),n.links.push(s)}t.push(n)}else for(var r=0;r<e.metadata.boneCount;r++){var u=e.bones[r],a=u.ik;if(void 0!==a){var n={};n.target=r,n.effector=a.effector,n.iteration=a.iteration,n.maxAngle=a.maxAngle,n.links=[];for(var o=0;o<a.links.length;o++){var s={};s.index=a.links[o].index,s.enabled=!0,1===a.links[o].angleLimitation&&(s.limitation=new THREE.Vector3(1,0,0)),n.links.push(s)}t.push(n)}}i.iks=t}(),function(){if("pmd"!==e.metadata.format){for(var t=[],r=0;r<e.metadata.boneCount;r++){var a=e.bones[r],n=a.grant;if(void 0!==n){var o={};o.index=r,o.parentIndex=n.parentIndex,o.ratio=n.ratio,o.isLocal=n.isLocal,o.affectRotation=n.affectRotation,o.affectPosition=n.affectPosition,o.transformationClass=a.transformationClass,t.push(o)}}t.sort(function(e,t){return e.transformationClass-t.transformationClass}),i.grants=t}}(),function(){function t(e,t,r,a){e.array[3*t+0]+=r.position[0]*a,e.array[3*t+1]+=r.position[1]*a,e.array[3*t+2]+=r.position[2]*a}function r(r,a,n){for(var i=0;i<a.elementCount;i++){var o,s=a.elements[i];o="pmd"===e.metadata.format?e.morphs[0].elements[s.index].index:s.index,t(r,o,s,n)}}for(var a=[],n=[],o=0;o<e.metadata.morphCount;o++){var u=e.morphs[o],c={name:u.name},l=new THREE.Float32BufferAttribute(3*e.metadata.vertexCount,3);l.name=u.name;for(var h=0;h<3*e.metadata.vertexCount;h++)l.array[h]=s.vertices[h];if("pmd"===e.metadata.format)0!==o&&r(l,u,1);else if(0===u.type)for(var h=0;h<u.elementCount;h++){var d=e.morphs[u.elements[h].index],f=u.elements[h].ratio;1===d.type&&r(l,d,f)}else 1===u.type?r(l,u,1):2===u.type||3===u.type||4===u.type||5===u.type||6===u.type||7===u.type||u.type;a.push(c),n.push(l)}i.morphTargets=a,i.morphAttributes.position=n}(),function(){function s(e,i){void 0===i&&(i={});var o;if(!0===i.defaultTexturePath)try{o=n.defaultToonTextures[parseInt(e.match("toon([0-9]{2}).bmp$")[1])]}catch(t){console.warn("THREE.MMDLoader: "+e+" seems like not right default texture path. Using toon00.bmp instead."),o=n.defaultToonTextures[0]}else o=t+e;if(void 0!==l[o])return o;var s=THREE.Loader.Handlers.get(o);null===s&&(s=e.indexOf(".tga")>=0?d:h);var u=s.load(o,function(e){if(!0===i.isToonTexture){var t=e.image,r=t.width,a=t.height;f.width=r,f.height=a,p.clearRect(0,0,r,a),p.translate(r/2,a/2),p.rotate(.5*Math.PI),p.translate(-r/2,-a/2),p.drawImage(t,0,0),e.image=p.getImageData(0,0,r,a)}e.flipY=!1,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping;for(var n=0;n<u.readyCallbacks.length;n++)u.readyCallbacks[n](u);delete u.readyCallbacks},r,a);return!0===i.sphericalReflectionMapping&&(u.mapping=THREE.SphericalReflectionMapping),u.readyCallbacks=[],l[o]=u,o}function u(e,t){return void 0===t[e]&&console.warn("THREE.MMDLoader: Undefined texture",e),t[e]}function c(e,t){if(8===e.type)for(var r=0;r<t.length;r++){var a=t[r];if(-1!==a.index){var n=o[a.index];n.opacity!==a.diffuse[3]&&(n.transparent=!0)}}}var l={},h=new THREE.TextureLoader(n.manager),d=new THREE.TGALoader(n.manager),f=document.createElement("canvas"),p=f.getContext("2d"),m=0,E=[];null!==n.textureCrossOrigin&&h.setCrossOrigin(n.textureCrossOrigin);for(var v=0;v<e.metadata.materialCount;v++){var g=e.materials[v],y={};if(y.faceOffset=m,y.faceNum=g.faceCount,m+=g.faceCount,y.name=g.name,y.color=new THREE.Color(g.diffuse[0],g.diffuse[1],g.diffuse[2]),y.opacity=g.diffuse[3],y.specular=new THREE.Color(g.specular[0],g.specular[1],g.specular[2]),y.shininess=g.shininess,1===y.opacity?(y.side=THREE.FrontSide,y.transparent=!1):(y.side=THREE.DoubleSide,y.transparent=!0),"pmd"===e.metadata.format){if(g.fileName){var T=g.fileName,b=[],R=T.lastIndexOf("*");R>=0?(b.push(T.slice(0,R)),b.push(T.slice(R+1))):b.push(T);for(var A=0;A<b.length;A++){var w=b[A];w.indexOf(".sph")>=0||w.indexOf(".spa")>=0?(y.envMap=s(w,{sphericalReflectionMapping:!0}),w.indexOf(".sph")>=0?y.envMapType=THREE.MultiplyOperation:y.envMapType=THREE.AddOperation):y.map=s(w)}}}else{if(-1!==g.textureIndex){var w=e.textures[g.textureIndex];y.map=s(w)}if(-1!==g.envTextureIndex&&(1===g.envFlag||2==g.envFlag)){var w=e.textures[g.envTextureIndex];y.envMap=s(w,{sphericalReflectionMapping:!0}),1===g.envFlag?y.envMapType=THREE.MultiplyOperation:y.envMapType=THREE.AddOperation}}var H=void 0===y.map?1:.2;y.emissive=new THREE.Color(g.ambient[0]*H,g.ambient[1]*H,g.ambient[2]*H),E.push(y)}for(var v=0;v<E.length;v++){var x=E[v],M=e.materials[v],g=new THREE.MeshToonMaterial;if(i.addGroup(3*x.faceOffset,3*x.faceNum,v),void 0!==x.name&&(g.name=x.name),g.skinning=i.bones.length>0,g.morphTargets=i.morphTargets.length>0,g.lights=!0,g.side="pmx"===e.metadata.format&&1==(1&M.flag)?THREE.DoubleSide:x.side,g.transparent=x.transparent,g.fog=!0,g.blending=THREE.CustomBlending,g.blendSrc=THREE.SrcAlphaFactor,g.blendDst=THREE.OneMinusSrcAlphaFactor,g.blendSrcAlpha=THREE.SrcAlphaFactor,g.blendDstAlpha=THREE.DstAlphaFactor,void 0!==x.map&&(g.faceOffset=x.faceOffset,g.faceNum=x.faceNum,g.map=u(x.map,l),function(e){e.map.readyCallbacks.push(function(t){function r(e,t){var r=e.width,a=e.height,n=Math.round(t.x*r)%r,i=Math.round(t.y*a)%a;n<0&&(n+=r),i<0&&(i+=a);var o=i*r+n;return e.data[4*o+3]}var a=void 0!==t.image.data?t.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,t.width,t.height)}(t.image),n=i.index.array.slice(3*e.faceOffset,3*e.faceOffset+3*e.faceNum);(function(e,t,a){var n=e.width,i=e.height,o=e.data;if(o.length/(n*i)!=4)return!1;for(var s=0;s<a.length;s+=3){for(var u={x:0,y:0},c=0;c<3;c++){var l=a[3*s+c],h={x:t[2*l+0],y:t[2*l+1]};if(r(e,h)<253)return!0;u.x+=h.x,u.y+=h.y}if(u.x/=3,u.y/=3,r(e,u)<253)return!0}return!1})(a,i.attributes.uv.array,n)&&(e.transparent=!0),delete e.faceOffset,delete e.faceNum})}(g)),void 0!==x.envMap&&(g.envMap=u(x.envMap,l),g.combine=x.envMapType),g.opacity=x.opacity,g.color=x.color,void 0!==x.emissive&&(g.emissive=x.emissive),g.specular=x.specular,g.shininess=Math.max(x.shininess,1e-4),"pmd"===e.metadata.format){g.outlineParameters={thickness:1===M.edgeFlag?.003:0,color:new THREE.Color(0,0,0),alpha:1},0===g.outlineParameters.thickness&&(g.outlineParameters.visible=!1);var _=-1===M.toonIndex?"toon00.bmp":e.toonTextures[M.toonIndex].fileName,L=s(_,{isToonTexture:!0,defaultTexturePath:function(e){return 10===e.length&&null!==e.match(/toon(10|0[0-9]).bmp/)}(_)});g.gradientMap=u(L,l)}else{g.outlineParameters={thickness:M.edgeSize/300,color:new THREE.Color(M.edgeColor[0],M.edgeColor[1],M.edgeColor[2]),alpha:M.edgeColor[3]},0!=(16&M.flag)&&0!==g.outlineParameters.thickness||(g.outlineParameters.visible=!1);var _,F;if(-1===M.toonIndex||0!==M.toonFlag){var k=M.toonIndex+1;_="toon"+(k<10?"0"+k:k)+".bmp",F=!0}else _=e.textures[M.toonIndex],F=!1;var L=s(_,{isToonTexture:!0,defaultTexturePath:F});g.gradientMap=u(L,l)}o.push(g)}if("pmx"===e.metadata.format)for(var v=0;v<e.morphs.length;v++){var C=e.morphs[v],S=C.elements;if(0===C.type)for(var A=0;A<S.length;A++){var I=e.morphs[S[A].index],N=I.elements;c(I,N)}else c(C,S)}}(),function(){for(var t=[],r=[],a=0;a<e.metadata.rigidBodyCount;a++){for(var n=e.rigidBodies[a],o=Object.keys(n),s={},u=0;u<o.length;u++){var c=o[u];s[c]=n[c]}if("pmx"===e.metadata.format&&-1!==s.boneIndex){var l=e.bones[s.boneIndex];s.position[0]-=l.position[0],s.position[1]-=l.position[1],s.position[2]-=l.position[2]}t.push(s)}for(var a=0;a<e.metadata.constraintCount;a++){for(var h=e.constraints[a],o=Object.keys(h),s={},u=0;u<o.length;u++){var c=o[u];s[c]=h[c]}var d=t[s.rigidBodyIndex1],f=t[s.rigidBodyIndex2];0!==d.type&&2===f.type&&-1!==d.boneIndex&&-1!==f.boneIndex&&e.bones[f.boneIndex].parentIndex===d.boneIndex&&(f.type=1),r.push(s)}i.rigidBodies=t,i.constraints=r}(),function(){i.setIndex(s.indices),i.addAttribute("position",new THREE.Float32BufferAttribute(s.vertices,3)),i.addAttribute("normal",new THREE.Float32BufferAttribute(s.normals,3)),i.addAttribute("uv",new THREE.Float32BufferAttribute(s.uvs,2)),i.addAttribute("skinIndex",new THREE.Float32BufferAttribute(s.skinIndices,4)),i.addAttribute("skinWeight",new THREE.Float32BufferAttribute(s.skinWeights,4)),i.computeBoundingSphere(),i.mmdFormat=e.metadata.format}(),new THREE.SkinnedMesh(i,o)},THREE.MMDLoader.prototype.createAnimation=function(e,t,r){var a=new THREE.MMDLoader.DataCreationHelper;!function(){if(0!==t.metadata.motionCount){for(var n=e.geometry.bones,i=a.createOrderedMotionArrays(n,t.motions,"boneName"),o=[],s=function(e,t,r){e.push(t[r+0]/127),e.push(t[r+8]/127),e.push(t[r+4]/127),e.push(t[r+12]/127)},u=0;u<i.length;u++){for(var c=[],l=[],h=[],d=[],f=[],p=n[u],m=i[u],E=0;E<m.length;E++){var v=m[E].frameNum/30,g=m[E].position,y=m[E].rotation,T=m[E].interpolation;c.push(v);for(var b=0;b<3;b++)l.push(p.pos[b]+g[b]);for(var b=0;b<4;b++)h.push(y[b]);for(var b=0;b<3;b++)s(d,T,b);s(f,T,3)}if(0!==c.length){var R=".bones["+p.name+"]";o.push(new THREE.MMDLoader.VectorKeyframeTrackEx(R+".position",c,l,d)),o.push(new THREE.MMDLoader.QuaternionKeyframeTrackEx(R+".quaternion",c,h,f))}}var A=new THREE.AnimationClip(void 0===r?THREE.Math.generateUUID():r,-1,o);void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(A)}}(),function(){if(0!==t.metadata.morphCount){for(var n=a.createOrderedMotionArrays(e.geometry.morphTargets,t.morphs,"morphName"),i=[],o=0;o<n.length;o++){for(var s=[],u=[],c=n[o],l=0;l<c.length;l++)s.push(c[l].frameNum/30),u.push(c[l].weight);0!==s.length&&i.push(new THREE.NumberKeyframeTrack(".morphTargetInfluences["+o+"]",s,u))}var h=new THREE.AnimationClip(void 0===r?THREE.Math.generateUUID():r+"Morph",-1,i);void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(h)}}()},THREE.MMDLoader.DataCreationHelper=function(){},THREE.MMDLoader.DataCreationHelper.prototype={constructor:THREE.MMDLoader.DataCreationHelper,toCharcodeStrings:function(e){for(var t="",r=0;r<e.length;r++)t+="0x"+("0000"+e[r].charCodeAt().toString(16)).substr(-4);return t},createDictionary:function(e){for(var t={},r=0;r<e.length;r++)t[e[r].name]=r;return t},initializeMotionArrays:function(e){for(var t=[],r=0;r<e.length;r++)t[r]=[];return t},sortMotionArray:function(e){e.sort(function(e,t){return e.frameNum-t.frameNum})},sortMotionArrays:function(e){for(var t=0;t<e.length;t++)this.sortMotionArray(e[t])},createMotionArray:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},createMotionArrays:function(e,t,r,a){for(var n=0;n<e.length;n++){var i=e[n],o=r[i[a]];void 0!==o&&t[o].push(i)}},createOrderedMotionArray:function(e){var t=this.createMotionArray(e);return this.sortMotionArray(t),t},createOrderedMotionArrays:function(e,t,r){var a=this.createDictionary(e),n=this.initializeMotionArrays(e);return this.createMotionArrays(t,n,a,r),this.sortMotionArrays(n),n}},THREE.MMDLoader.VectorKeyframeTrackEx=function(e,t,r,a){this.interpolationParameters=new Float32Array(a),THREE.VectorKeyframeTrack.call(this,e,t,r)},THREE.MMDLoader.VectorKeyframeTrackEx.prototype=Object.create(THREE.VectorKeyframeTrack.prototype),THREE.MMDLoader.VectorKeyframeTrackEx.prototype.constructor=THREE.MMDLoader.VectorKeyframeTrackEx,THREE.MMDLoader.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array,THREE.MMDLoader.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new THREE.MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},THREE.MMDLoader.VectorKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},THREE.MMDLoader.QuaternionKeyframeTrackEx=function(e,t,r,a){this.interpolationParameters=new Float32Array(a),THREE.QuaternionKeyframeTrack.call(this,e,t,r)},THREE.MMDLoader.QuaternionKeyframeTrackEx.prototype=Object.create(THREE.QuaternionKeyframeTrack.prototype),THREE.MMDLoader.QuaternionKeyframeTrackEx.prototype.constructor=THREE.MMDLoader.QuaternionKeyframeTrackEx,THREE.MMDLoader.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array,THREE.MMDLoader.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new THREE.MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},THREE.MMDLoader.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},THREE.MMDLoader.NumberKeyframeTrackEx=function(e,t,r,a){this.interpolationParameters=new Float32Array(a),THREE.NumberKeyframeTrack.call(this,e,t,r)},THREE.MMDLoader.NumberKeyframeTrackEx.prototype=Object.create(THREE.NumberKeyframeTrack.prototype),THREE.MMDLoader.NumberKeyframeTrackEx.prototype.constructor=THREE.MMDLoader.NumberKeyframeTrackEx,THREE.MMDLoader.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array,THREE.MMDLoader.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new THREE.MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},THREE.MMDLoader.NumberKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},THREE.MMDLoader.CubicBezierInterpolation=function(e,t,r,a,n){THREE.Interpolant.call(this,e,t,r,a),this.params=n},THREE.MMDLoader.CubicBezierInterpolation.prototype=Object.create(THREE.LinearInterpolant.prototype),THREE.MMDLoader.CubicBezierInterpolation.prototype.constructor=THREE.MMDLoader.CubicBezierInterpolation,THREE.MMDLoader.CubicBezierInterpolation.prototype.interpolate_=function(e,t,r,a){var n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=(r-t)/(a-t);if(4===o){var l=this.params[4*e+0],h=this.params[4*e+1],d=this.params[4*e+2],f=this.params[4*e+3],p=this._calculate(l,h,d,f,c);THREE.Quaternion.slerpFlat(n,0,i,u,i,s,p)}else if(3===o)for(var m=0;m!==o;++m){var l=this.params[12*e+4*m+0],h=this.params[12*e+4*m+1],d=this.params[12*e+4*m+2],f=this.params[12*e+4*m+3],p=this._calculate(l,h,d,f,c);n[m]=i[u+m]*(1-p)+i[s+m]*p}else{var l=this.params[4*e+0],h=this.params[4*e+1],d=this.params[4*e+2],f=this.params[4*e+3],p=this._calculate(l,h,d,f,c);n[0]=i[u]*(1-p)+i[s]*p}return n},THREE.MMDLoader.CubicBezierInterpolation.prototype._calculate=function(e,t,r,a,n){for(var i,o,s,u=.5,c=u,l=1-c,h=Math,d=0;d<15;d++){i=3*l*l*c,o=3*l*c*c,s=c*c*c;var f=i*e+o*t+s-n;if(h.abs(f)<1e-5)break;u/=2,c+=f<0?u:-u,l=1-c}return i*r+o*a+s},THREE.MMDAudioManager=function(e,t,r){var a=null===r||void 0===r?{}:r;this.audio=e,this.listener=t,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==a.delayTime?a.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime},THREE.MMDAudioManager.prototype={constructor:THREE.MMDAudioManager,control:function(e){this.elapsed+=e,this.currentTime+=e,this.checkIfStopAudio()&&this.audio.stop(),this.checkIfStartAudio()&&this.audio.play()},checkIfStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&(this.audio.startTime=this.currentTime-this.delayTime,!0)},checkIfStopAudio:function(){return!!this.audio.isPlaying&&this.currentTime>=this.duration}},THREE.MMDGrantSolver=function(e){this.mesh=e},THREE.MMDGrantSolver.prototype={constructor:THREE.MMDGrantSolver,update:function(){var e=new THREE.Quaternion;return function(){for(var t=0;t<this.mesh.geometry.grants.length;t++){var r=this.mesh.geometry.grants[t],a=this.mesh.skeleton.bones[r.index],n=this.mesh.skeleton.bones[r.parentIndex];r.isLocal?(r.affectPosition,r.affectRotation):(r.affectPosition,r.affectRotation&&(e.set(0,0,0,1),e.slerp(n.quaternion,r.ratio),a.quaternion.multiply(e)))}}}()},THREE.MMDHelper=function(){this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null},THREE.MMDHelper.prototype={constructor:THREE.MMDHelper,add:function(e){if(!(e instanceof THREE.SkinnedMesh))throw new Error("THREE.MMDHelper.add() accepts only THREE.SkinnedMesh instance.");void 0===e.mixer&&(e.mixer=null),void 0===e.ikSolver&&(e.ikSolver=null),void 0===e.grantSolver&&(e.grantSolver=null),void 0===e.physics&&(e.physics=null),void 0===e.looped&&(e.looped=!1),this.meshes.push(e),this.initBackupBones(e)},setAudio:function(e,t,r){this.audioManager=new THREE.MMDAudioManager(e,t,r)},setCamera:function(e){e.mixer=null,this.camera=e},setPhysicses:function(e){for(var t=0;t<this.meshes.length;t++)this.setPhysics(this.meshes[t],e)},setPhysics:function(e,t){if(t=void 0===t?{}:Object.assign({},t),void 0===t.world&&this.sharedPhysics){var r=this.getMasterPhysics();null!==r&&(t.world=r.world)}var a=void 0!==t.warmup?t.warmup:60,n=new THREE.MMDPhysics(e,t);null!==e.mixer&&void 0!==e.mixer&&!0!==t.preventAnimationWarmup&&(this.animateOneMesh(0,e),n.reset()),n.warmup(a),this.updateIKParametersDependingOnPhysicsEnabled(e,!0),e.physics=n},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var e=0,t=this.meshes.length;e<t;e++){var r=this.meshes[e].physics;if(void 0!==r&&null!==r)return this.masterPhysics=r,this.masterPhysics}return null},enablePhysics:function(e){this.doPhysics=!0===e;for(var t=0,r=this.meshes.length;t<r;t++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[t],e)},updateIKParametersDependingOnPhysicsEnabled:function(e,t){for(var r=e.geometry.iks,a=e.geometry.bones,n=0,i=r.length;n<i;n++)for(var o=r[n],s=o.links,u=0,c=s.length;u<c;u++){var l=s[u];l.enabled=!0!==t||!(a[l.index].rigidBodyType>0)}},setAnimations:function(){for(var e=0;e<this.meshes.length;e++)this.setAnimation(this.meshes[e])},setAnimation:function(e){if(void 0!==e.geometry.animations){e.mixer=new THREE.AnimationMixer(e),e.mixer.addEventListener("loop",function(e){if(!(e.action._clip.tracks.length>0&&0!==e.action._clip.tracks[0].name.indexOf(".bones"))){e.target._root.looped=!0}});for(var t=!1,r=!1,a=0;a<e.geometry.animations.length;a++){var n=e.geometry.animations[a],i=e.mixer.clipAction(n);n.tracks.length>0&&0===n.tracks[0].name.indexOf(".morphTargetInfluences")?r||(i.play(),r=!0):t||(i.play(),t=!0)}t&&(e.ikSolver=new THREE.CCDIKSolver(e),void 0!==e.geometry.grants&&(e.grantSolver=new THREE.MMDGrantSolver(e)))}},setCameraAnimation:function(e){void 0!==e.animations&&(e.mixer=new THREE.AnimationMixer(e),e.mixer.clipAction(e.animations[0]).play())},unifyAnimationDuration:function(e){e=void 0===e?{}:e;for(var t=0,r=this.camera,a=this.audioManager,n=0;n<this.meshes.length;n++){var i=this.meshes[n],o=i.mixer;if(null!==o)for(var s=0;s<o._actions.length;s++){var u=o._actions[s];t=Math.max(t,u._clip.duration)}}if(null!==r&&null!==r.mixer)for(var o=r.mixer,n=0;n<o._actions.length;n++){var u=o._actions[n];t=Math.max(t,u._clip.duration)}null!==a&&(t=Math.max(t,a.duration)),void 0!==e.afterglow&&(t+=e.afterglow);for(var n=0;n<this.meshes.length;n++){var i=this.meshes[n],o=i.mixer;if(null!==o)for(var s=0;s<o._actions.length;s++){var u=o._actions[s];u._clip.duration=t}}if(null!==r&&null!==r.mixer)for(var o=r.mixer,n=0;n<o._actions.length;n++){var u=o._actions[n];u._clip.duration=t}null!==a&&(a.duration=t)},controlAudio:function(e){null!==this.audioManager&&this.audioManager.control(e)},animate:function(e){this.controlAudio(e);for(var t=0;t<this.meshes.length;t++)this.animateOneMesh(e,this.meshes[t]);this.sharedPhysics&&this.updateSharedPhysics(e),this.animateCamera(e)},animateOneMesh:function(e,t){var r=t.mixer,a=t.ikSolver,n=t.grantSolver,i=t.physics;null!==r&&!0===this.doAnimation&&(this.restoreBones(t),r.update(e),this.backupBones(t)),null!==a&&!0===this.doIk&&a.update(),null!==n&&!0===this.doGrant&&n.update(),!0===t.looped&&(null!==i&&i.reset(),t.looped=!1),null!==i&&this.doPhysics&&!this.sharedPhysics&&i.update(e)},updateSharedPhysics:function(e){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var t=this.getMasterPhysics();if(null!==t){for(var r=0,a=this.meshes.length;r<a;r++){var n=this.meshes[r].physics;null!==n&&void 0!==n&&n.updateRigidBodies()}t.stepSimulation(e);for(var r=0,a=this.meshes.length;r<a;r++){var n=this.meshes[r].physics;null!==n&&void 0!==n&&n.updateBones()}}}},animateCamera:function(e){if(null!==this.camera){var t=this.camera.mixer;null!==t&&void 0!==this.camera.center&&!0===this.doCameraAnimation&&(t.update(e),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(e,t,r){void 0===r&&(r={}),!0!==r.preventResetPose&&e.pose();for(var a=e.skeleton.bones,n=t.bones,i={},o=0;o<a.length;o++)i[a[o].name]=o;for(var s=new THREE.Vector3,u=new THREE.Quaternion,o=0;o<n.length;o++){var c=n[o],l=i[c.name];if(void 0!==l){var h=a[l],d=c.translation,f=c.quaternion;s.set(d[0],d[1],d[2]),u.set(f[0],f[1],f[2],f[3]),h.position.add(s),h.quaternion.multiply(u)}}if(e.updateMatrixWorld(!0),!0!==r.preventIk){var p=new THREE.CCDIKSolver(e);p.update(r.saveOriginalBonesBeforeIK)}if(!0!==r.preventGrant&&void 0!==e.geometry.grants){var p=new THREE.MMDGrantSolver(e);p.update()}},initBackupBones:function(e){e.skeleton.backupBones=[];for(var t=0;t<e.skeleton.bones.length;t++)e.skeleton.backupBones.push(e.skeleton.bones[t].clone())},backupBones:function(e){e.skeleton.backupBoneIsSaved=!0;for(var t=0;t<e.skeleton.bones.length;t++){var r=e.skeleton.backupBones[t],a=e.skeleton.bones[t];r.position.copy(a.position),r.quaternion.copy(a.quaternion)}},restoreBones:function(e){if(!0===e.skeleton.backupBoneIsSaved){e.skeleton.backupBoneIsSaved=!1;for(var t=0;t<e.skeleton.bones.length;t++){var r=e.skeleton.bones[t],a=e.skeleton.backupBones[t];r.position.copy(a.position),r.quaternion.copy(a.quaternion)}}}}},function(e,t){THREE.MTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(this.manager);i.setPath(this.path),i.load(e,function(e){t(n.parse(e))},r,a)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),r={},a=/\s+/,n={},i=0;i<t.length;i++){var o=t[i];if(o=o.trim(),0!==o.length&&"#"!==o.charAt(0)){var s=o.indexOf(" "),u=s>=0?o.substring(0,s):o;u=u.toLowerCase();var c=s>=0?o.substring(s+1):"";if(c=c.trim(),"newmtl"===u)r={name:c},n[c]=r;else if(r)if("ka"===u||"kd"===u||"ks"===u){var l=c.split(a,3);r[u]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else r[u]=c}}var h=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(n),h}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var a=e[r],n={};t[r]=n;for(var i in a){var o=!0,s=a[i],u=i.toLowerCase();switch(u){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(n[u]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){function t(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}function r(e,r){if(!i[e]){var n=a.getTextureParams(r,i),o=a.loadTexture(t(a.baseUrl,n.url));o.repeat.copy(n.scale),o.offset.copy(n.offset),o.wrapS=a.wrap,o.wrapT=a.wrap,i[e]=o}}var a=this,n=this.materialsInfo[e],i={name:e,side:this.side};for(var o in n){var s,u=n[o];if(""!==u)switch(o.toLowerCase()){case"kd":i.color=(new THREE.Color).fromArray(u);break;case"ks":i.specular=(new THREE.Color).fromArray(u);break;case"map_kd":r("map",u);break;case"map_ks":r("specularMap",u);break;case"norm":r("normalMap",u);break;case"map_bump":case"bump":r("bumpMap",u);break;case"ns":i.shininess=parseFloat(u);break;case"d":s=parseFloat(u),s<1&&(i.opacity=s,i.transparent=!0);break;case"tr":s=parseFloat(u),this.options&&this.options.invertTrProperty&&(s=1-s),s<1&&(i.opacity=s,i.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(i),this.materials[e]},getTextureParams:function(e,t){var r,a={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},n=e.split(/\s+/);return r=n.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(n[r+1]),n.splice(r,2)),r=n.indexOf("-s"),r>=0&&(a.scale.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),r=n.indexOf("-o"),r>=0&&(a.offset.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),a.url=n.join(" ").trim(),a},loadTexture:function(e,t,r,a,n){var i,o=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),i=o.load(e,r,a,n),void 0!==t&&(i.mapping=t),i}}},function(e,t){THREE.NRRDLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.NRRDLoader.prototype={constructor:THREE.NRRDLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a=0;a<e.byteLength;a+=t)for(var n=a+t-1,i=a;n>i;n--,i++){var o=r[i];r[i]=r[n],r[n]=o}return e}var r,a=e,n=0,i=new Int8Array(new Int16Array([1]).buffer)[0]>0,o=!0,s={},u=function(e,r){void 0!==r&&null!==r||(r=1);var s=1,u=Uint8Array;switch(e){case"uchar":break;case"schar":u=Int8Array;break;case"ushort":u=Uint16Array,s=2;break;case"sshort":u=Int16Array,s=2;break;case"uint":u=Uint32Array,s=4;break;case"sint":u=Int32Array,s=4;break;case"float":u=Float32Array,s=4;break;case"complex":case"double":u=Float64Array,s=8}var c=new u(a.slice(n,n+=r*s));return i!=o&&(c=t(c,s)),1==r?c[0]:c}("uchar",e.byteLength),c=u.length,l=null,h=0;for(r=1;r<c;r++)if(10==u[r-1]&&10==u[r]){l=this.parseChars(u,0,r-2),h=r+1;break}!function(e){var t,r,a,n,i,o,u,c,l;for(o=e.split(/\r?\n/),c=0,l=o.length;c<l;c++)i=o[c],i.match(/NRRD\d+/)?s.isNrrd=!0:i.match(/^#/)||(u=i.match(/(.*):(.*)/))&&(r=u[1].trim(),t=u[2].trim(),a=THREE.NRRDLoader.prototype.fieldFunctions[r],a?a.call(s,t):s[r]=t);if(!s.isNrrd)throw new Error("Not an NRRD file");if("bz2"===s.encoding||"bzip2"===s.encoding)throw new Error("Bzip is not supported");if(!s.vectors&&(s.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],s.spacings))for(n=0;n<=2;n++)isNaN(s.spacings[n])||s.vectors[n].multiplyScalar(s.spacings[n])}(l);var a=u.subarray(h);if("gzip"===s.encoding||"gz"===s.encoding){var d=new Zlib.Gunzip(new Uint8Array(a));a=d.decompress()}else if("ascii"===s.encoding||"text"===s.encoding||"txt"===s.encoding||"hex"===s.encoding)a=function(e,t,r){var a="";t=t||0,r=r||e.length;var n,i=s.sizes.reduce(function(e,t){return e*t},1),o=10;"hex"===s.encoding&&(o=16);var u=new s.__array(i),c=0,l=parseInt;s.__array!==Float32Array&&s.__array!==Float64Array||(l=parseFloat);for(var h=t;h<r;h++)n=e[h],(n<9||n>13)&&32!==n?a+=String.fromCharCode(n):(""!==a&&(u[c]=l(a,o),c++),a="");return""!==a&&(u[c]=l(a,o),c++),u}(a);else if("raw"===s.encoding){for(var f=new Uint8Array(a.length),r=0;r<a.length;r++)f[r]=a[r];a=f}a=a.buffer;var p=new THREE.Volume;p.header=s,p.data=new s.__array(a);var m=p.computeMinMax(),E=m[0],v=m[1];p.windowLow=E,p.windowHigh=v,p.dimensions=[s.sizes[0],s.sizes[1],s.sizes[2]],p.xLength=p.dimensions[0],p.yLength=p.dimensions[1],p.zLength=p.dimensions[2];var g=new THREE.Vector3(s.vectors[0][0],s.vectors[0][1],s.vectors[0][2]).length(),y=new THREE.Vector3(s.vectors[1][0],s.vectors[1][1],s.vectors[1][2]).length(),T=new THREE.Vector3(s.vectors[2][0],s.vectors[2][1],s.vectors[2][2]).length();p.spacing=[g,y,T],p.matrix=new THREE.Matrix4;var b=1,R=1;if("left-posterior-superior"==s.space?(b=-1,R=-1):"left-anterior-superior"===s.space&&(b=-1),s.vectors){var A=s.vectors;p.matrix.set(b*A[0][0],b*A[1][0],b*A[2][0],0,R*A[0][1],R*A[1][1],R*A[2][1],0,1*A[0][2],1*A[1][2],1*A[2][2],0,0,0,0,1)}else p.matrix.set(b,0,0,0,0,R,0,0,0,0,1,0,0,0,0,1);return p.inverseMatrix=new THREE.Matrix4,p.inverseMatrix.getInverse(p.matrix),p.RASDimensions=new THREE.Vector3(p.xLength,p.yLength,p.zLength).applyMatrix4(p.matrix).round().toArray().map(Math.abs),p.lowerThreshold===-1/0&&(p.lowerThreshold=E),p.upperThreshold===1/0&&(p.upperThreshold=v),p},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var a="",n=0;for(n=t;n<r;++n)a+=String.fromCharCode(e[n]);return a},fieldFunctions:{type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){var r,a,n,i;for(n=e.split(/\s+/),i=[],r=0,a=n.length;r<a;r++)t=n[r],i.push(parseInt(t,10));return i}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,r,a;return r=e.match(/\(.*?\)/g),this.vectors=function(){var e,n,i;for(i=[],e=0,n=r.length;e<n;e++)a=r[e],i.push(function(){var e,r,n,i;for(n=a.slice(1,-1).split(/,/),i=[],e=0,r=n.length;e<r;e++)t=n[e],i.push(parseFloat(t));return i}());return i}()},spacings:function(e){var t,r;return r=e.split(/\s+/),this.spacings=function(){var e,a,n=[];for(e=0,a=r.length;e<a;e++)t=r[e],n.push(parseFloat(t));return n}()}}}},function(e,t){THREE.OBJLoader=function(){function e(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var a=r.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var a=this.vertices,n=this.object.geometry.vertices;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var a=this.normals,n=this.object.geometry.normals;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addColor:function(e,t,r){var a=this.colors,n=this.object.geometry.colors;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addUV:function(e,t,r){var a=this.uvs,n=this.object.geometry.uvs;n.push(a[e+0],a[e+1]),n.push(a[t+0],a[t+1]),n.push(a[r+0],a[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,a,n,i,o,s,u){var c=this.vertices.length,l=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(r,c);if(this.addVertex(l,h,d),void 0!==a){var f=this.uvs.length;l=this.parseUVIndex(a,f),h=this.parseUVIndex(n,f),d=this.parseUVIndex(i,f),this.addUV(l,h,d)}if(void 0!==o){var p=this.normals.length;l=this.parseNormalIndex(o,p),h=o===s?l:this.parseNormalIndex(s,p),d=o===u?l:this.parseNormalIndex(u,p),this.addNormal(l,h,d)}this.colors.length>0&&this.addColor(l,h,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,a=e.length;r<a;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,a=this.uvs.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));for(var o=0,i=t.length;o<i;o++)this.addUVLine(this.parseUVIndex(t[o],a))}};return e.startObject("",!1),e}function t(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}var r=/^[og]\s*(.+)?/,a=/^mtllib /,n=/^usemtl /;return t.prototype={constructor:t,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setPath(this.path),i.load(e,function(e){t(n.parse(e))},r,a)},setPath:function(e){this.path=e},setMaterials:function(e){return this.materials=e,this},parse:function(t){console.time("OBJLoader");var i=new e;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));for(var o=t.split("\n"),s="",u="",c=[],l="function"==typeof"".trimLeft,h=0,d=o.length;h<d;h++)if(s=o[h],s=l?s.trimLeft():s.trim(),0!==s.length&&"#"!==(u=s.charAt(0)))if("v"===u){var f=s.split(/\s+/);switch(f[0]){case"v":i.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),8===f.length&&i.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]));break;case"vn":i.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":i.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===u){for(var p=s.substr(1).trim(),m=p.split(/\s+/),E=[],v=0,g=m.length;v<g;v++){var y=m[v];if(y.length>0){var T=y.split("/");E.push(T)}}for(var b=E[0],v=1,g=E.length-1;v<g;v++){var R=E[v],A=E[v+1];i.addFace(b[0],R[0],A[0],b[1],R[1],A[1],b[2],R[2],A[2])}}else if("l"===u){var w=s.substring(1).trim().split(" "),H=[],x=[];if(-1===s.indexOf("/"))H=w;else for(var M=0,_=w.length;M<_;M++){var L=w[M].split("/");""!==L[0]&&H.push(L[0]),""!==L[1]&&x.push(L[1])}i.addLineGeometry(H,x)}else if("p"===u){var p=s.substr(1).trim(),F=p.split(" ");i.addPointGeometry(F)}else if(null!==(c=r.exec(s))){var k=(" "+c[0].substr(1).trim()).substr(1);i.startObject(k)}else if(n.test(s))i.object.startMaterial(s.substring(7).trim(),i.materialLibraries);else if(a.test(s))i.materialLibraries.push(s.substring(7).trim());else{if("s"!==u){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if(c=s.split(" "),c.length>1){var C=c[1].trim().toLowerCase();i.object.smooth="0"!==C&&"off"!==C}else i.object.smooth=!0;var S=i.object.currentMaterial();S&&(S.smooth=i.object.smooth)}i.finalize();var I=new THREE.Group;I.materialLibraries=[].concat(i.materialLibraries);for(var h=0,d=i.objects.length;h<d;h++){var N=i.objects[h],O=N.geometry,B=N.materials,P="Line"===O.type,U="Points"===O.type,D=!1;if(0!==O.vertices.length){var V=new THREE.BufferGeometry;V.addAttribute("position",new THREE.Float32BufferAttribute(O.vertices,3)),O.normals.length>0?V.addAttribute("normal",new THREE.Float32BufferAttribute(O.normals,3)):V.computeVertexNormals(),O.colors.length>0&&(D=!0,V.addAttribute("color",new THREE.Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&V.addAttribute("uv",new THREE.Float32BufferAttribute(O.uvs,2));for(var G=[],j=0,z=B.length;j<z;j++){var K=B[j],S=void 0;if(null!==this.materials)if(S=this.materials.create(K.name),!P||!S||S instanceof THREE.LineBasicMaterial){if(U&&S&&!(S instanceof THREE.PointsMaterial)){var W=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});Y.copy(S),S=W}}else{var Y=new THREE.LineBasicMaterial;Y.copy(S),Y.lights=!1,S=Y}S||(S=P?new THREE.LineBasicMaterial:U?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial,S.name=K.name),S.flatShading=!K.smooth,S.vertexColors=D?THREE.VertexColors:THREE.NoColors,G.push(S)}var q;if(G.length>1){for(var j=0,z=B.length;j<z;j++){var K=B[j];V.addGroup(K.groupStart,K.groupCount,j)}q=P?new THREE.LineSegments(V,G):U?new THREE.Points(V,G):new THREE.Mesh(V,G)}else q=P?new THREE.LineSegments(V,G[0]):U?new THREE.Points(V,G[0]):new THREE.Mesh(V,G[0]);q.name=N.name,I.add(q)}}return console.timeEnd("OBJLoader"),I}},t}()},function(e,t){THREE.PCDLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.littleEndian=!0},THREE.PCDLoader.prototype={constructor:THREE.PCDLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(r){t(n.parse(r,e))},r,a)},parse:function(e,t){var r=THREE.LoaderUtils.decodeText(e),a=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),a=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=a[1],t.headerLen=a[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map(function(e){return parseInt(e,10)})),null!==t.count)t.count=t.count[1].split(" ").map(function(e){return parseInt(e,10)});else{t.count=[];for(var n=0,i=t.fields.length;n<i;n++)t.count.push(1)}t.offset={};for(var o=0,n=0,i=t.fields.length;n<i;n++)"ascii"===t.data?t.offset[t.fields[n]]=n:(t.offset[t.fields[n]]=o,o+=t.size[n]);return t.rowSize=o,t}(r),n=[],i=[],o=[];if("ascii"===a.data)for(var s=a.offset,u=r.substr(a.headerLen),c=u.split("\n"),l=0,h=c.length;l<h;l++){var d=c[l].split(" ");if(void 0!==s.x&&(n.push(parseFloat(d[s.x])),n.push(parseFloat(d[s.y])),n.push(parseFloat(d[s.z]))),void 0!==s.rgb){var f=new Float32Array([parseFloat(d[s.rgb])]),p=new DataView(f.buffer,0);o.push(p.getUint8(0)/255),o.push(p.getUint8(1)/255),o.push(p.getUint8(2)/255)}void 0!==s.normal_x&&(i.push(parseFloat(d[s.normal_x])),i.push(parseFloat(d[s.normal_y])),i.push(parseFloat(d[s.normal_z])))}if("binary_compressed"===a.data)return void console.error("THREE.PCDLoader: binary_compressed files are not supported");if("binary"===a.data)for(var p=new DataView(e,a.headerLen),s=a.offset,l=0,m=0;l<a.points;l++,m+=a.rowSize)void 0!==s.x&&(n.push(p.getFloat32(m+s.x,this.littleEndian)),n.push(p.getFloat32(m+s.y,this.littleEndian)),n.push(p.getFloat32(m+s.z,this.littleEndian))),void 0!==s.rgb&&(o.push(p.getUint8(m+s.rgb+0)/255),o.push(p.getUint8(m+s.rgb+1)/255),o.push(p.getUint8(m+s.rgb+2)/255)),void 0!==s.normal_x&&(i.push(p.getFloat32(m+s.normal_x,this.littleEndian)),i.push(p.getFloat32(m+s.normal_y,this.littleEndian)),i.push(p.getFloat32(m+s.normal_z,this.littleEndian)));var E=new THREE.BufferGeometry;n.length>0&&E.addAttribute("position",new THREE.Float32BufferAttribute(n,3)),i.length>0&&E.addAttribute("normal",new THREE.Float32BufferAttribute(i,3)),o.length>0&&E.addAttribute("color",new THREE.Float32BufferAttribute(o,3)),E.computeBoundingSphere();var v=new THREE.PointsMaterial({size:.005});o.length>0?v.vertexColors=!0:v.color.setHex(16777215*Math.random());var g=new THREE.Points(E,v),y=t.split("").reverse().join("");return y=/([^\/]*)/.exec(y),y=y[1].split("").reverse().join(""),g.name=y,g}}},function(e,t){THREE.PDBLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.PDBLoader.prototype={constructor:THREE.PDBLoader,load:function(e,t,r,a){var n=this;new THREE.FileLoader(n.manager).load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e,t){return"s"+Math.min(e,t)+"e"+Math.max(e,t)}function a(e,t){var a=parseInt(p[m].substr(e,t));if(a){var n=r(v,a);void 0===f[n]&&(h.push([v-1,a-1,1]),f[n]=h.length-1)}}for(var n,i,o,s,u,c={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},l=[],h=[],d={},f={},p=e.split("\n"),m=0,E=p.length;m<E;m++)if("ATOM"===p[m].substr(0,4)||"HETATM"===p[m].substr(0,6))n=parseFloat(p[m].substr(30,7)),i=parseFloat(p[m].substr(38,7)),o=parseFloat(p[m].substr(46,7)),s=parseInt(p[m].substr(6,5))-1,u=t(p[m].substr(76,2)).toLowerCase(),""===u&&(u=t(p[m].substr(12,2)).toLowerCase()),l[s]=[n,i,o,c[u],function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}(u)],void 0===d[u]?d[u]=1:d[u]+=1;else if("CONECT"===p[m].substr(0,6)){var v=parseInt(p[m].substr(6,5));a(11,5),a(16,5),a(21,5),a(26,5)}return function(){var e,t,r={geometryAtoms:new THREE.BufferGeometry,geometryBonds:new THREE.BufferGeometry,json:{atoms:l,bonds:h}},a=r.geometryAtoms,n=r.geometryBonds,i=[],o=[],s=[];for(e=0,t=l.length;e<t;e++){var u=l[e],c=u[0],d=u[1],f=u[2];i.push(c,d,f);var p=u[3][0]/255,m=u[3][1]/255,E=u[3][2]/255;o.push(p,m,E)}for(e=0,t=h.length;e<t;e++){var v=h[e],g=v[0],y=v[1];s.push(i[3*g+0]),s.push(i[3*g+1]),s.push(i[3*g+2]),s.push(i[3*y+0]),s.push(i[3*y+1]),s.push(i[3*y+2])}return a.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),a.addAttribute("color",new THREE.Float32BufferAttribute(o,3)),n.addAttribute("position",new THREE.Float32BufferAttribute(s,3)),r}()}}},function(e,t){THREE.PlayCanvasLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.PlayCanvasLoader.prototype={constructor:THREE.PlayCanvasLoader,load:function(e,t,r,a){var n=this;new THREE.FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},r,a)},parse:function(e){for(var t=e.model,r=0,a=t.vertices.length;r<a;r++)!function(e){var t={};for(var r in e){var a,n=e[r],i=n.type,o=n.components;switch(i){case"float32":a=new THREE.Float32BufferAttribute(n.data,o);break;case"uint8":a=new THREE.Uint8BufferAttribute(n.data,o);break;case"uint16":a=new THREE.Uint16BufferAttribute(n.data,o);break;default:console.log('THREE.PlayCanvasLoader: Array type "%s" not yet supported.',i)}t[r]=a}e._attributes=t}(t.vertices[r]);for(var r=0,a=t.meshes.length;r<a;r++)!function(e){var r=new THREE.BufferGeometry;r.setIndex(e.indices);var a=t.vertices[e.vertices]._attributes;for(var n in a){var i=a[n];"texCoord0"===n&&(n="uv"),r.addAttribute(n,i)}e._geometry=r}(t.meshes[r]);for(var r=0,a=t.meshInstances.length;r<a;r++)!function(e){var r=t.nodes[e.node],a=t.meshes[e.mesh];void 0===r._geometries&&(r._geometries=[]),r._geometries.push(a._geometry)}(t.meshInstances[r]);for(var r=0,a=t.nodes.length;r<a;r++)!function(e){var t=new THREE.Group,r=e._geometries;if(void 0!==r)for(var a=new THREE.MeshPhongMaterial,n=0,i=r.length;n<i;n++){var o=r[n];t.add(new THREE.Mesh(o,a))}for(var n=0,i=e.rotation.length;n<i;n++)e.rotation[n]*=Math.PI/180;t.name=e.name,t.position.fromArray(e.position),t.rotation.fromArray(e.rotation),t.scale.fromArray(e.scale),e._object=t}(t.nodes[r]);for(var r=0,a=t.parents.length;r<a;r++){var n=t.parents[r];-1!==n&&t.nodes[n]._object.add(t.nodes[r]._object)}return t.nodes[0]._object}}},function(e,t){THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t=/ply([\s\S]*)end_header\s/,r="",a=0,n=t.exec(e);null!==n&&(r=n[1],a=n[0].length);for(var i,o,s,u={comments:[],elements:[],headerLength:a},c=r.split("\n"),h=0;h<c.length;h++){var d=c[h];if(""!==(d=d.trim()))switch(s=d.split(/\s+/),o=s.shift(),d=s.join(" "),o){case"format":u.format=s[0],u.version=s[1];break;case"comment":u.comments.push(d);break;case"element":void 0!==i&&u.elements.push(i),i={},i.name=s[0],i.count=parseInt(s[1]),i.properties=[];break;case"property":i.properties.push(function(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}(s,l.propertyNameMapping));break;default:console.log("unhandled",o,s)}}return void 0!==i&&u.elements.push(i),u}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function a(e,t){for(var a=t.split(/\s+/),n={},i=0;i<e.length;i++)if("list"===e[i].type){for(var o=[],s=r(a.shift(),e[i].countType),u=0;u<s;u++)o.push(r(a.shift(),e[i].itemType));n[e[i].name]=o}else n[e[i].name]=r(a.shift(),e[i].type);return n}function n(e,t){var r,n={indices:[],vertices:[],normals:[],uvs:[],colors:[]},s=/end_header\s([\s\S]*)$/,u="";null!==(r=s.exec(e))&&(u=r[1]);for(var c=u.split("\n"),l=0,h=0,d=0;d<c.length;d++){var f=c[d];if(""!==(f=f.trim())){h>=t.elements[l].count&&(l++,h=0);var p=a(t.elements[l].properties,f);o(n,t.elements[l].name,p),h++}}return i(n)}function i(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var a=r.vertex_indices||r.vertex_index;3===a.length?e.indices.push(a[0],a[1],a[2]):4===a.length&&(e.indices.push(a[0],a[1],a[3]),e.indices.push(a[1],a[2],a[3]))}}function s(e,t,r,a){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,a),2];case"uint16":case"ushort":return[e.getUint16(t,a),2];case"int32":case"int":return[e.getInt32(t,a),4];case"uint32":case"uint":return[e.getUint32(t,a),4];case"float32":case"float":return[e.getFloat32(t,a),4];case"float64":case"double":return[e.getFloat64(t,a),8]}}function u(e,t,r,a){for(var n,i={},o=0,u=0;u<r.length;u++)if("list"===r[u].type){var c=[];n=s(e,t+o,r[u].countType,a);var l=n[0];o+=n[1];for(var h=0;h<l;h++)n=s(e,t+o,r[u].itemType,a),c.push(n[0]),o+=n[1];i[r[u].name]=c}else n=s(e,t+o,r[u].type,a),i[r[u].name]=n[0],o+=n[1];return[i,o]}var c,l=this;if(e instanceof ArrayBuffer){var h=THREE.LoaderUtils.decodeText(new Uint8Array(e)),d=t(h);c="ascii"===d.format?n(h,d):function(e,t){for(var r,a={indices:[],vertices:[],normals:[],uvs:[],colors:[]},n="binary_little_endian"===t.format,s=new DataView(e,t.headerLength),c=0,l=0;l<t.elements.length;l++)for(var h=0;h<t.elements[l].count;h++){r=u(s,c,t.elements[l].properties,n),c+=r[1];var d=r[0];o(a,t.elements[l].name,d)}return i(a)}(e,d)}else c=n(e,t(e));return c}}},function(e,t){!function(e){"use strict";function t(){if(null===n){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);t[0]=170,t[1]=187,n=43707===r[0]}return n}function r(e,r,a,n,i){var s,u=r.BYTES_PER_ELEMENT;if(i===t()||1===u)s=new r(e,a,n);else{var c=new DataView(e,a,n*u),l=o[r.name],h=!i,d=0;for(s=new r(n);d<n;d++)s[d]=c[l](d*u,h)}return s}function a(e){var t=new Uint8Array(e),a=t[0],n=t[1],o=!!(n>>7&1),s=n>>6&1,u=1==(n>>5&1),c=31&n,l=0,h=0;if(u?(l=(t[2]<<16)+(t[3]<<8)+t[4],h=(t[5]<<16)+(t[6]<<8)+t[7]):(l=t[2]+(t[3]<<8)+(t[4]<<16),h=t[5]+(t[6]<<8)+(t[7]<<16)),0===a)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==a)throw new Error("PRWM decoder: Unsupported format version: "+a);if(!o){if(0!==s)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==h)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var d,f,p,m,E,v,g,y,T,b=8,R={};for(T=0;T<c;T++){for(d="";b<t.length&&(f=t[b],b++,0!==f);)d+=String.fromCharCode(f);n=t[b],p=n>>7&1,m=1+(n>>4&3),E=15&n,v=i[E],b++,b=4*Math.ceil(b/4),g=r(e,v,b,m*l,u),b+=v.BYTES_PER_ELEMENT*m*l,R[d]={type:p,cardinality:m,values:g}}return b=4*Math.ceil(b/4),y=null,o&&(y=r(e,1===s?Uint32Array:Uint16Array,b,h,u)),{version:a,attributes:R,indices:y}}var n=null,i=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],o={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};e.PRWMLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.PRWMLoader.prototype={constructor:e.PRWMLoader,load:function(r,a,n,i){var o=this,s=new e.FileLoader(o.manager);s.setResponseType("arraybuffer"),r=r.replace(/\*/g,t()?"be":"le"),s.load(r,function(e){a(o.parse(e))},n,i)},parse:function(t){console.time("PRWMLoader");var r,n,i=a(t),o=Object.keys(i.attributes),s=new e.BufferGeometry;for(n=0;n<o.length;n++)r=i.attributes[o[n]],s.addAttribute(o[n],new e.BufferAttribute(r.values,r.cardinality,r.normalized));return null!==i.indices&&s.setIndex(new e.BufferAttribute(i.indices,1)),console.timeEnd("PRWMLoader"),s}},e.PRWMLoader.isBigEndianPlatform=function(){return t()}}(THREE)},function(e,t){THREE.PVRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(e,t){var r=new Uint32Array(e,0,13),a={buffer:e,header:r,loadMipmaps:t};return 55727696===r[0]?THREE.PVRLoader._parseV3(a):559044176===r[11]?THREE.PVRLoader._parseV2(a):void console.error("THREE.PVRLoader: Unknown PVR format.")},THREE.PVRLoader._parseV3=function(e){var t,r,a=e.header,n=a[12],i=a[2],o=a[6],s=a[7],u=a[10],c=a[11];switch(i){case 0:t=2,r=THREE.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,r=THREE.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,r=THREE.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,r=THREE.RGBA_PVRTC_4BPPV1_Format;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",i)}return e.dataPtr=52+n,e.bpp=t,e.format=r,e.width=s,e.height=o,e.numSurfaces=u,e.numMipmaps=c,e.isCubemap=6===u,THREE.PVRLoader._extract(e)},THREE.PVRLoader._parseV2=function(e){var t,r,a=e.header,n=a[0],i=a[1],o=a[2],s=a[3],u=a[4],c=a[10],l=a[12],h=255&u,d=c>0;return 25===h?(r=d?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,t=4):24===h?(r=d?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,t=2):console.error("THREE.PVRLoader: Unknown PVR format:",h),e.dataPtr=n,e.bpp=t,e.format=r,e.width=o,e.height=i,e.numSurfaces=l,e.numMipmaps=s+1,e.isCubemap=6===l,THREE.PVRLoader._extract(e)},THREE.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer,a=e.dataPtr,n=e.bpp,i=e.numSurfaces,o=0,s=0,u=0,c=0,l=0,h=0;2===n?(u=8,c=4):(u=4,c=4),s=u*c*n/8,t.mipmaps.length=e.numMipmaps*i;for(var d=0;d<e.numMipmaps;){var f=e.width>>d,p=e.height>>d;l=f/u,h=p/c,l<2&&(l=2),h<2&&(h=2),o=l*h*s;for(var m=0;m<i;m++){var E=new Uint8Array(r,a,o),v={data:E,width:f,height:p};t.mipmaps[m*e.numMipmaps+d]=v,a+=o}d++}return t}},function(e,t){THREE.HDRLoader=THREE.RGBELoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype),THREE.RGBELoader.prototype._parser=function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var a=e.pos,n=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));0>(n=s.indexOf("\n"))&&i<t&&a<e.byteLength;)o+=s,i+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return-1<n&&(!1!==r&&(e.pos+=i+n+1),o+s.slice(0,n))},a=new Uint8Array(e);a.byteLength;a.pos=0;var n=function(e){var a,n,i=/^#\?(\S+)$/,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,u=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(a=r(e)))return t(1,"no header found");if(!(n=a.match(i)))return t(3,"bad initial token");for(l.valid|=1,l.programtype=n[1],l.string+=a+"\n";;){if(!1===(a=r(e)))break;if(l.string+=a+"\n","#"!==a.charAt(0)){if((n=a.match(o))&&(l.gamma=parseFloat(n[1],10)),(n=a.match(s))&&(l.exposure=parseFloat(n[1],10)),(n=a.match(u))&&(l.valid|=2,l.format=n[1]),(n=a.match(c))&&(l.valid|=4,l.height=parseInt(n[1],10),l.width=parseInt(n[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=a+"\n"}return 2&l.valid?4&l.valid?l:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==n){var i=n.width,o=n.height,s=function(e,r,a){var n,i,o,s,u,c,l,h,d,f,p,m,E,v=r,g=a;if(v<8||v>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(v!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(n=new Uint8Array(4*r*a))||!n.length)return t(4,"unable to allocate buffer space");for(i=0,o=0,h=4*v,E=new Uint8Array(4),c=new Uint8Array(h);g>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(E[0]=e[o++],E[1]=e[o++],E[2]=e[o++],E[3]=e[o++],2!=E[0]||2!=E[1]||(E[2]<<8|E[3])!=v)return t(3,"bad rgbe scanline format");for(l=0;l<h&&o<e.byteLength;){if(s=e[o++],m=s>128,m&&(s-=128),0===s||l+s>h)return t(3,"bad scanline data");if(m)for(u=e[o++],d=0;d<s;d++)c[l++]=u;else c.set(e.subarray(o,o+s),l),l+=s,o+=s}for(f=v,d=0;d<f;d++)p=0,n[i]=c[d+p],p+=v,n[i+1]=c[d+p],p+=v,n[i+2]=c[d+p],p+=v,n[i+3]=c[d+p],i+=4;g--}return n}(a.subarray(a.pos),i,o);if(-1!==s)return{width:i,height:o,data:s,header:n.string,gamma:n.gamma,exposure:n.exposure,format:THREE.RGBEFormat,type:THREE.UnsignedByteType}}return null}},function(e,t){THREE.STLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){try{t(n.parse(e))}catch(e){a&&a(e)}},r,a)},parse:function(e){var t=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var t,r,a;if(a=new DataView(e),t=50,r=a.getUint32(80,!0),84+r*t===a.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(n[i]!=a.getUint8(i,!1))return!0;return!1}(t)?function(e){for(var t,r,a,n,i,o,s,u,c=new DataView(e),l=c.getUint32(80,!0),h=!1,d=0;d<70;d++)1129270351==c.getUint32(d,!1)&&82==c.getUint8(d+4)&&61==c.getUint8(d+5)&&(h=!0,n=[],i=c.getUint8(d+6)/255,o=c.getUint8(d+7)/255,s=c.getUint8(d+8)/255,u=c.getUint8(d+9)/255);for(var f=new THREE.BufferGeometry,p=[],m=[],E=0;E<l;E++){var v=84+50*E,g=c.getFloat32(v,!0),y=c.getFloat32(v+4,!0),T=c.getFloat32(v+8,!0);if(h){var b=c.getUint16(v+48,!0);0==(32768&b)?(t=(31&b)/31,r=(b>>5&31)/31,a=(b>>10&31)/31):(t=i,r=o,a=s)}for(var R=1;R<=3;R++){var A=v+12*R;p.push(c.getFloat32(A,!0)),p.push(c.getFloat32(A+4,!0)),p.push(c.getFloat32(A+8,!0)),m.push(g,y,T),h&&n.push(t,r,a)}}return f.addAttribute("position",new THREE.BufferAttribute(new Float32Array(p),3)),f.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(m),3)),h&&(f.addAttribute("color",new THREE.BufferAttribute(new Float32Array(n),3)),f.hasColors=!0,f.alpha=u),f}(t):function(e){for(var t,r=new THREE.BufferGeometry,a=/facet([\s\S]*?)endfacet/g,n=0,i=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,o=new RegExp("vertex"+i+i+i,"g"),s=new RegExp("normal"+i+i+i,"g"),u=[],c=[],l=new THREE.Vector3;null!==(t=a.exec(e));){for(var h=0,d=0,f=t[0];null!==(t=s.exec(f));)l.x=parseFloat(t[1]),l.y=parseFloat(t[2]),l.z=parseFloat(t[3]),d++;for(;null!==(t=o.exec(f));)u.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),c.push(l.x,l.y,l.z),h++;1!==d&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+n),3!==h&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+n),n++}return r.addAttribute("position",new THREE.Float32BufferAttribute(u,3)),r.addAttribute("normal",new THREE.Float32BufferAttribute(c,3)),r}(function(e){return"string"!=typeof e?THREE.LoaderUtils.decodeText(new Uint8Array(e)):e}(e))}}},function(e,t){THREE.SVGLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.SVGLoader.prototype={constructor:THREE.SVGLoader,load:function(e,t,r,a){var n=this,i=new DOMParser;new THREE.FileLoader(n.manager).load(e,function(e){var r=i.parseFromString(e,"image/svg+xml");t(r.documentElement)},r,a)}}},function(e,t,r){"use strict";THREE.TDSLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]},THREE.TDSLoader.prototype={constructor:THREE.TDSLoader,load:function(e,t,r,a){var n=this,i=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e,i))},r,a)},parse:function(e,t){this.group=new THREE.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(e,t){var r=new DataView(e),s=this.readChunk(r);if(s.id===n||s.id===i||s.id===a)for(var u=this.nextChunk(r,s);0!==u;){if(u===o){var c=this.readDWord(r);this.debugMessage("3DS file version: "+c)}else u===h?(this.resetPosition(r),this.readMeshData(r,t)):this.debugMessage("Unknown main chunk: "+u.toString(16));u=this.nextChunk(r,s)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var r=this.readChunk(e),a=this.nextChunk(e,r);0!==a;){if(a===d){var n=+this.readDWord(e);this.debugMessage("Mesh Version: "+n)}else if(a===f){var i=this.readFloat(e);this.debugMessage("Master scale: "+i),this.group.scale.set(i,i,i)}else a===S?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):a===p?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+a.toString(16));a=this.nextChunk(e,r)}},readNamedObject:function(e){var t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;for(var a=this.nextChunk(e,t);0!==a;){if(a===I){this.resetPosition(e);var n=this.readMesh(e);n.name=r,this.meshes.push(n)}else this.debugMessage("Unknown named object chunk: "+a.toString(16));a=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var r=this.readChunk(e),a=this.nextChunk(e,r),n=new THREE.MeshPhongMaterial;0!==a;){if(a===m)n.name=this.readString(e,64),this.debugMessage("   Name: "+n.name);else if(a===R)this.debugMessage("   Wireframe"),n.wireframe=!0;else if(a===A){var i=this.readByte(e);n.wireframeLinewidth=i,this.debugMessage("   Wireframe Thickness: "+i)}else if(a===T)n.side=THREE.DoubleSide,this.debugMessage("   DoubleSided");else if(a===b)this.debugMessage("   Additive Blending"),n.blending=THREE.AdditiveBlending;else if(a===v)this.debugMessage("   Diffuse Color"),n.color=this.readColor(e);else if(a===g)this.debugMessage("   Specular Color"),n.specular=this.readColor(e);else if(a===E)this.debugMessage("   Ambient color"),n.color=this.readColor(e);else if(a===y){var o=this.readWord(e);n.shininess=o,this.debugMessage("   Shininess : "+o)}else a===w?(this.debugMessage("   ColorMap"),this.resetPosition(e),n.map=this.readMap(e,t)):a===x?(this.debugMessage("   BumpMap"),this.resetPosition(e),n.bumpMap=this.readMap(e,t)):a===H?(this.debugMessage("   OpacityMap"),this.resetPosition(e),n.alphaMap=this.readMap(e,t)):a===M?(this.debugMessage("   SpecularMap"),this.resetPosition(e),n.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+a.toString(16));a=this.nextChunk(e,r)}this.endChunk(r),this.materials[n.name]=n},readMesh:function(e){var t=this.readChunk(e),r=this.nextChunk(e,t),a=null,n=[];a=new THREE.Geometry;var i=new THREE.MeshPhongMaterial,o=new THREE.Mesh(a,i);for(o.name="mesh";0!==r;){if(r===N){var s=this.readWord(e);this.debugMessage("   Vertex: "+s);for(var u,u=0;u<s;u++)a.vertices.push(new THREE.Vector3(this.readFloat(e),this.readFloat(e),this.readFloat(e)))}else if(r===O)this.resetPosition(e),this.readFaceArray(e,o);else if(r===P){var c=this.readWord(e);this.debugMessage("   UV: "+c);var n,u;n=[];for(var u=0;u<c;u++)n.push(new THREE.Vector2(this.readFloat(e),this.readFloat(e)))}else if(r===U){this.debugMessage("   Tranformation Matrix (TODO)");for(var l=[],u=0;u<12;u++)l[u]=this.readFloat(e);var h=new THREE.Matrix4;h.elements[0]=l[0],h.elements[1]=l[6],h.elements[2]=l[3],h.elements[3]=l[9],h.elements[4]=l[2],h.elements[5]=l[8],h.elements[6]=l[5],h.elements[7]=l[11],h.elements[8]=l[1],h.elements[9]=l[7],h.elements[10]=l[4],h.elements[11]=l[10],h.elements[12]=0,h.elements[13]=0,h.elements[14]=0,h.elements[15]=1,h.transpose();var d=new THREE.Matrix4;d.getInverse(h,!0),a.applyMatrix(d),h.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}if(this.endChunk(t),n.length>0){for(var f=[],u=0;u<a.faces.length;u++)f.push([n[a.faces[u].a],n[a.faces[u].b],n[a.faces[u].c]]);a.faceVertexUvs[0]=f}return a.computeVertexNormals(),o},readFaceArray:function(e,t){var r=this.readChunk(e),a=this.readWord(e);this.debugMessage("   Faces: "+a);for(var n=0;n<a;++n){t.geometry.faces.push(new THREE.Face3(this.readWord(e),this.readWord(e),this.readWord(e)));this.readWord(e)}for(;this.position<r.end;){var r=this.readChunk(e);if(r.id===B){this.debugMessage("      Material Group"),this.resetPosition(e);var i=this.readMaterialGroup(e),o=this.materials[i.name];void 0!==o&&(t.material=o,""===o.name&&(o.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(e,t){var r=this.readChunk(e),a=this.nextChunk(e,r),n={},i=new THREE.TextureLoader(this.manager);for(i.setPath(t);0!==a;){if(a===_){var o=this.readString(e,128);n=i.load(o),this.debugMessage("      File: "+t+o)}else a===k?(n.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+n.offset.x)):a===C?(n.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+n.offset.y)):a===L?(n.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+n.repeat.x)):a===F?(n.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+n.repeat.y)):this.debugMessage("      Unknown map chunk: "+a.toString(16));a=this.nextChunk(e,r)}return this.endChunk(r),n},readMaterialGroup:function(e){var t=(this.readChunk(e),this.readString(e,64)),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);for(var a=[],n=0;n<r;++n)a.push(this.readWord(e));return{name:t,index:a}},readColor:function(e){var t=this.readChunk(e),r=new THREE.Color;if(t.id===u||t.id===c){var a=this.readByte(e),n=this.readByte(e),i=this.readByte(e);r.setRGB(a/255,n/255,i/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===s||t.id===l){var a=this.readFloat(e),n=this.readFloat(e),i=this.readFloat(e);r.setRGB(a,n,i),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var r=this.readChunk(e);return t.cur+=r.size,r.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var r="",a=0;a<t;a++){var n=this.readByte(e);if(!n)break;r+=String.fromCharCode(n)}return r},setPath:function(e){return this.path=e,this},debugMessage:function(e){this.debug&&console.log(e)}};var a=19789,n=15786,i=49725,o=2,s=16,u=17,c=18,l=19,h=15677,d=15678,f=256,p=45055,m=40960,E=40976,v=40992,g=41008,y=41024,T=41089,b=41091,R=41093,A=41095,w=41472,H=41488,x=41520,M=41476,_=41728,L=41812,F=41814,k=41816,C=41818,S=16384,I=16640,N=16656,O=16672,B=16688,P=16704,U=16736},function(e,t){THREE.TGALoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TGALoader.prototype={constructor:THREE.TGALoader,load:function(e,t,r,a){var n=this,i=new THREE.Texture,o=new THREE.FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.load(e,function(e){i.image=n.parse(e),i.needsUpdate=!0,void 0!==t&&t(i)},r,a),i},parse:function(e){function t(e,t,r,a,n,i,o,s,u){var c,l,h,d=u,f=0,p=R.width;for(h=t;h!==a;h+=r)for(l=n;l!==o;l+=i,f++)c=s[f],e[4*(l+p*h)+3]=255,e[4*(l+p*h)+2]=d[3*c+0],e[4*(l+p*h)+1]=d[3*c+1],e[4*(l+p*h)+0]=d[3*c+2];return e}function r(e,t,r,a,n,i,o,s){var u,c,l,h=0,d=R.width;for(l=t;l!==a;l+=r)for(c=n;c!==o;c+=i,h+=2)u=s[h+0]+(s[h+1]<<8),e[4*(c+d*l)+0]=(31744&u)>>7,e[4*(c+d*l)+1]=(992&u)>>2,e[4*(c+d*l)+2]=(31&u)>>3,e[4*(c+d*l)+3]=32768&u?0:255;return e}function a(e,t,r,a,n,i,o,s){var u,c,l=0,h=R.width;for(c=t;c!==a;c+=r)for(u=n;u!==o;u+=i,l+=3)e[4*(u+h*c)+3]=255,e[4*(u+h*c)+2]=s[l+0],e[4*(u+h*c)+1]=s[l+1],e[4*(u+h*c)+0]=s[l+2];return e}function n(e,t,r,a,n,i,o,s){var u,c,l=0,h=R.width;for(c=t;c!==a;c+=r)for(u=n;u!==o;u+=i,l+=4)e[4*(u+h*c)+2]=s[l+0],e[4*(u+h*c)+1]=s[l+1],e[4*(u+h*c)+0]=s[l+2],e[4*(u+h*c)+3]=s[l+3];return e}function i(e,t,r,a,n,i,o,s){var u,c,l,h=0,d=R.width;for(l=t;l!==a;l+=r)for(c=n;c!==o;c+=i,h++)u=s[h],e[4*(c+d*l)+0]=u,e[4*(c+d*l)+1]=u,e[4*(c+d*l)+2]=u,e[4*(c+d*l)+3]=255;return e}function o(e,t,r,a,n,i,o,s){var u,c,l=0,h=R.width;for(c=t;c!==a;c+=r)for(u=n;u!==o;u+=i,l+=2)e[4*(u+h*c)+0]=s[l+0],e[4*(u+h*c)+1]=s[l+0],e[4*(u+h*c)+2]=s[l+0],e[4*(u+h*c)+3]=s[l+1];return e}var s=0,u=1,c=2,l=3,h=9,d=10,f=11,p=48,m=4,E=0,v=1,g=2,y=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var T=new Uint8Array(e),b=0,R={id_length:T[b++],colormap_type:T[b++],image_type:T[b++],colormap_index:T[b++]|T[b++]<<8,colormap_length:T[b++]|T[b++]<<8,colormap_size:T[b++],origin:[T[b++]|T[b++]<<8,T[b++]|T[b++]<<8],width:T[b++]|T[b++]<<8,height:T[b++]|T[b++]<<8,pixel_size:T[b++],flags:T[b++]};!function(e){switch(e.image_type){case u:case h:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case c:case l:case d:case f:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case s:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(R),R.id_length+b>e.length&&console.error("THREE.TGALoader: No data."),b+=R.id_length;var A=!1,w=!1,H=!1;switch(R.image_type){case h:A=!0,w=!0;break;case u:w=!0;break;case d:A=!0;break;case c:break;case f:A=!0,H=!0;break;case l:H=!0}var x=document.createElement("canvas");x.width=R.width,x.height=R.height;var M=x.getContext("2d"),_=M.createImageData(R.width,R.height),L=function(e,t,r,a,n){var i,o,s,u;if(o=r.pixel_size>>3,s=r.width*r.height*o,t&&(u=n.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){i=new Uint8Array(s);for(var c,l,h,d=0,f=new Uint8Array(o);d<s;)if(c=n[a++],l=1+(127&c),128&c){for(h=0;h<o;++h)f[h]=n[a++];for(h=0;h<l;++h)i.set(f,d+h*o);d+=o*l}else{for(l*=o,h=0;h<l;++h)i[d+h]=n[a++];d+=l}}else i=n.subarray(a,a+=t?r.width*r.height:s);return{pixel_data:i,palettes:u}}(A,w,R,b,T);!function(e,s,u,c,l){var h,d,f,T,b,A;switch((R.flags&p)>>m){default:case g:h=0,f=1,b=s,d=0,T=1,A=u;break;case E:h=0,f=1,b=s,d=u-1,T=-1,A=-1;break;case y:h=s-1,f=-1,b=-1,d=0,T=1,A=u;break;case v:h=s-1,f=-1,b=-1,d=u-1,T=-1,A=-1}if(H)switch(R.pixel_size){case 8:i(e,d,T,A,h,f,b,c);break;case 16:o(e,d,T,A,h,f,b,c);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(R.pixel_size){case 8:t(e,d,T,A,h,f,b,c,l);break;case 16:r(e,d,T,A,h,f,b,c);break;case 24:a(e,d,T,A,h,f,b,c);break;case 32:n(e,d,T,A,h,f,b,c);break;default:console.error("THREE.TGALoader: Format not supported.")}}(_.data,R.width,R.height,L.pixel_data,L.palettes);return M.putImageData(_,0,0),x}}},function(e,t){THREE.TTFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.reversed=!1},THREE.TTFLoader.prototype={constructor:THREE.TTFLoader,load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e){var t,r=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});var a=[];return r.forEach(function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};a.push(t);for(var r=e.length-1;r>0;r--){var n=e[r],t={type:n.type};void 0!==n.x2&&void 0!==n.y2?(t.x1=n.x2,t.y1=n.y2,t.x2=n.x1,t.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(t.x1=n.x1,t.y1=n.y1),t.x=e[r-1].x,t.y=e[r-1].y,a.push(t)}}),a}return"undefined"==typeof opentype?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){for(var a=Math.round,n={},i=1e5/(72*(e.unitsPerEm||2048)),o=0;o<e.glyphs.length;o++){var s=e.glyphs.glyphs[o];if(void 0!==s.unicode){var u={ha:a(s.advanceWidth*i),x_min:a(s.xMin*i),x_max:a(s.xMax*i),o:""};r&&(s.path.commands=t(s.path.commands)),s.path.commands.forEach(function(e,t){"c"===e.type.toLowerCase()&&(e.type="b"),u.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(u.o+=a(e.x*i)+" "+a(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(u.o+=a(e.x1*i)+" "+a(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(u.o+=a(e.x2*i)+" "+a(e.y2*i)+" ")}),n[String.fromCharCode(s.unicode)]=u}}return{glyphs:n,familyName:e.familyName,ascender:a(e.ascender*i),descender:a(e.descender*i),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}}},function(e,t){function r(e,t,r){(new THREE.FileLoader).load(e,t,r)}function a(e,t){r(e,function(e){t(JSON.parse(e))},function(){})}THREE.UTF8Loader=function(){},THREE.UTF8Loader.prototype.load=function(e,t,r){this.downloadModelJson(e,t,r)},THREE.UTF8Loader.BufferGeometryCreator=function(){},THREE.UTF8Loader.BufferGeometryCreator.prototype.create=function(e,t){var r,a,n,i=t.length/3,o=new THREE.BufferGeometry,s=new Float32Array(3*i*3),u=new Float32Array(3*i*3),c=new Float32Array(3*i*2),l=e.length;for(a=0,n=0,r=n;r<l;r+=8)s[a++]=e[r],s[a++]=e[r+1],s[a++]=e[r+2];for(a=0,n=3,r=n;r<l;r+=8)c[a++]=e[r],c[a++]=e[r+1];for(a=0,n=5,r=n;r<l;r+=8)u[a++]=e[r],u[a++]=e[r+1],u[a++]=e[r+2];return o.setIndex(new THREE.BufferAttribute(t,1)),o.addAttribute("position",new THREE.BufferAttribute(s,3)),o.addAttribute("normal",new THREE.BufferAttribute(u,3)),o.addAttribute("uv",new THREE.BufferAttribute(c,2)),o.computeBoundingSphere(),o};var n={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};THREE.UTF8Loader.prototype.decompressAttribsInner_=function(e,t,r,a,n,i,o,s){for(var u=0,c=t;c<r;c++){var l=e.charCodeAt(c);u+=l>>1^-(1&l),a[n]=s*(u+o),n+=i}},THREE.UTF8Loader.prototype.decompressIndices_=function(e,t,r,a,n){for(var i=0,o=0;o<r;o++){var s=e.charCodeAt(t++);a[n++]=i-s,0===s&&i++}},THREE.UTF8Loader.prototype.decompressAABBs_=function(e,t,r,a,n){for(var i=6*r,o=t+i,s=0,u=new Float32Array(i),c=t;c<o;c+=6){var l=e.charCodeAt(c+0)+a[0],h=e.charCodeAt(c+1)+a[1],d=e.charCodeAt(c+2)+a[2],f=e.charCodeAt(c+3)+1>>1,p=e.charCodeAt(c+4)+1>>1,m=e.charCodeAt(c+5)+1>>1;u[s++]=n[0]*(l+f),u[s++]=n[1]*(h+p),u[s++]=n[2]*(d+m),u[s++]=n[0]*f,u[s++]=n[1]*p,u[s++]=n[2]*m}return u},THREE.UTF8Loader.prototype.decompressMesh=function(e,t,r,a,n,i){for(var o=r.decodeScales.length,s=r.decodeOffsets,u=r.decodeScales,c=t.attribRange[0],l=t.attribRange[1],h=c,d=new Float32Array(o*l),f=0;f<o;f++){var p=h+l,m=u[f];m&&this.decompressAttribsInner_(e,h,p,d,f,o,s[f],m),h=p}var E=3*t.indexRange[1],v=new Uint16Array(E);this.decompressIndices_(e,h,E,v,0);var g=void 0,y=t.bboxes;y&&(g=this.decompressAABBs_(e,y,t.names.length,s,u)),i(a,n,d,v,g,t)},THREE.UTF8Loader.prototype.copyAttrib=function(e,t,r,a){for(var n=0;n<e;n++)r[n]=t[e*a+n]},THREE.UTF8Loader.prototype.decodeAttrib2=function(e,t,r,a,n,i,o,s,u,c){for(var l=0;l<5;l++){var h=e.charCodeAt(n+i*l+c),d=h>>1^-(1&h);u[l]+=d,s[t*c+l]=u[l],o[t*c+l]=a[l]*(u[l]+r[l])}},THREE.UTF8Loader.prototype.accumulateNormal=function(e,t,r,a,n){var i=a[8*e],o=a[8*e+1],s=a[8*e+2],u=a[8*t],c=a[8*t+1],l=a[8*t+2],h=a[8*r],d=a[8*r+1],f=a[8*r+2];u-=i,c-=o,l-=s,h-=i,d-=o,f-=s,i=c*f-l*d,o=l*h-u*f,s=u*d-c*h,n[3*e]+=i,n[3*e+1]+=o,n[3*e+2]+=s,n[3*t]+=i,n[3*t+1]+=o,n[3*t+2]+=s,n[3*r]+=i,n[3*r+1]+=o,n[3*r+2]+=s},THREE.UTF8Loader.prototype.decompressMesh2=function(e,t,r,a,n,i){for(var o=r.decodeScales.length,s=r.decodeOffsets,u=r.decodeScales,c=t.attribRange[0],l=t.attribRange[1],h=t.codeRange[0],d=3*t.codeRange[2],f=new Uint16Array(d),p=new Int32Array(3*l),m=new Uint16Array(o),E=new Uint16Array(o*l),v=new Float32Array(o*l),g=0,y=0,T=0;T<d;T+=3){var b=e.charCodeAt(h++),R=Math.min(T,96);if(b<R){var A,w,H,x=b%3,M=T-(b-x);switch(x){case 0:A=f[M+2],w=f[M+1],H=f[M+0];break;case 1:A=f[M+0],w=f[M+2],H=f[M+1];break;case 2:A=f[M+1],w=f[M+0],H=f[M+2]}f[y++]=A,f[y++]=w,b=e.charCodeAt(h++);var _=g-b;if(f[y++]=_,0===b){for(var L=0;L<5;L++){var F=e.charCodeAt(c+l*L+g),k=(F>>1^-(1&F))+E[o*A+L]+E[o*w+L]-E[o*H+L];m[L]=k,E[o*g+L]=k,v[o*g+L]=u[L]*(k+s[L])}g++}else this.copyAttrib(o,E,m,_);this.accumulateNormal(A,w,_,E,p)}else{var C=g-(b-R);f[y++]=C,b===R?this.decodeAttrib2(e,o,s,u,c,l,v,E,m,g++):this.copyAttrib(o,E,m,C),b=e.charCodeAt(h++);var S=g-b;f[y++]=S,0===b?this.decodeAttrib2(e,o,s,u,c,l,v,E,m,g++):this.copyAttrib(o,E,m,S),b=e.charCodeAt(h++);var I=g-b;if(f[y++]=I,0===b){for(var L=0;L<5;L++)m[L]=(E[o*C+L]+E[o*S+L])/2;this.decodeAttrib2(e,o,s,u,c,l,v,E,m,g++)}else this.copyAttrib(o,E,m,I);this.accumulateNormal(C,S,I,E,p)}}for(var T=0;T<l;T++){var N=p[3*T],O=p[3*T+1],B=p[3*T+2],P=511/Math.sqrt(N*N+O*O+B*B),U=e.charCodeAt(c+5*l+T),D=e.charCodeAt(c+6*l+T),V=e.charCodeAt(c+7*l+T);v[o*T+5]=P*N+(U>>1^-(1&U)),v[o*T+6]=P*O+(D>>1^-(1&D)),v[o*T+7]=P*B+(V>>1^-(1&V))}i(a,n,v,f,void 0,t)},THREE.UTF8Loader.prototype.downloadMesh=function(e,t,a,n,i){function o(e){for(;u<a.length;){var r=a[u],o=r.indexRange;if(o){var c=o[0]+3*o[1];if(e.length<c)break;s.decompressMesh(e,r,n,t,u,i)}else{var l=r.codeRange,c=l[0]+l[1];if(e.length<c)break;s.decompressMesh2(e,r,n,t,u,i)}++u}}var s=this,u=0;r(e,function(e){o(e)})},THREE.UTF8Loader.prototype.downloadMeshes=function(e,t,r,a){for(var n in t){var i=t[n];this.downloadMesh(e+n,n,i,r,a)}},THREE.UTF8Loader.prototype.createMeshCallback=function(e,t,r){var a=0,n=0,i={},o={},s={},u=t.urls;for(var c in u)i[c]=u[c].length,o[c]=0,n++,s[c]=new THREE.Object3D;var l=new THREE.Object3D,h=new THREE.MTLLoader.MaterialCreator(e,t.options);h.setMaterials(t.materials),h.preload();var d=new THREE.UTF8Loader.BufferGeometryCreator;return function(e,t,u,c,f,p){var m=d.create(u,c),E=h.create(p.material),v=new THREE.Mesh(m,E);s[e].add(v),++o[e]===i[e]&&(a++,l.add(s[e]),a===n&&r(l))}},THREE.UTF8Loader.prototype.downloadModel=function(e,t,r,a){var n=this.createMeshCallback(t,r,a);this.downloadMeshes(e,r.urls,r.decodeParams,n)},THREE.UTF8Loader.prototype.downloadModelJson=function(e,t,r){a(e,function(a){a.decodeParams||(r&&r.decodeParams?a.decodeParams=r.decodeParams:a.decodeParams=n),a.options=r;var i=e.substr(0,e.lastIndexOf("/")+1),o=i;r&&r.geometryBase&&(i=r.geometryBase,"/"!==i.charAt(i.length-1)&&(i+="/")),r&&r.materialBase&&(o=r.materialBase,"/"!==o.charAt(o.length-1)&&(o+="/")),this.downloadModel(i,o,a,t)}.bind(this))}},function(e,t){THREE.VRMLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.VRMLLoader.prototype={constructor:THREE.VRMLLoader,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this;new THREE.FileLoader(this.manager).load(e,function(e){t(n.parse(e))},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.texturePath||"",r=new THREE.TextureLoader(this.manager);r.setCrossOrigin(this.crossOrigin);for(var a=new THREE.Scene,n=e.split("\n"),i=n.length-1;i>-1;i--){var o=n[i];if(/{.*[{\[]/.test(o)){var s=o.split("{").join("{\n").split("\n");s.unshift(1),s.unshift(i),n.splice.apply(n,s)}else if(/\].*}/.test(o)){var s=o.split("]").join("]\n").split("\n");s.unshift(1),s.unshift(i),n.splice.apply(n,s)}if(/}.*}/.test(o)){var s=o.split("}").join("}\n").split("\n");s.unshift(1),s.unshift(i),n.splice.apply(n,s)}/^\b[^\s]+\b$/.test(o.trim())?(n[i+1]=o+" "+n[i+1].trim(),n.splice(i,1)):o.indexOf("coord")>-1&&o.indexOf("[")<0&&o.indexOf("{")<0&&(n[i]+=" Coordinate {}")}var u=n.shift();return/V1.0/.exec(u)?function(){console.warn("THREE.VRMLLoader: V1.0 not supported yet.")}():/V2.0/.exec(u)&&function(e,a){function n(e,t,r,a,n){for(var i=!0===n?1:-1,o=[],s={},u={},c=0;c<r.length;c++){var l={x:i*(Math.cos(r[c])*t),y:i*(Math.sin(r[c])*t)};o.push(l)}for(var h=e.index,d=e.attributes.position,f=new THREE.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),p=new THREE.Vector3,m=new THREE.Color,E=0;E<h.count;E++){var v=h.getX(E);p.fromBufferAttribute(d,v);for(var g=0;g<a.length;g++)if(0===g?(s.x=0,s.y=!0===n?t:-1*t):(s.x=o[g-1].x,s.y=o[g-1].y),void 0!==(u=o[g]))if(!0==(!0===n?p.y<=s.y&&p.y>u.y:p.y>=s.y&&p.y<u.y)){var y=a[g],T=a[g+1],b=Math.abs(p.y-s.y)/(s.y-u.y);m.copy(y).lerp(T,b),f.setXYZ(v,m.r,m.g,m.b)}else{var R=!0===n?a.length-1:0,A=a[R];f.setXYZ(v,A.r,A.g,A.b)}}e.addAttribute("color",f)}function i(e,t){for(var r,a,n,i=[],o={},s=/[^\s,\[\]]+/g;null!==(r=s.exec(t));)i.push(r[0]);switch(a=i[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=a,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=a,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=a,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":case"texCoordIndex":this.recordingFieldname=a,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(i.length>0)for(var d=0;d<i.length;d++)/(-?\d+)/.test(i[d])&&("-1"===i[d]?(h.length>0&&this.indexes.push(h),h=[]):h.push(parseInt(i[d])));/]/.exec(t)&&(h.length>0&&this.indexes.push(h),h=[],this.isRecordingFaces=!1,e[this.recordingFieldname]=this.indexes)}else if(this.isRecordingPoints){if("Coordinate"==e.nodeType)for(;null!==(i=l.exec(t));)n={x:parseFloat(i[1]),y:parseFloat(i[2]),z:parseFloat(i[3])},this.points.push(n);if("TextureCoordinate"==e.nodeType)for(;null!==(i=c.exec(t));)n={x:parseFloat(i[1]),y:parseFloat(i[2])},this.points.push(n);/]/.exec(t)&&(this.isRecordingPoints=!1,e.points=this.points)}else if(this.isRecordingAngles){if(i.length>0)for(var d=0;d<i.length;d++)u.test(i[d])&&this.angles.push(parseFloat(i[d]));/]/.exec(t)&&(this.isRecordingAngles=!1,e[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(i=l.exec(t));){var f={r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3])};this.colors.push(f)}/]/.exec(t)&&(this.isRecordingColors=!1,e[this.recordingFieldname]=this.colors)}else if("NULL"!==i[i.length-1]&&"children"!==a){switch(a){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==i.length){console.warn("THREE.VRMLLoader: Invalid color format detected for %s.",a);break}o={r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==i.length){console.warn("THREE.VRMLLoader: Invalid vector format detected for %s.",a);break}o={x:parseFloat(i[1]),y:parseFloat(i[2]),z:parseFloat(i[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!==i.length){console.warn("THREE.VRMLLoader: Invalid single float value specification detected for %s.",a);break}o=parseFloat(i[1]);break;case"rotation":if(5!==i.length){console.warn("THREE.VRMLLoader: Invalid quaternion format detected for %s.",a);break}o={x:parseFloat(i[1]),y:parseFloat(i[2]),z:parseFloat(i[3]),w:parseFloat(i[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==i.length){console.warn("THREE.VRMLLoader: Invalid format detected for %s.",a);break}o="TRUE"===i[1]}e[a]=o}return o}function o(e,i){var u;if("string"!=typeof e){u=i,e.string.indexOf("AmbientLight")>-1&&"PointLight"===e.nodeType&&(e.nodeType="AmbientLight");var c=void 0===e.on||e.on,l=void 0!==e.intensity?e.intensity:1,h=new THREE.Color;if(e.color&&h.copy(e.color),"AmbientLight"===e.nodeType)u=new THREE.AmbientLight(h,l),u.visible=c,i.add(u);else if("PointLight"===e.nodeType){var d=0;void 0!==e.radius&&e.radius<1e3&&(d=e.radius),u=new THREE.PointLight(h,l,d),u.visible=c,i.add(u)}else if("SpotLight"===e.nodeType){var l=1,d=0,f=Math.PI/3,c=!0;void 0!==e.radius&&e.radius<1e3&&(d=e.radius),void 0!==e.cutOffAngle&&(f=e.cutOffAngle),u=new THREE.SpotLight(h,l,d,f,0),u.visible=c,i.add(u)}else if("Transform"===e.nodeType||"Group"===e.nodeType){if(u=new THREE.Object3D,/DEF/.exec(e.string)&&(u.name=/DEF\s+([^\s]+)/.exec(e.string)[1],s[u.name]=u),void 0!==e.translation){var p=e.translation;u.position.set(p.x,p.y,p.z)}if(void 0!==e.rotation){var m=e.rotation;u.quaternion.setFromAxisAngle(new THREE.Vector3(m.x,m.y,m.z),m.w)}if(void 0!==e.scale){var E=e.scale;u.scale.set(E.x,E.y,E.z)}i.add(u)}else if("Shape"===e.nodeType)u=new THREE.Mesh,/DEF/.exec(e.string)&&(u.name=/DEF\s+([^\s]+)/.exec(e.string)[1],s[u.name]=u),i.add(u);else if("Background"===e.nodeType){var v=2e4,g=new THREE.SphereBufferGeometry(v,20,20),y=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide});if(e.skyColor.length>1)n(g,v,e.skyAngle,e.skyColor,!0),y.vertexColors=THREE.VertexColors;else{var T=e.skyColor[0];y.color.setRGB(T.r,T.b,T.g)}if(a.add(new THREE.Mesh(g,y)),void 0!==e.groundColor){v=12e3;var b=new THREE.SphereBufferGeometry(v,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),R=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:THREE.VertexColors});n(b,v,e.groundAngle,e.groundColor,!1),a.add(new THREE.Mesh(b,R))}}else{if(/geometry/.exec(e.string)){if("Box"===e.nodeType){var E=e.size;i.geometry=new THREE.BoxBufferGeometry(E.x,E.y,E.z)}else if("Cylinder"===e.nodeType)i.geometry=new THREE.CylinderBufferGeometry(e.radius,e.radius,e.height);else if("Cone"===e.nodeType)i.geometry=new THREE.CylinderBufferGeometry(e.topRadius,e.bottomRadius,e.height);else if("Sphere"===e.nodeType)i.geometry=new THREE.SphereBufferGeometry(e.radius);else if("IndexedFaceSet"===e.nodeType){var A,w,H,x,M,_,L=new THREE.BufferGeometry,F=[],k=[];for(H=0,x=e.children.length;H<x;H++){var C=e.children[H];if("TextureCoordinate"===C.nodeType&&C.points)for(M=0,_=C.points.length;M<_;M++)w=C.points[M],k.push(w.x,w.y);if("Coordinate"===C.nodeType){if(C.points)for(M=0,_=C.points.length;M<_;M++)A=C.points[M],F.push(A.x,A.y,A.z);if(C.string.indexOf("DEF")>-1){var S=/DEF\s+([^\s]+)/.exec(C.string)[1];s[S]=F.slice(0)}if(C.string.indexOf("USE")>-1){var I=/USE\s+([^\s]+)/.exec(C.string)[1];F=s[I]}}}var N=0;if(e.coordIndex){var O=[],B=[];for(A=new THREE.Vector3,w=new THREE.Vector2,H=0,x=e.coordIndex.length;H<x;H++){var P=e.coordIndex[H];for(N=0;P.length>=3&&N<P.length-2;){void 0===e.ccw&&(e.ccw=!0);var U=P[0],D=P[N+(e.ccw?1:2)],V=P[N+(e.ccw?2:1)];A.fromArray(F,3*U),w.fromArray(k,2*U),O.push(A.x,A.y,A.z),B.push(w.x,w.y),A.fromArray(F,3*D),w.fromArray(k,2*D),O.push(A.x,A.y,A.z),B.push(w.x,w.y),A.fromArray(F,3*V),w.fromArray(k,2*V),O.push(A.x,A.y,A.z),B.push(w.x,w.y),N++}}F=O,k=B}else i.parent.remove(i);!1===e.solid&&(i.material.side=THREE.DoubleSide),L.solid=e.solid,L.addAttribute("position",new THREE.Float32BufferAttribute(F,3)),k.length>0&&L.addAttribute("uv",new THREE.Float32BufferAttribute(k,2)),L.computeVertexNormals(),L.computeBoundingSphere(),/DEF/.exec(e.string)&&(L.name=/DEF ([^\s]+)/.exec(e.string)[1],s[L.name]=L),i.geometry=L}return}if(/appearance/.exec(e.string)){for(var H=0;H<e.children.length;H++){var C=e.children[H];if("Material"===C.nodeType){var G=new THREE.MeshPhongMaterial;if(void 0!==C.diffuseColor){var j=C.diffuseColor;G.color.setRGB(j.r,j.g,j.b)}if(void 0!==C.emissiveColor){var z=C.emissiveColor;G.emissive.setRGB(z.r,z.g,z.b)}if(void 0!==C.specularColor){var E=C.specularColor;G.specular.setRGB(E.r,E.g,E.b)}if(void 0!==C.transparency){var p=C.transparency;G.opacity=Math.abs(1-p),G.transparent=!0}/DEF/.exec(e.string)&&(G.name=/DEF ([^\s]+)/.exec(e.string)[1],s[G.name]=G),i.material=G}if("ImageTexture"===C.nodeType){var K=/"([^"]+)"/.exec(C.children[0]);K&&(i.material.name=K[1],i.material.map=r.load(t+K[1]))}}return}}for(var H=0,W=e.children.length;H<W;H++)o(e.children[H],u)}else if(/USE/.exec(e)){var I=/USE\s+?([^\s]+)/.exec(e)[1];void 0==s[I]?console.warn("THREE.VRMLLoader: %s is not defined.",I):/appearance/.exec(e)&&I?i.material=s[I].clone():/geometry/.exec(e)&&I?(i.geometry=s[I].clone(),void 0!==s[I].solid&&!1===s[I].solid&&(i.geometry.solid=!1,i.material.side=THREE.DoubleSide)):I&&(u=s[I].clone(),i.add(u))}}var s={},u=/(\b|\-|\+)([\d\.e]+)/,c=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,l=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,h=[];o(function(e){for(var t,r,a={string:"Scene",children:[]},n=a,o=0;o<e.length;o++){var s="",u=e[o];if(null===/^\s+?$/g.exec(u)&&""!==(u=u.trim())){if(/#/.exec(u)){var c=u.split("#");u=c[0],s=c[1]}if(t=/([^\s]*){1}(?:\s+)?{/.exec(u)){var l={nodeType:t[1],string:u,parent:n,children:[],comment:s};n.children.push(l),n=l,/}/.exec(u)&&(r=/{(.*)}/.exec(u)[1],l.children.push(r),i(n,r),n=n.parent)}else/}/.exec(u)?n=n.parent:""!==u&&(i(n,u),n.children.push(u))}}return a}(e),a)}(n,a),a}}},function(e,t){THREE.VTKLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.VTKLoader.prototype,THREE.EventDispatcher.prototype,{load:function(e,t,r,a){var n=this,i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){function t(e,t){var r=e.length,a=new Float32Array(r+t.length);return a.set(e),a.set(t,r),a}function r(e,t){var r=e.length,a=new Int32Array(r+t.length);return a.set(e),a.set(t,r),a}function a(e){for(var t="",r=new Uint8Array(e),a=0,n=r.length;n--;)t+=String.fromCharCode(r[a++]);return t}var n=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==n[0].indexOf("xml")?function(e){function a(e){var t={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){t.attributes={};for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);t.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===e.nodeType&&(t=e.nodeValue.trim());if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++){var o=e.childNodes.item(i),s=o.nodeName;if(void 0===t[s]){var u=a(o);""!==u&&(t[s]=u)}else{if(void 0===t[s].push){var c=t[s];t[s]=[c]}var u=a(o);""!==u&&t[s].push(u)}}return t}function n(e){var t,r="undefined"!=typeof Uint8Array?Uint8Array:Array,a=[],n=[],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=i.length;for(t=0;t<o;t++)a[t]=i[t];for(t=0;t<o;++t)n[i.charCodeAt(t)]=t;n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63;var s,u,c,l,h,o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");l="="===e[o-2]?2:"="===e[o-1]?1:0,h=new r(3*o/4-l),u=l>0?o-4:o;var d=0;for(t=0,s=0;t<u;t+=4,s+=3)c=n[e.charCodeAt(t)]<<18|n[e.charCodeAt(t+1)]<<12|n[e.charCodeAt(t+2)]<<6|n[e.charCodeAt(t+3)],h[d++]=(16711680&c)>>16,h[d++]=(65280&c)>>8,h[d++]=255&c;return 2===l?(c=n[e.charCodeAt(t)]<<2|n[e.charCodeAt(t+1)]>>4,h[d++]=255&c):1===l&&(c=n[e.charCodeAt(t)]<<10|n[e.charCodeAt(t+1)]<<4|n[e.charCodeAt(t+2)]>>2,h[d++]=c>>8&255,h[d++]=255&c),h}var i=null;if(window.DOMParser)try{i=(new DOMParser).parseFromString(e,"text/xml")}catch(e){i=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,!i.loadXML())throw new Error(i.parseError.reason+i.parseError.srcText)}catch(e){i=null}}var o=i.documentElement,s=a(o),u=[],c=[],l=[];if(s.PolyData){for(var h=s.PolyData.Piece,d=s.attributes.hasOwnProperty("compressor"),f=["PointData","Points","Strips","Polys"],p=0,m=f.length;p<m;){var E=h[f[p]];if(E&&E.DataArray){if("[object Array]"===Object.prototype.toString.call(E.DataArray))var v=E.DataArray;else var v=[E.DataArray];for(var g=0,y=v.length;g<y;)"#text"in v[g]&&v[g]["#text"].length>0&&(v[g].text=function(e,a){var i=0;if("UInt64"===s.attributes.header_type?i=8:"UInt32"===s.attributes.header_type&&(i=4),"binary"===e.attributes.format&&a){var o,u,c,l,h,d,f,p,m;if("Float32"===e.attributes.type)var E=new Float32Array;else if("Int64"===e.attributes.type)var E=new Int32Array;o=e["#text"],c=n(o),l=c[0];for(var v=1;v<i-1;v++)l|=c[v]<<v*i;d=(l+3)*i,f=d%3>0?3-d%3:0,d+=f,p=[],m=d,p.push(m),h=3*i;for(var v=0;v<l;v++){for(var g=c[v*i+h],y=1;y<i-1;y++)g|=c[v*i+h+y]<<8*y;m+=g,p.push(m)}for(var v=0;v<p.length-1;v++){u=new Zlib.Inflate(c.slice(p[v],p[v+1]),{resize:!0,verify:!0}).decompress(),u=u.buffer,"Float32"===e.attributes.type?(u=new Float32Array(u),E=t(E,u)):"Int64"===e.attributes.type&&(u=new Int32Array(u),E=r(E,u))}delete e["#text"],"Float32"===e.attributes.type?"binary"===e.attributes.format&&(a||(E=E.filter(function(e,t){if(0!==t)return!0}))):"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(a||(E=E.filter(function(e,t){if(0!==t)return!0})),E=E.filter(function(e,t){if(t%2!=1)return!0}))}else{if("binary"!==e.attributes.format||a)if(e["#text"])var u=e["#text"].split(/\s+/).filter(function(e){if(""!==e)return e});else var u=new Int32Array(0).buffer;else{var u=n(e["#text"]);u=u.slice(i).buffer}if(delete e["#text"],"Float32"===e.attributes.type)var E=new Float32Array(u);else if("Int32"===e.attributes.type)var E=new Int32Array(u);else if("Int64"===e.attributes.type){var E=new Int32Array(u);"binary"===e.attributes.format&&(E=E.filter(function(e,t){if(t%2!=1)return!0}))}}return E}(v[g],d)),g++;switch(f[p]){case"PointData":var T=parseInt(h.attributes.NumberOfPoints),b=E.attributes.Normals;if(T>0)for(var R=0,A=v.length;R<A;R++)if(b===v[R].attributes.Name){var w=v[R].attributes.NumberOfComponents;c=new Float32Array(T*w),c.set(v[R].text,0)}break;case"Points":var T=parseInt(h.attributes.NumberOfPoints);if(T>0){var w=E.DataArray.attributes.NumberOfComponents;u=new Float32Array(T*w),u.set(E.DataArray.text,0)}break;case"Strips":var H=parseInt(h.attributes.NumberOfStrips);if(H>0){var x=new Int32Array(E.DataArray[0].text.length),M=new Int32Array(E.DataArray[1].text.length);x.set(E.DataArray[0].text,0),M.set(E.DataArray[1].text,0);var _=H+x.length;l=new Uint32Array(3*_-9*H);for(var L=0,R=0,A=H;R<A;R++){for(var F=[],k=0,C=M[R],S=0;k<C-S;k++)F.push(x[k]),R>0&&(S=M[R-1]);for(var I=0,C=M[R],S=0;I<C-S-2;I++)I%2?(l[L++]=F[I],l[L++]=F[I+2],l[L++]=F[I+1]):(l[L++]=F[I],l[L++]=F[I+1],l[L++]=F[I+2]),R>0&&(S=M[R-1])}}break;case"Polys":var N=parseInt(h.attributes.NumberOfPolys);if(N>0){var x=new Int32Array(E.DataArray[0].text.length),M=new Int32Array(E.DataArray[1].text.length);x.set(E.DataArray[0].text,0),M.set(E.DataArray[1].text,0);var _=N+x.length;l=new Uint32Array(3*_-9*N);for(var L=0,O=0,R=0,A=N,S=0;R<A;){for(var B=[],k=0,C=M[R];k<C-S;)B.push(x[O++]),k++;for(var I=1;I<C-S-1;)l[L++]=B[0],l[L++]=B[I],l[L++]=B[I+1],I++;R++,S=M[R-1]}}}}p++}var P=new THREE.BufferGeometry;return P.setIndex(new THREE.BufferAttribute(l,1)),P.addAttribute("position",new THREE.BufferAttribute(u,3)),c.length===u.length&&P.addAttribute("normal",new THREE.BufferAttribute(c,3)),P}}(a(e)):n[2].includes("ASCII")?function(e){var t,r=[],a=[],n=[],i=[],o=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,s=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,c=/^POLYGONS /,l=/^TRIANGLE_STRIPS /,h=/^POINT_DATA[ ]+(\d+)/,d=/^CELL_DATA[ ]+(\d+)/,f=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,p=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,m=!1,E=!1,v=!1,g=!1,y=!1,T=!1,b=!1,R=e.split("\n");for(var A in R){var w=R[A];if(m)for(;null!==(t=o.exec(w));){var H=parseFloat(t[1]),x=parseFloat(t[2]),M=parseFloat(t[3]);a.push(H,x,M)}else if(E){if(null!==(t=s.exec(w))){var _=parseInt(t[1]),L=t[2].split(/\s+/);if(_>=3)for(var F,k,C=parseInt(L[0]),S=1,I=0;I<_-2;++I)F=parseInt(L[S]),k=parseInt(L[S+1]),r.push(C,F,k),S++}}else if(v){if(null!==(t=s.exec(w))){var _=parseInt(t[1]),L=t[2].split(/\s+/);if(_>=3)for(var C,F,k,I=0;I<_-2;I++)I%2==1?(C=parseInt(L[I]),F=parseInt(L[I+2]),k=parseInt(L[I+1]),r.push(C,F,k)):(C=parseInt(L[I]),F=parseInt(L[I+1]),k=parseInt(L[I+2]),r.push(C,F,k))}}else if(g||y)if(T)for(;null!==(t=o.exec(w));){var N=parseFloat(t[1]),O=parseFloat(t[2]),B=parseFloat(t[3]);n.push(N,O,B)}else if(b)for(;null!==(t=o.exec(w));){var P=parseFloat(t[1]),U=parseFloat(t[2]),D=parseFloat(t[3]);i.push(P,U,D)}null!==c.exec(w)?(E=!0,m=!1,v=!1):null!==u.exec(w)?(E=!1,m=!0,v=!1):null!==l.exec(w)?(E=!1,m=!1,v=!0):null!==h.exec(w)?(g=!0,m=!1,E=!1,v=!1):null!==d.exec(w)?(y=!0,m=!1,E=!1,v=!1):null!==f.exec(w)?(T=!0,b=!1,m=!1,E=!1,v=!1):null!==p.exec(w)&&(b=!0,T=!1,m=!1,E=!1,v=!1)}var V,G="point";if(n.length===r.length&&(G="cell"),"point"===G)V=new THREE.BufferGeometry,V.setIndex(new THREE.BufferAttribute(new Uint32Array(r),1)),V.addAttribute("position",new THREE.BufferAttribute(new Float32Array(a),3)),n.length===a.length&&V.addAttribute("color",new THREE.BufferAttribute(new Float32Array(n),3)),i.length===a.length&&V.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(i),3));else{V=new THREE.Geometry;for(var j,z,K,W,H,x,M,N,O,B,Y=r.length/3,q=a.length/3,I=0;I<q;++I)H=a[3*I+0],x=a[3*I+1],M=a[3*I+2],V.vertices.push(new THREE.Vector3(H,x,M));for(var A=0;A<Y;++A)z=r[3*A+0],K=r[3*A+1],W=r[3*A+2],V.faces.push(new THREE.Face3(z,K,W));if(n.length===3*Y)for(var A=0;A<Y;++A)j=V.faces[A],N=n[3*A+0],O=n[3*A+1],B=n[3*A+2],j.color=(new THREE.Color).setRGB(N,O,B)}return V}(a(e)):function(e){function t(e,t){for(var r=t,a=e[r],n=[];10!==a;)n.push(String.fromCharCode(a)),r++,a=e[r];return{start:t,end:r,next:r+1,parsedString:n.join("")}}for(var r,a,n,i,o,s,u,c=new Uint8Array(e),l=new DataView(e),h=[],d=[],f=[],p=[],m=0;;){if(s=t(c,m),u=s.parsedString,0===u.indexOf("POINTS")){for(p.push(u),i=parseInt(u.split(" ")[1],10),r=4*i*3,h=new Float32Array(3*i),a=s.next,n=0;n<i;n++)h[3*n]=l.getFloat32(a,!1),h[3*n+1]=l.getFloat32(a+4,!1),h[3*n+2]=l.getFloat32(a+8,!1),a+=12;s.next=s.next+r+1}else if(0===u.indexOf("TRIANGLE_STRIPS")){var E=parseInt(u.split(" ")[1],10),v=parseInt(u.split(" ")[2],10);r=4*v,f=new Uint32Array(3*v-9*E);var g=0;for(a=s.next,n=0;n<E;n++){var y=l.getInt32(a,!1),T=[];for(a+=4,o=0;o<y;o++)T.push(l.getInt32(a,!1)),a+=4;for(var b=0;b<y-2;b++)b%2?(f[g++]=T[b],f[g++]=T[b+2],f[g++]=T[b+1]):(f[g++]=T[b],f[g++]=T[b+1],f[g++]=T[b+2])}s.next=s.next+r+1}else if(0===u.indexOf("POLYGONS")){var E=parseInt(u.split(" ")[1],10),v=parseInt(u.split(" ")[2],10);r=4*v,f=new Uint32Array(3*v-9*E);var g=0;for(a=s.next,n=0;n<E;n++){var y=l.getInt32(a,!1),T=[];for(a+=4,o=0;o<y;o++)T.push(l.getInt32(a,!1)),a+=4;for(var b=1;b<y-1;b++)f[g++]=T[0],f[g++]=T[b],f[g++]=T[b+1]}s.next=s.next+r+1}else if(0===u.indexOf("POINT_DATA")){for(i=parseInt(u.split(" ")[1],10),s=t(c,s.next),r=4*i*3,d=new Float32Array(3*i),a=s.next,n=0;n<i;n++)d[3*n]=l.getFloat32(a,!1),d[3*n+1]=l.getFloat32(a+4,!1),d[3*n+2]=l.getFloat32(a+8,!1),a+=12;s.next=s.next+r}if((m=s.next)>=c.byteLength)break}var R=new THREE.BufferGeometry;return R.setIndex(new THREE.BufferAttribute(f,1)),R.addAttribute("position",new THREE.BufferAttribute(h,3)),d.length===h.length&&R.addAttribute("normal",new THREE.BufferAttribute(d,3)),R}(e)}})},function(e,t,r){!function(t,r){e.exports=r()}(0,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),r=function t(){e(this,t),this.boneName="",this.BoneIndex=0,this.Indeces=[],this.Weights=[],this.initMatrix=null,this.OffsetMatrix=null},a=function t(){e(this,t),this.animeName="",this.boneName="",this.targetBone=null,this.keyType=4,this.frameStartLv=0,this.keyFrames=[],this.InverseMx=null},n=function(){function r(t){e(this,r),this.fps=30,this.name="xanimation",this.length=0,this.hierarchy=[],this.putFlags=t,void 0===this.putFlags.putPos&&(this.putFlags.putPos=!0),void 0===this.putFlags.putRot&&(this.putFlags.putRot=!0),void 0===this.putFlags.putScl&&(this.putFlags.putScl=!0)}return t(r,[{key:"make",value:function(e){for(var t=0;t<e.length;t++)this.hierarchy.push(this.makeBonekeys(e[t]));this.length=this.hierarchy[0].keys[this.hierarchy[0].keys.length-1].time}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"makeBonekeys",value:function(e){var t={};return t.name=e.boneName,t.parent="",t.keys=this.keyFrameRefactor(e),t.copy=function(){return Object.assign({},this)},t}},{key:"keyFrameRefactor",value:function(e){for(var t=[],r=0;r<e.keyFrames.length;r++){var a={};a.time=e.keyFrames[r].time*this.fps,e.keyFrames[r].pos&&this.putFlags.putPos&&(a.pos=e.keyFrames[r].pos),e.keyFrames[r].rot&&this.putFlags.putRot&&(a.rot=e.keyFrames[r].rot),e.keyFrames[r].scl&&this.putFlags.putScl&&(a.scl=e.keyFrames[r].scl),e.keyFrames[r].matrix&&(a.matrix=e.keyFrames[r].matrix,this.putFlags.putPos&&(a.pos=(new THREE.Vector3).setFromMatrixPosition(a.matrix)),this.putFlags.putRot&&(a.rot=(new THREE.Quaternion).setFromRotationMatrix(a.matrix)),this.putFlags.putScl&&(a.scl=(new THREE.Vector3).setFromMatrixScale(a.matrix))),t.push(a)}return t}}]),r}(),i=function t(){e(this,t),this.index=0,this.Frame=0,this.time=0,this.matrix=null};return function(){function o(t,r){e(this,o),this.debug=!1,this.manager=void 0!==t?t:new THREE.DefaultLoadingManager,this.texloader=void 0!==r?r:new THREE.TextureLoader,this.url="",this.baseDir="",this._putMatLength=0,this._nowMat=null,this._tmpUvArray=[],this._facesNormal=[],this._nowFrameName="",this.frameHierarchie=[],this.Hierarchies={},this.HieStack=[],this._currentObject={},this._currentFrame={},this._data=null,this.onLoad=null,this.IsUvYReverse=!0,this.Meshes=[],this.animations=[],this.animTicksPerSecond=30,this._currentGeo=null,this._currentAnime=null,this._currentAnimeFrames=null}return t(o,[{key:"_setArgOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e){for(var r=t;r<e.length;r++)switch(r){case 0:this.url=e[r];break;case 1:this.options=e[r]}void 0===this.options&&(this.options={})}}},{key:"load",value:function(e,t,r,a){var n=this;this._setArgOption(e);var i=new THREE.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(this.url,function(e){n._parse(e,t)},r,a)}},{key:"fromResponsedData",value:function(e,t,r){this._setArgOption(t),this._parse(e,r)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(r=e.indexOf("//",t),-1===r&&(r=e.indexOf("#",t)),!(r>-1&&r<2))break;var a=-1;a=e.indexOf("\r\n",t),a>0?t=a+2:(a=e.indexOf("\r",t),t=a>0?a+1:e.indexOf("\n",t)+1)}return e.substr(t)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(r=e.indexOf("//",t),-1===r&&(r=e.indexOf("#",t)),!(r>-1&&r<2))break;var a=-1;a=e.indexOf("\r\n",t),a>0?t=a+2:(a=e.indexOf("\r",t),t=a>0?a+1:e.indexOf("\n",t)+1)}return e.substr(t)}},{key:"_isBinary",value:function(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var r=t.byteLength,a=0;a<r;a++)if(t.getUint8(a,!1)>127)return!0;return!1}},{key:"ensureBinary",value:function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}},{key:"ensureString",value:function(e){return"string"!=typeof e?THREE.LoaderUtils.decodeText(new Uint8Array(e)):e}},{key:"_parse",value:function(e,t){var r=this.ensureBinary(e);return this._data=this.ensureString(e),this.onLoad=t,this._isBinary(r)?this._parseBinary(r):this._parseASCII()}},{key:"_parseBinary",value:function(e){return this._parseASCII(THREE.LoaderUtils.decodeText(new Uint8Array(e)))}},{key:"_parseASCII",value:function(){this.url.lastIndexOf("/")>0&&(this.baseDir=this.url.substr(0,this.url.lastIndexOf("/")+1));this.Hierarchies.children=[],this._hierarchieParse(this.Hierarchies,16),this._changeRoot(),this._currentObject=this.Hierarchies.children.shift(),this.mainloop()}},{key:"_hierarchieParse",value:function(e,t){for(var r=t;;){var a=this._data.indexOf("{",r)+1,n=this._data.indexOf("}",r),i=this._data.indexOf("{",a)+1;if(!(a>0&&n>a)){r=-1===a?this._data.length:n+1;break}var o={};o.children=[];var s=this._readLine(this._data.substr(r,a-r-1)).trim(),u=s.split(/ /g);if(u.length>0?(o.type=u[0],u.length>=2?o.name=u[1]:o.name=u[0]+this.Hierarchies.children.length):(o.name=s,o.type=""),"Animation"===o.type){o.data=this._data.substr(i,n-i).trim();var c=this._hierarchieParse(o,n+1);r=c.end,o.children=c.parent.children}else{var l=this._data.lastIndexOf(";",i>0?Math.min(i,n):n);if(o.data=this._data.substr(a,l-a).trim(),i<=0||n<i)r=n+1;else{var h=Math.max(l+1,a),d=this._hierarchieParse(o,h);r=d.end,o.children=d.parent.children}}o.parent=e,"template"!=o.type&&e.children.push(o)}return{parent:e,end:r}}},{key:"mainloop",value:function(){var e=this;this.mainProc(),this._currentObject.parent||this._currentObject.children.length>0||!this._currentObject.worked?setTimeout(function(){e.mainloop()},1):setTimeout(function(){e.onLoad({models:e.Meshes,animations:e.animations})},1)}},{key:"mainProc",value:function(){for(var e=!1;;){if(!this._currentObject.worked){switch(this._currentObject.type){case"template":break;case"AnimTicksPerSecond":this.animTicksPerSecond=parseInt(this._currentObject.data);break;case"Frame":this._setFrame();break;case"FrameTransformMatrix":this._setFrameTransformMatrix();break;case"Mesh":this._changeRoot(),this._currentGeo={},this._currentGeo.name=this._currentObject.name.trim(),this._currentGeo.parentName=this._getParentName(this._currentObject).trim(),this._currentGeo.VertexSetedBoneCount=[],this._currentGeo.Geometry=new THREE.Geometry,this._currentGeo.Materials=[],this._currentGeo.normalVectors=[],this._currentGeo.BoneInfs=[],this._currentGeo.baseFrame=this._currentFrame,this._makeBoneFrom_CurrentFrame(),this._readVertexDatas(),e=!0;break;case"MeshNormals":this._readVertexDatas();break;case"MeshTextureCoords":this._setMeshTextureCoords();break;case"VertexDuplicationIndices":break;case"MeshMaterialList":this._setMeshMaterialList();break;case"Material":this._setMaterial();break;case"SkinWeights":this._setSkinWeights();break;case"AnimationSet":this._changeRoot(),this._currentAnime={},this._currentAnime.name=this._currentObject.name.trim(),this._currentAnime.AnimeFrames=[];break;case"Animation":this._currentAnimeFrames&&this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=new a,this._currentAnimeFrames.boneName=this._currentObject.data.trim();break;case"AnimationKey":this._readAnimationKey(),e=!0}this._currentObject.worked=!0}if(this._currentObject.children.length>0){if(this._currentObject=this._currentObject.children.shift(),this.debug&&console.log("processing "+this._currentObject.name),e)break}else if(this._currentObject.worked&&this._currentObject.parent&&!this._currentObject.parent.parent&&this._changeRoot(),this._currentObject.parent?this._currentObject=this._currentObject.parent:e=!0,e)break}}},{key:"_changeRoot",value:function(){null!=this._currentGeo&&this._currentGeo.name&&this._makeOutputGeometry(),this._currentGeo={},null!=this._currentAnime&&this._currentAnime.name&&(this._currentAnimeFrames&&(this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=null),this._makeOutputAnimation()),this._currentAnime={}}},{key:"_getParentName",value:function(e){return e.parent?e.parent.name?e.parent.name:this._getParentName(e.parent):""}},{key:"_setFrame",value:function(){this._nowFrameName=this._currentObject.name.trim(),this._currentFrame={},this._currentFrame.name=this._nowFrameName,this._currentFrame.children=[],this._currentObject.parent&&this._currentObject.parent.name&&(this._currentFrame.parentName=this._currentObject.parent.name),this.frameHierarchie.push(this._nowFrameName),this.HieStack[this._nowFrameName]=this._currentFrame}},{key:"_setFrameTransformMatrix",value:function(){this._currentFrame.FrameTransformMatrix=new THREE.Matrix4;var e=this._currentObject.data.split(",");this._ParseMatrixData(this._currentFrame.FrameTransformMatrix,e),this._makeBoneFrom_CurrentFrame()}},{key:"_makeBoneFrom_CurrentFrame",value:function(){if(this._currentFrame.FrameTransformMatrix){var e=new THREE.Bone;if(e.name=this._currentFrame.name,e.applyMatrix(this._currentFrame.FrameTransformMatrix),e.matrixWorld=e.matrix,e.FrameTransformMatrix=this._currentFrame.FrameTransformMatrix,this._currentFrame.putBone=e,this._currentFrame.parentName)for(var t in this.HieStack)this.HieStack[t].name===this._currentFrame.parentName&&this.HieStack[t].putBone.add(this._currentFrame.putBone)}}},{key:"_readVertexDatas",value:function(){for(var e=0,t=0,r=0,a=0,n=0;;){var i=!1;if(0===r){e=this._readInt1(e).endRead,r=1,n=0,a=this._currentObject.data.indexOf(";;",e)+1,a<=0&&(a=this._currentObject.data.length)}else{var o=0;switch(t){case 0:o=this._currentObject.data.indexOf(",",e)+1;break;case 1:o=this._currentObject.data.indexOf(";,",e)+1}switch((0===o||o>a)&&(o=a,r=0,i=!0),this._currentObject.type){case"Mesh":switch(t){case 0:this._readVertex1(this._currentObject.data.substr(e,o-e));break;case 1:this._readFace1(this._currentObject.data.substr(e,o-e))}break;case"MeshNormals":switch(t){case 0:this._readNormalVector1(this._currentObject.data.substr(e,o-e));break;case 1:this._readNormalFace1(this._currentObject.data.substr(e,o-e),n)}}e=o+1,n++,i&&t++}if(e>=this._currentObject.data.length)break}}},{key:"_readInt1",value:function(e){var t=this._currentObject.data.indexOf(";",e);return{refI:parseInt(this._currentObject.data.substr(e,t-e)),endRead:t+1}}},{key:"_readVertex1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.Geometry.vertices.push(new THREE.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),this._currentGeo.Geometry.skinIndices.push(new THREE.Vector4(0,0,0,0)),this._currentGeo.Geometry.skinWeights.push(new THREE.Vector4(1,0,0,0)),this._currentGeo.VertexSetedBoneCount.push(0)}},{key:"_readFace1",value:function(e){var t=this._readLine(e.trim()).substr(2,e.length-4).split(",");this._currentGeo.Geometry.faces.push(new THREE.Face3(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),new THREE.Vector3(1,1,1).normalize()))}},{key:"_readNormalVector1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.normalVectors.push(new THREE.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])))}},{key:"_readNormalFace1",value:function(e,t){var r=this._readLine(e.trim()).substr(2,e.length-4).split(","),a=parseInt(r[0],10),n=this._currentGeo.normalVectors[a];a=parseInt(r[1],10);var i=this._currentGeo.normalVectors[a];a=parseInt(r[2],10);var o=this._currentGeo.normalVectors[a];this._currentGeo.Geometry.faces[t].vertexNormals=[n,i,o]}},{key:"_setMeshNormals",value:function(){for(var e=0,t=0,r=0;;){switch(t){case 0:if(0===r){e=this._readInt1(0).endRead,r=1}else{var a=this._currentObject.data.indexOf(",",e)+1;-1===a&&(a=this._currentObject.data.indexOf(";;",e)+1,t=2,r=0);var n=this._currentObject.data.substr(e,a-e),i=this._readLine(n.trim()).split(";");this._currentGeo.normalVectors.push([parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])]),e=a+1}}if(e>=this._currentObject.data.length)break}}},{key:"_setMeshTextureCoords",value:function(){this._tmpUvArray=[],this._currentGeo.Geometry.faceVertexUvs=[],this._currentGeo.Geometry.faceVertexUvs.push([]);for(var e=0,t=0,r=0;;){switch(t){case 0:if(0===r){e=this._readInt1(0).endRead,r=1}else{var a=this._currentObject.data.indexOf(",",e)+1;0===a&&(a=this._currentObject.data.length,t=2,r=0);var n=this._currentObject.data.substr(e,a-e),i=this._readLine(n.trim()).split(";");this.IsUvYReverse?this._tmpUvArray.push(new THREE.Vector2(parseFloat(i[0]),1-parseFloat(i[1]))):this._tmpUvArray.push(new THREE.Vector2(parseFloat(i[0]),parseFloat(i[1]))),e=a+1}}if(e>=this._currentObject.data.length)break}this._currentGeo.Geometry.faceVertexUvs[0]=[];for(var o=0;o<this._currentGeo.Geometry.faces.length;o++)this._currentGeo.Geometry.faceVertexUvs[0][o]=[],this._currentGeo.Geometry.faceVertexUvs[0][o].push(this._tmpUvArray[this._currentGeo.Geometry.faces[o].a]),this._currentGeo.Geometry.faceVertexUvs[0][o].push(this._tmpUvArray[this._currentGeo.Geometry.faces[o].b]),this._currentGeo.Geometry.faceVertexUvs[0][o].push(this._tmpUvArray[this._currentGeo.Geometry.faces[o].c]);this._currentGeo.Geometry.uvsNeedUpdate=!0}},{key:"_setMeshMaterialList",value:function(){for(var e=0,t=0,r=0;;){if(r<2){e=this._readInt1(e).endRead,r++}else{var a=this._currentObject.data.indexOf(";",e);-1===a&&(a=this._currentObject.data.length,t=3,r=0);for(var n=this._currentObject.data.substr(e,a-e),i=this._readLine(n.trim()).split(","),o=0;o<i.length;o++)this._currentGeo.Geometry.faces[o].materialIndex=parseInt(i[o]);e=this._currentObject.data.length}if(e>=this._currentObject.data.length||t>=3)break}}},{key:"_setMaterial",value:function(){var e=new THREE.MeshPhongMaterial({color:16777215*Math.random()});e.side=THREE.FrontSide,e.name=this._currentObject.name;var t=0,r=this._currentObject.data.indexOf(";;",t),a=this._currentObject.data.substr(t,r-t),n=this._readLine(a.trim()).split(";");e.color.r=parseFloat(n[0]),e.color.g=parseFloat(n[1]),e.color.b=parseFloat(n[2]),t=r+2,r=this._currentObject.data.indexOf(";",t),a=this._currentObject.data.substr(t,r-t),e.shininess=parseFloat(this._readLine(a)),t=r+1,r=this._currentObject.data.indexOf(";;",t),a=this._currentObject.data.substr(t,r-t);var i=this._readLine(a.trim()).split(";");e.specular.r=parseFloat(i[0]),e.specular.g=parseFloat(i[1]),e.specular.b=parseFloat(i[2]),t=r+2,r=this._currentObject.data.indexOf(";;",t),-1===r&&(r=this._currentObject.data.length),a=this._currentObject.data.substr(t,r-t);var o=this._readLine(a.trim()).split(";");e.emissive.r=parseFloat(o[0]),e.emissive.g=parseFloat(o[1]),e.emissive.b=parseFloat(o[2]);for(var s=null;;){if(!(this._currentObject.children.length>0))break;s=this._currentObject.children.shift(),this.debug&&console.log("processing "+s.name);var u=s.data.substr(1,s.data.length-2);switch(s.type){case"TextureFilename":e.map=this.texloader.load(this.baseDir+u);break;case"BumpMapFilename":e.bumpMap=this.texloader.load(this.baseDir+u),e.bumpScale=.05;break;case"NormalMapFilename":e.normalMap=this.texloader.load(this.baseDir+u),e.normalScale=new THREE.Vector2(2,2);break;case"EmissiveMapFilename":e.emissiveMap=this.texloader.load(this.baseDir+u);break;case"LightMapFilename":e.lightMap=this.texloader.load(this.baseDir+u)}}this._currentGeo.Materials.push(e)}},{key:"_setSkinWeights",value:function(){var e=new r,t=0,a=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,a-t);t=a+1,e.boneName=n.substr(1,n.length-2),e.BoneIndex=this._currentGeo.BoneInfs.length,a=this._currentObject.data.indexOf(";",t),t=a+1,a=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,a-t);for(var i=this._readLine(n.trim()).split(","),o=0;o<i.length;o++)e.Indeces.push(parseInt(i[o]));t=a+1,a=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,a-t);for(var s=this._readLine(n.trim()).split(","),u=0;u<s.length;u++)e.Weights.push(parseFloat(s[u]));t=a+1,a=this._currentObject.data.indexOf(";",t),a<=0&&(a=this._currentObject.data.length),n=this._currentObject.data.substr(t,a-t);var c=this._readLine(n.trim()).split(",");e.OffsetMatrix=new THREE.Matrix4,this._ParseMatrixData(e.OffsetMatrix,c),this._currentGeo.BoneInfs.push(e)}},{key:"_makePutBoneList",value:function(e,t){var r=!1;for(var a in this.HieStack)if(this.HieStack[a].name===e||r){r=!0;var n=new THREE.Bone;if(n.name=this.HieStack[a].name,n.applyMatrix(this.HieStack[a].FrameTransformMatrix),n.matrixWorld=n.matrix,n.FrameTransformMatrix=this.HieStack[a].FrameTransformMatrix,n.pos=(new THREE.Vector3).setFromMatrixPosition(n.FrameTransformMatrix).toArray(),n.rotq=(new THREE.Quaternion).setFromRotationMatrix(n.FrameTransformMatrix).toArray(),n.scl=(new THREE.Vector3).setFromMatrixScale(n.FrameTransformMatrix).toArray(),this.HieStack[a].parentName&&this.HieStack[a].parentName.length>0)for(var i=0;i<t.length;i++)if(this.HieStack[a].parentName===t[i].name){t[i].add(n),n.parent=i;break}t.push(n)}}},{key:"_makeOutputGeometry",value:function(){this._currentGeo.Geometry.computeBoundingBox(),this._currentGeo.Geometry.computeBoundingSphere(),this._currentGeo.Geometry.verticesNeedUpdate=!0,this._currentGeo.Geometry.normalsNeedUpdate=!0,this._currentGeo.Geometry.colorsNeedUpdate=!0,this._currentGeo.Geometry.uvsNeedUpdate=!0,this._currentGeo.Geometry.groupsNeedUpdate=!0;var e=null;if(this._currentGeo.BoneInfs.length>0){var t=[];this._makePutBoneList(this._currentGeo.baseFrame.parentName,t);for(var r=0;r<this._currentGeo.BoneInfs.length;r++){for(var a=0,n=0;n<t.length;n++)if(t[n].name===this._currentGeo.BoneInfs[r].boneName){a=n,t[n].OffsetMatrix=new THREE.Matrix4,t[n].OffsetMatrix.copy(this._currentGeo.BoneInfs[r].OffsetMatrix);break}for(var i=0;i<this._currentGeo.BoneInfs[r].Indeces.length;i++){var o=this._currentGeo.BoneInfs[r].Indeces[i],s=this._currentGeo.BoneInfs[r].Weights[i];switch(this._currentGeo.VertexSetedBoneCount[o]){case 0:this._currentGeo.Geometry.skinIndices[o].x=a,this._currentGeo.Geometry.skinWeights[o].x=s;break;case 1:this._currentGeo.Geometry.skinIndices[o].y=a,this._currentGeo.Geometry.skinWeights[o].y=s;break;case 2:this._currentGeo.Geometry.skinIndices[o].z=a,this._currentGeo.Geometry.skinWeights[o].z=s;break;case 3:this._currentGeo.Geometry.skinIndices[o].w=a,this._currentGeo.Geometry.skinWeights[o].w=s}this._currentGeo.VertexSetedBoneCount[o]++,this._currentGeo.VertexSetedBoneCount[o]>4&&console.log("warn! over 4 bone weight! :"+o)}}for(var u=0;u<this._currentGeo.Materials.length;u++)this._currentGeo.Materials[u].skinning=!0;for(var c=[],l=0;l<t.length;l++)t[l].OffsetMatrix?c.push(t[l].OffsetMatrix):c.push(new THREE.Matrix4);var h=(new THREE.BufferGeometry).fromGeometry(this._currentGeo.Geometry);h.bones=t,e=new THREE.SkinnedMesh(h,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials),e.skeleton.boneInverses=c}else{var d=(new THREE.BufferGeometry).fromGeometry(this._currentGeo.Geometry);e=new THREE.Mesh(d,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials)}e.name=this._currentGeo.name;var f=new THREE.Matrix4,p=this._currentGeo.baseFrame.putBone;if(p&&p.parent){for(;;){if(!(p=p.parent))break;f.multiply(p.FrameTransformMatrix)}e.applyMatrix(f)}this.Meshes.push(e)}},{key:"_readAnimationKey",value:function(){var e=0,t=this._currentObject.data.indexOf(";",e),r=this._currentObject.data.substr(e,t-e);e=t+1;var a=parseInt(this._readLine(r));t=this._currentObject.data.indexOf(";",e),e=t+1,r=this._currentObject.data.substr(e);for(var n=this._readLine(r.trim()).split(";;,"),o=0;o<n.length;o++){var s=n[o].split(";"),u=new i;if(u.type=a,u.Frame=parseInt(s[0]),u.index=this._currentAnimeFrames.keyFrames.length,u.time=u.Frame,4!=a){for(var c=!1,l=0;l<this._currentAnimeFrames.keyFrames.length;l++)if(this._currentAnimeFrames.keyFrames[l].Frame===u.Frame){u=this._currentAnimeFrames.keyFrames[l],c=!0;break}var h=s[2].split(",");switch(a){case 0:u.rot=new THREE.Quaternion(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),-1*parseFloat(h[0]));break;case 1:u.scl=new THREE.Vector3(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]));break;case 2:u.pos=new THREE.Vector3(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))}c||this._currentAnimeFrames.keyFrames.push(u)}else u.matrix=new THREE.Matrix4,this._ParseMatrixData(u.matrix,s[2].split(",")),this._currentAnimeFrames.keyFrames.push(u)}}},{key:"_makeOutputAnimation",value:function(){var e=new n(this.options);e.fps=this.animTicksPerSecond,e.name=this._currentAnime.name,e.make(this._currentAnime.AnimeFrames),this.animations.push(e)}},{key:"assignAnimation",value:function(e,t,r){var a=e,n=t;if(a||(a=this.Meshes[0]),n||(n=this.animations[0]),!a||!n)return null;var i={};i.fps=n.fps,i.name=n.name,i.length=n.length,i.hierarchy=[];for(var o=0;o<a.skeleton.bones.length;o++){for(var s=!1,u=0;u<n.hierarchy.length;u++)if(a.skeleton.bones[o].name===n.hierarchy[u].name){s=!0;var c=n.hierarchy[u].copy();if(c.parent=-1,a.skeleton.bones[o].parent&&"Bone"===a.skeleton.bones[o].parent.type)for(var l=0;l<i.hierarchy.length;l++)i.hierarchy[l].name===a.skeleton.bones[o].parent.name&&(c.parent=l,c.parentName=a.skeleton.bones[o].parent.name);i.hierarchy.push(c);break}if(!s){var h=n.hierarchy[0].copy();h.name=a.skeleton.bones[o].name,h.parent=-1;for(var d=0;d<h.keys.length;d++)h.keys[d].pos&&h.keys[d].pos.set(0,0,0),h.keys[d].scl&&h.keys[d].scl.set(1,1,1),h.keys[d].rot&&h.keys[d].rot.set(0,0,0,1);i.hierarchy.push(h)}}return a.geometry.animations||(a.geometry.animations=[]),a.geometry.animations.push(THREE.AnimationClip.parseAnimation(i,a.skeleton.bones)),a.animationMixer||(a.animationMixer=new THREE.AnimationMixer(a)),i}},{key:"_ParseMatrixData",value:function(e,t){e.set(parseFloat(t[0]),parseFloat(t[4]),parseFloat(t[8]),parseFloat(t[12]),parseFloat(t[1]),parseFloat(t[5]),parseFloat(t[9]),parseFloat(t[13]),parseFloat(t[2]),parseFloat(t[6]),parseFloat(t[10]),parseFloat(t[14]),parseFloat(t[3]),parseFloat(t[7]),parseFloat(t[11]),parseFloat(t[15]))}}]),o}()})},function(e,t,r){"use strict";function a(e){var t=e.size,r=void 0===t?100:t,a=e.vector,n=void 0===a?{}:a,i=n.x,o=void 0===i?0:i,s=n.y,u=void 0===s?0:s,c=n.z,l=void 0===c?0:c,h=new THREE.AxesHelper(r);return h.position.set(o,u,l),h}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,r){"use strict";function a(e){return n({size:e,vector:new THREE.Vector3(0,0,0)})}function n(e){e.size,e.vector,e.color;return new THREE.AxesHelper(5)}function i(e,t,r,a){var n,i=new THREE.Geometry;return n=a?new THREE.LineDashedMaterial({linewidth:3,color:r,dashSize:3,gapSize:3}):new THREE.LineBasicMaterial({linewidth:3,color:r}),i.vertices.push(e.clone()),i.vertices.push(t.clone()),THREE.Line.computeLineDistances(),new THREE.Line(i,n,THREE.LineSegments)}function o(e,t,r){var a=t.translate(-e.x,-e.y,-e.z);t.rotation.z+=de2ra(1);var a=(new THREE.Matrix4).makeTranslation(e.x,e.y,e.z);mesh.geometry.applyMatrix(a)}Object.defineProperty(t,"__esModule",{value:!0}),t.buildAxesPos=n,t.buildAxes=a,t.buildAxis=i,t.rotateObjectAround=o},function(e,t,r){"use strict";function a(e,t){var r=new THREE.LineBasicMaterial({color:255}),a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(-10,0,0),new THREE.Vector3(0,10,0));var n=new THREE.Line(a,r);scene.add(n)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,r){"use strict";function a(e){var t=e.light,r=e.position,a=e.angle,n=e.penumbra,o=e.color,s=e.castShadow,u=e.shadow;t=t||new THREE.AmbientLight(o||2236962);var c=(0,i.default)(r),l=c.x,h=c.y,d=c.z;return t.position.set(l,h,d),a&&(t.angle=a),n&&(t.penumbra=n),s&&(t.castShadow=s),u&&u.mapSize&&u.mapSize.width&&(t.shadow.mapSize.width=u.mapSize.width),u&&u.mapSize&&u.mapSize.height&&(t.shadow.mapSize.height=u.mapSize.height),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var n=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(n)},function(e,t,r){"use strict";function a(e){var t=new THREE.LineBasicMaterial({color:255}),r=new THREE.Geometry;r.vertices=r.vertices.concat(n(e)),console.log(r.vertices,n(e));var a=new THREE.Line(r,t);scene.add(a)}function n(e){var t=Array();for(k in e)row=e[k],t.push(i(row));return t}function i(e){return new THREE.Vector3(e.x,e.y,e.z)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={terrain:new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,name:"terrain",wireframe:!0}),cloth:new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,name:"cloth",wireframe:!0,transparent:!0,opacity:.9,side:THREE.DoubleSide}),ball:new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,name:"ball",wireframe:!0}),statique:new THREE.MeshBasicMaterial({color:3355545,name:"statique",wireframe:!0,transparent:!0,opacity:.6,depthTest:!0,depthWrite:!1}),move:new THREE.MeshBasicMaterial({color:10066329,name:"move",wireframe:!0}),movehigh:new THREE.MeshBasicMaterial({color:16751001,name:"movehigh",wireframe:!0}),sleep:new THREE.MeshBasicMaterial({color:10066431,name:"sleep",wireframe:!0}),debug:new THREE.MeshBasicMaterial({color:1179409,name:"debug",wireframe:!0,opacity:.1,transparent:!0}),hero:new THREE.MeshBasicMaterial({color:10040217,name:"hero",wireframe:!0}),cars:new THREE.MeshBasicMaterial({color:16777215,name:"cars",wireframe:!0,transparent:!0,side:THREE.DoubleSide}),tmp1:new THREE.MeshBasicMaterial({color:16777215,name:"tmp1",wireframe:!0,transparent:!0}),tmp2:new THREE.MeshBasicMaterial({color:16777215,name:"tmp2",wireframe:!0,transparent:!0}),meca1:new THREE.MeshBasicMaterial({color:16777215,name:"meca1",wireframe:!0}),meca2:new THREE.MeshBasicMaterial({color:16777215,name:"meca2",wireframe:!0}),meca3:new THREE.MeshBasicMaterial({color:16777215,name:"meca3",wireframe:!0}),drone:new THREE.MeshBasicMaterial({color:16777215,name:"drone",wireframe:!0}),pig:new THREE.MeshBasicMaterial({color:13870992,name:"pig",wireframe:!0,transparent:!1}),avatar:new THREE.MeshBasicMaterial({color:13870992,name:"avatar",wireframe:!0,transparent:!1}),both:new THREE.MeshBasicMaterial({color:16777215,name:"both",wireframe:!0,side:THREE.DoubleSide}),back:new THREE.MeshBasicMaterial({color:16777215,name:"back",wireframe:!0,side:THREE.BackSide})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={webgl:function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},webgl2:function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return!!t&&("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext)}}},function(e,t,r){(function(r){var a,n,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:o.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var a=0;a<r.length;a++){var n=this._tweens[r[a]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[r[a]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof window&&void 0!==r?o.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime;for(var t in this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,a;if(e<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,a=this._easingFunction(r);for(t in this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,i=this._valuesEnd[t];i instanceof Array?this._object[t]=this._interpolationFunction(i,a):("string"==typeof i&&(i="+"===i.charAt(0)||"-"===i.charAt(0)?n+parseFloat(i):parseFloat(i)),"number"==typeof i&&(this._object[t]=n+(i-n)*a))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===r){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,u=this._chainedTweens.length;s<u;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var r=e.length-1,a=r*t,n=Math.floor(a),i=o.Interpolation.Utils.Linear;return t<0?i(e[0],e[1],a):t>1?i(e[r],e[r-1],r-a):i(e[n],e[n+1>r?r:n+1],a-n)},Bezier:function(e,t){for(var r=0,a=e.length-1,n=Math.pow,i=o.Interpolation.Utils.Bernstein,s=0;s<=a;s++)r+=n(1-t,a-s)*n(t,s)*e[s]*i(a,s);return r},CatmullRom:function(e,t){var r=e.length-1,a=r*t,n=Math.floor(a),i=o.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(n=Math.floor(a=r*(1+t))),i(e[(n-1+r)%r],e[n],e[(n+1)%r],e[(n+2)%r],a-n)):t<0?e[0]-(i(e[0],e[0],e[1],e[1],-a)-e[0]):t>1?e[r]-(i(e[r],e[r],e[r-1],e[r-1],a-r)-e[r]):i(e[n?n-1:0],e[n],e[r<n+1?r:n+1],e[r<n+2?r:n+2],a-n)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=o.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:function(){var e=[1];return function(t){var r=1;if(e[t])return e[t];for(var a=t;a>1;a--)r*=a;return e[t]=r,r}}(),CatmullRom:function(e,t,r,a,n){var i=.5*(r-e),o=.5*(a-t),s=n*n;return(2*t-2*r+i+o)*(n*s)+(-3*t+3*r-2*i-o)*s+i*n+t}}},function(r){a=[],void 0!==(n=function(){return o}.apply(t,a))&&(e.exports=n)}()}).call(t,r(52))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function n(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(h===clearTimeout)return clearTimeout(e);if((h===a||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function o(){m&&f&&(m=!1,f.length?p=f.concat(p):E=-1,p.length&&s())}function s(){if(!m){var e=n(o);m=!0;for(var t=p.length;t;){for(f=p,p=[];++E<t;)f&&f[E].run();E=-1,t=p.length}f=null,m=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,h,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{h="function"==typeof clearTimeout?clearTimeout:a}catch(e){h=a}}();var f,p=[],m=!1,E=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new u(e,t)),1!==p.length||m||n(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,r){"use strict";(function(e){var t=function(){};t.prototype={bind:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},unbind:function(e,t){this._events=this._events||{},e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},t.mixin=function(e){for(var r=["bind","unbind","trigger"],a=0;a<r.length;a++)"function"==typeof e?e.prototype[r[a]]=t.prototype[r[a]]:e[r[a]]=t.prototype[r[a]];return e},void 0!==e&&"exports"in e&&(e.exports=t)}).call(t,r(54)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}])});
//# sourceMappingURL=y3d.js.map