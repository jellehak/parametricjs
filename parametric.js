var Parametric=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),r.d(t,"create",function(){return s});var n=r(1);function s(e){return new n.a(e)}t.default=n.a},function(module,__webpack_exports__,__webpack_require__){"use strict";var _features__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_settings__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_helpers_slugify__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),_web_ThreeCSG_ThreeCSG_es6__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4);const{THREE:THREE}=window;__webpack_exports__.a=function({cad:cad,scene:scene}){var debug=!1,cadData=cad;let object3d=new THREE.Object3D;const self=this;function render(e=!1){if(e&&(cadData=e),object3d=new THREE.Object3D,!cadData)return console.warn("No CadData");compileParameters();const{features:t}=cadData;return t.map((e,t)=>{if(e.suppress)return;const{mesh:r}=processFeature(e)||{};r&&object3d.add(r)}),object3d.name=Object(_helpers_slugify__WEBPACK_IMPORTED_MODULE_2__.a)(cadData.name)||Object(_helpers_slugify__WEBPACK_IMPORTED_MODULE_2__.a)(cadData.title)||"unnamed",object3d}function getFeature(e){const{type:t}=e;return _features__WEBPACK_IMPORTED_MODULE_0__[t]||!1}function processFeature(e={}){const{type:t}=e,r={ycad:self,ThreeBSP:_web_ThreeCSG_ThreeCSG_es6__WEBPACK_IMPORTED_MODULE_3__.a,cadData:cadData,scene:scene,feature:e,object3d:object3d},n=getFeature(e);if(n)try{let e=n(r)||{};return e.name=e.name||t,e}catch(e){console.warn(e)}else console.log(`Unknown feature: "${t}"`)}function getFeatureById(e){return cadData.features.filter(t=>t.id===e&&t)[0]}function getPartById(e){return cadData.parts?cadData.parts.filter(t=>t.id===e&&t)[0]:(console.warn("No sub part defined"),!1)}function getParameters(){return cadData.parameters||{}}function getFeatureLabels(){let e=[];for(let t in cadData.features){let r=cadData.features[t];if("insert"===r.type){let t=getPartById(r.data.selectInnerPart),n=getFeatureLabelsOneLevel(t.features);e.push({label:t.title,children:n})}else e.push({label:r.type})}return e}function getFeatureLabelsOneLevel(e){let t=[];for(let r in e){let n=e[r];t.push({label:n.type})}return t}function getParametersDefault(){let e={};for(let t in cadData.parameters)e[t]=cadData.parameters[t].default||cadData.parameters[t];return e}function compileParameters(){if(!cadData)return console.warn("No CadData");let e="";const{parameters:t}=cadData;return t||[].map((r,n)=>{const s=t[n];e+=`let ${n} = ${s};`}),cadData._parameters=e,e}function change(e,t){cadData.parameters[e]=t,object3d.children.splice(0,1),render()}function compile(what){let parameters=`\n      let throughall = 1000;\n      ${cadData._parameters}; \n \n      ${what}\n      `;return debug&&console.log(`Compiling : ${parameters}`),eval(parameters)}Object.assign(this,{render:render,change:change,compile:compile,getFeatureById:getFeatureById,getPartById:getPartById,getParametersDefault:getParametersDefault,getParameters:getParameters,getFeatureLabels:getFeatureLabels,settings:_settings__WEBPACK_IMPORTED_MODULE_1__.a})}},function(e,t,r){"use strict";function n(e){return!!e&&e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}r.d(t,"a",function(){return n})},function(e,t,r){"use strict";t.a={sketchFill:!1}},function(e,t,r){"use strict";r.d(t,"a",function(){return c});const n=1e-5,s=0,i=1,a=2,o=3;class c{constructor(e){var t,r,n,s,i,a,o,c=[];if(this.Polygon=l,this.Vertex=h,this.Node=u,e instanceof THREE.Geometry)this.matrix=new THREE.Matrix4;else{if(!(e instanceof THREE.Mesh)){if(e instanceof u)return this.tree=e,this.matrix=new THREE.Matrix4,this;throw"ThreeBSP: Given geometry is unsupported"}e.updateMatrix(),this.matrix=e.matrix.clone(),e=e.geometry}for(t=0,r=e.faces.length;t<r;t++)n=e.faces[t],i=e.faceVertexUvs[0][t],o=new l,n instanceof THREE.Face3?(s=e.vertices[n.a],a=i?new THREE.Vector2(i[0].x,i[0].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[0],a)).applyMatrix4(this.matrix),o.vertices.push(s),s=e.vertices[n.b],a=i?new THREE.Vector2(i[1].x,i[1].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[1],a)).applyMatrix4(this.matrix),o.vertices.push(s),s=e.vertices[n.c],a=i?new THREE.Vector2(i[2].x,i[2].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[2],a)).applyMatrix4(this.matrix),o.vertices.push(s)):(THREE.Face4,s=e.vertices[n.a],a=i?new THREE.Vector2(i[0].x,i[0].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[0],a)).applyMatrix4(this.matrix),o.vertices.push(s),s=e.vertices[n.b],a=i?new THREE.Vector2(i[1].x,i[1].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[1],a)).applyMatrix4(this.matrix),o.vertices.push(s),s=e.vertices[n.c],a=i?new THREE.Vector2(i[2].x,i[2].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[2],a)).applyMatrix4(this.matrix),o.vertices.push(s),s=e.vertices[n.d],a=i?new THREE.Vector2(i[3].x,i[3].y):null,(s=new h(s.x,s.y,s.z,n.vertexNormals[3],a)).applyMatrix4(this.matrix),o.vertices.push(s)),o.calculateProperties(),c.push(o);this.tree=new u(c)}subtract(e){var t=this.tree.clone(),r=e.tree.clone();return t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),(t=new c(t)).matrix=this.matrix,t}union(e){var t=this.tree.clone(),r=e.tree.clone();return t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),(t=new c(t)).matrix=this.matrix,t}intersect(e){var t=this.tree.clone(),r=e.tree.clone();return t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),(t=new c(t)).matrix=this.matrix,t}toGeometry(){var e,t,r,n,s,i,a,o,c,l,h=(new THREE.Matrix4).getInverse(this.matrix),u=new THREE.Geometry,d=this.tree.allPolygons(),p=d.length,f={};for(e=0;e<p;e++)for(n=(r=d[e]).vertices.length,t=2;t<n;t++)l=[],o=r.vertices[0],l.push(new THREE.Vector2(o.uv.x,o.uv.y)),(o=new THREE.Vector3(o.x,o.y,o.z)).applyMatrix4(h),void 0!==f[o.x+","+o.y+","+o.z]?s=f[o.x+","+o.y+","+o.z]:(u.vertices.push(o),s=f[o.x+","+o.y+","+o.z]=u.vertices.length-1),o=r.vertices[t-1],l.push(new THREE.Vector2(o.uv.x,o.uv.y)),(o=new THREE.Vector3(o.x,o.y,o.z)).applyMatrix4(h),void 0!==f[o.x+","+o.y+","+o.z]?i=f[o.x+","+o.y+","+o.z]:(u.vertices.push(o),i=f[o.x+","+o.y+","+o.z]=u.vertices.length-1),o=r.vertices[t],l.push(new THREE.Vector2(o.uv.x,o.uv.y)),(o=new THREE.Vector3(o.x,o.y,o.z)).applyMatrix4(h),void 0!==f[o.x+","+o.y+","+o.z]?a=f[o.x+","+o.y+","+o.z]:(u.vertices.push(o),a=f[o.x+","+o.y+","+o.z]=u.vertices.length-1),c=new THREE.Face3(s,i,a,new THREE.Vector3(r.normal.x,r.normal.y,r.normal.z)),u.faces.push(c),u.faceVertexUvs[0].push(l);return u}toMesh(e){var t=this.toGeometry(),r=new THREE.Mesh(t,e);return r.position.setFromMatrixPosition(this.matrix),r.rotation.setFromRotationMatrix(this.matrix),r}}class l{constructor(e,t,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0}calculateProperties(){var e=this.vertices[0],t=this.vertices[1],r=this.vertices[2];return this.normal=t.clone().subtract(e).cross(r.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this}clone(){var e,t,r=new l;for(e=0,t=this.vertices.length;e<t;e++)r.vertices.push(this.vertices[e].clone());return r.calculateProperties(),r}flip(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this}classifyVertex(e){var t=this.normal.dot(e)-this.w;return t<-n?a:t>n?i:s}classifySide(e){var t,r,n,c=0,l=0,h=e.vertices.length;for(t=0;t<h;t++)r=e.vertices[t],(n=this.classifyVertex(r))===i?c++:n===a&&l++;return c>0&&0===l?i:0===c&&l>0?a:0===c&&0===l?s:o}splitPolygon(e,t,r,n,c){var h=this.classifySide(e);if(h===s)(this.normal.dot(e.normal)>0?t:r).push(e);else if(h===i)n.push(e);else if(h===a)c.push(e);else{var u,d,p,f,y,v,m,w,_,g=[],E=[];for(d=0,u=e.vertices.length;d<u;d++)p=(d+1)%u,v=e.vertices[d],m=e.vertices[p],f=this.classifyVertex(v),y=this.classifyVertex(m),f!=a&&g.push(v),f!=i&&E.push(v),(f|y)===o&&(w=(this.w-this.normal.dot(v))/this.normal.dot(m.clone().subtract(v)),_=v.interpolate(m,w),g.push(_),E.push(_));g.length>=3&&n.push(new l(g).calculateProperties()),E.length>=3&&c.push(new l(E).calculateProperties())}}}class h{constructor(e,t,r,n,s){this.x=e,this.y=t,this.z=r,this.normal=n||new THREE.Vector3,this.uv=s||new THREE.Vector2}clone(){return new h(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}cross(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this}normalize(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lerp(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this}interpolate(e,t){return this.clone().lerp(e,t)}applyMatrix4(e){var t=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*n+s[12],this.y=s[1]*t+s[5]*r+s[9]*n+s[13],this.z=s[2]*t+s[6]*r+s[10]*n+s[14],this}}class u{constructor(e){var t,r,n=[],s=[];if(this.polygons=[],this.front=this.back=void 0,e instanceof Array&&0!==e.length){for(this.divider=e[0].clone(),t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,n,s);n.length>0&&(this.front=new u(n)),s.length>0&&(this.back=new u(s))}}isConvex(e){var t,r;for(t=0;t<e.length;t++)for(r=0;r<e.length;r++)if(t!==r&&e[t].classifySide(e[r])!==a)return!1;return!0}build(e){var t,r,n=[],s=[];for(this.divider||(this.divider=e[0].clone()),t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,n,s);n.length>0&&(this.front||(this.front=new u),this.front.build(n)),s.length>0&&(this.back||(this.back=new u),this.back.build(s))}allPolygons(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}clone(){var e=new u;return e.divider=this.divider.clone(),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e}invert(){var e,t,r;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),r=this.front,this.front=this.back,this.back=r,this}clipPolygons(e){var t,r,n,s;if(!this.divider)return e.slice();for(n=[],s=[],t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],n,s,n,s);return this.front&&(n=this.front.clipPolygons(n)),s=this.back?this.back.clipPolygons(s):[],n.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}}window.ThreeBSP=c},function(e,t,r){"use strict";r.r(t);var n=r(0);function s(e){let{ycad:t,cadData:r,feature:s,object3d:i}=e,a=t.getPart(s.data.selectInnerPart),o=new n.default(a).render(),c=s.data.translate;if(console.log(s.data),c){let{x:e,y:t,z:r}=c;console.log(c),o.position.set(e,t,r)}scene.add(o)}var i=function(e){let{ycad:t,cadData:r,scene:n,feature:s,object3d:i}=e,a=new THREE.Mesh(new THREE.PlaneGeometry(10,10),new THREE.MeshPhongMaterial({color:255,transparent:!0,opacity:.2}));a.doubleSided=!0,n.add(a)};function a(e){let t=new THREE.Shape,r=e[0];t.moveTo(r.x,r.y);for(let r in e){let n=e[r];t.lineTo(n.x,n.y)}return t.lineTo(e[0].x,e[0].y),t}const{THREE:o}=window,c=(new o.MeshStandardMaterial({color:1668818}),new o.MeshPhongMaterial({color:1668818})),l=(new o.MeshBasicMaterial({color:1668818,wireframe:!0}),new o.MeshStandardMaterial({color:1668818}),c),h=(new o.MeshPhongMaterial({color:1668818}),new o.MeshPhongMaterial({color:1668818,transparent:!0,opacity:.5}),new o.MeshPhongMaterial({color:new o.Color("red")})),{THREE:u}=window;function d(e){const{ycad:t,feature:r}=e,{compile:n,getFeatureById:s}=t,{selectById:i,sketchId:o}=r,{id:c,amount:l}=r;Object.create(r).amount=n(l);const d=s(i||o);if(!d)return void console.warn("[extrude] couldnt find suitable path to extrude",r);const{path:p,_path:f}=d,y=r._shape||a(p||f),v=h,m=new u.ExtrudeGeometry(y,{amount:l,bevelEnabled:!1}),w=new u.Mesh(m,v);return w.name=`[extrude]${c}`,r._mesh=w,{mesh:w}}function p({ycad:e,cadData:t,scene:r,feature:n,object3d:s}){const{compile:i,getFeatureById:a}=e,{selectById:o,sketchId:c,settings:l}=n,{times:h,direction:u}=l,[d,p,f]=u,y=a(o)._mesh;for(let e=0;e<h;e++){var v=y.clone();v.translateX(d*e),v.translateY(p*e),v.translateZ(f*e),s.add(v)}n._mesh=s}function f(e){return null!==e&&void 0!==e&&e.constructor===String}const y=new THREE.LineBasicMaterial({color:0}),{THREE:v}=window;new THREE.LineBasicMaterial({color:16777215}),new THREE.LineBasicMaterial({color:new THREE.Color("blue")}),new THREE.LineBasicMaterial({color:new THREE.Color("red")});const{THREE:m}=window;function w(e){const{feature:t}=e,{path:r}=t;var n=new m.Shape;r.map(e=>{const[t,...r]=e;n[t](...r)});var s=new m.ShapeGeometry(n),i=new m.MeshPhongMaterial({color:1401481,emissive:468276,side:m.DoubleSide,flatShading:!0});return{mesh:new m.Mesh(s,i)}}const{THREE:_}=window;const{THREE:g}=window;const{THREE:E}=window,x={path:function(e){const t=y,{ycad:r,scene:n,feature:s}=e,{compile:i}=r,{path:o,plane:c}=s,{sketchFill:l}=r.settings;console.log(`Creating sketch on plane "${c}"`,s);let h=[];o.map(e=>{const{x:t,y:r}=e;h.push({x:f(t)?i(t):t,y:f(r)?i(r):r})});const u=a(o);s._path=h,s._shape=u;var d=u.getPoints(),p=(new v.BufferGeometry).setFromPoints(d);return{mesh:new v.Line(p,t)}},point:function(e){const{x:t=0,y:r=0,r:n=.1}=e.feature,s=new _.CircleGeometry(n,32);s.vertices.shift(),s.vertices.push(new _.Vector3(.1,0,0)),s.vertices.push(new _.Vector3(-.1,0,0)),s.vertices.push(new _.Vector3(0,.1,0)),s.vertices.push(new _.Vector3(0,-.1,0));const i=new _.MeshBasicMaterial({color:0}),a=new _.LineLoop(s,i);return a.position.x=t,a.position.y=r,{mesh:a}},patharray:w,circle:function(e){const{feature:t}=e,{name:r}=t,{x:n=0,y:s=0,r:i=1}=t,a=new g.MeshBasicMaterial({color:0}),o=new g.MeshPhongMaterial({color:1401481,emissive:468276,side:g.DoubleSide,flatShading:!0}),c=new g.CircleGeometry(i,32),l=new g.CircleGeometry(i,32),h=new g.Object3D,u=new g.Mesh(c,o);u.name="fill",u.visible=!1,h.add(u),l.vertices.shift();const d=new g.LineLoop(l,a);return d.name="lines",h.add(d),h.position.x=n,h.position.y=s,h.name=r||"circle",{mesh:h}}};var b=function(e){const{ycad:t,feature:r}=e,{children:n=[]}=r,{path:s,plane:i}=r;console.log(`Creating sketch on plane "${i}"`),!n&&s&&n.push({type:"path",path:s});const a=n.map(e=>{let{type:r}=e;if("path"===r){const{path:t}=e,[n]=t;r=n.constructor===Array?"patharray":"path"}const{suppress:n}=e;if(n)return;const s=x[r];if(!s)return void console.warn(`Unknown feature: "${r}"`);const i=s({ycad:t,feature:e}),{mesh:a={}}=i;return a}),o=new E.Object3D;return o.children=a.filter(e=>e),{mesh:o}};const{THREE:T}=window;function M(e){const{ycad:t,ThreeBSP:r,cadData:n,scene:s,feature:i,object3d:a}=e,{compile:o,getFeatureById:c}=t,{selectById:h,sketchId:u,amount:p}=i,f=a.children.filter(e=>"Mesh"===e.type)[0],{mesh:y}=d(e);c(h||u);console.log("Body to be cutted:",f),console.log("Body to be extruded:",y);var v=new r(f),m=new r(y),w=v.subtract(m).toMesh(l);w.geometry.computeVertexNormals(),a.add(w);var _=new T.EdgesGeometry(w.geometry),g=new T.LineSegments(_,new T.LineBasicMaterial({color:0}));s.add(g),f.visible=!1}r.d(t,"insert",function(){return s}),r.d(t,"plane",function(){return i}),r.d(t,"extrude",function(){return d}),r.d(t,"pattern",function(){return p}),r.d(t,"sketch",function(){return b}),r.d(t,"cut",function(){return M}),r.d(t,"sketchArray",function(){return w})}]);
//# sourceMappingURL=parametric.js.map